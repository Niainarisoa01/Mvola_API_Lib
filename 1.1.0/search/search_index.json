{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"MVola API Library","text":"<p>Bienvenue dans la documentation de la biblioth\u00e8que MVola API.</p>"},{"location":"#introduction","title":"Introduction","text":"<p>MVola API Library est une biblioth\u00e8que Python robuste con\u00e7ue pour faciliter l'int\u00e9gration des services de paiement mobile MVola dans vos applications. Cette biblioth\u00e8que vous permet d'interagir avec les API de MVola de mani\u00e8re simple et intuitive, en g\u00e9rant automatiquement l'authentification, la validation des param\u00e8tres, et le traitement des erreurs.</p>"},{"location":"#documentation-complete-de-lapi","title":"Documentation compl\u00e8te de l'API","text":"<p>La documentation compl\u00e8te de l'API MVola est disponible ici.</p> <p>Cette documentation d\u00e9taill\u00e9e contient: - Configuration du portail d\u00e9veloppeur - Endpoints d'API et param\u00e8tres - Structures de requ\u00eates et r\u00e9ponses - Codes d'erreur - Bonnes pratiques - Environnement de test</p>"},{"location":"#installation","title":"Installation","text":"<pre><code>pip install mvola-api-lib\n</code></pre>"},{"location":"#fonctionnalites-principales","title":"Fonctionnalit\u00e9s principales","text":"<ul> <li>\u2705 Gestion des jetons d'authentification avec scope <code>EXT_INT_MVOLA_SCOPE</code></li> <li>\u2705 Paiements marchands (initiation, statut, d\u00e9tails)</li> <li>\u2705 Support des environnements Sandbox (<code>https://devapi.mvola.mg</code>) et Production (<code>https://api.mvola.mg</code>)</li> <li>\u2705 Validation des param\u00e8tres</li> <li>\u2705 Gestion robuste des erreurs</li> <li>\u2705 Journalisation int\u00e9gr\u00e9e</li> </ul>"},{"location":"#utilisation-rapide","title":"Utilisation rapide","text":"<p>Pour un d\u00e9marrage rapide, consultez les exemples dans la section Guide d'utilisation.</p>"},{"location":"#formats-de-documentation","title":"Formats de documentation","text":"<p>La documentation est disponible en plusieurs formats:</p> <ul> <li>Documentation en ligne</li> <li>Documentation Markdown sur GitHub</li> </ul>"},{"location":"#support","title":"Support","text":"<p>Pour toute question technique, contactez: - Le support MVola via le portail d\u00e9veloppeur - Cr\u00e9ez une issue sur GitHub</p>"},{"location":"#fonctionnalites","title":"Fonctionnalit\u00e9s","text":"<ul> <li>\u2705 API simple et intuitive pour l'int\u00e9gration des paiements MVola</li> <li>\u2705 Gestion automatique des tokens d'authentification</li> <li>\u2705 Support complet des op\u00e9rations de paiement marchand</li> <li>\u2705 Gestion compl\u00e8te des erreurs et validation des param\u00e8tres</li> <li>\u2705 Support de journalisation</li> <li>\u2705 Compatible avec les environnements sandbox et production</li> </ul>"},{"location":"#demarrage-rapide","title":"D\u00e9marrage rapide","text":"<pre><code>\"\"\"\nMVola API Library - Guide de d\u00e9marrage rapide\n\nCe script d\u00e9montre comment utiliser la biblioth\u00e8que MVola API pour:\n1. Initialiser un client MVola\n2. G\u00e9n\u00e9rer un token d'authentification\n3. Initier un paiement\n4. Suivre l'\u00e9tat d'une transaction\n5. Obtenir les d\u00e9tails d'une transaction\n\nPour plus d'informations, consultez la documentation compl\u00e8te: \nhttps://github.com/Niainarisoa01/Mvola_API_Lib\n\"\"\"\n\nfrom mvola_api import MVolaClient\nimport time\n\n# ======================================================\n# 1. INITIALISATION DU CLIENT\n# ======================================================\n# Remplacez ces valeurs par vos propres credentials\n# Pour le mode production, utilisez l'URL de production\nclient = MVolaClient(\n    consumer_key=\"your_consumer_key\",  # Obtenu du portail d\u00e9veloppeur MVola\n    consumer_secret=\"your_consumer_secret\",  # Obtenu du portail d\u00e9veloppeur MVola\n    partner_name=\"nom de votre entreprise\",  # Nom de votre application/entreprise\n    partner_msisdn=\"0343500004\",  # Num\u00e9ro marchand (IMPORTANT: en environnement sandbox, utilisez uniquement 0343500003 ou 0343500004)\n    base_url=\"https://devapi.mvola.mg\"  # URL de l'environnement sandbox\n)\n\n# ======================================================\n# 2. AUTHENTIFICATION - G\u00c9N\u00c9RATION DE TOKEN\n# ======================================================\n# Un token est valide pendant 1 heure\n# La biblioth\u00e8que g\u00e8re automatiquement le renouvellement\ntoken_data = client.generate_token()\nprint(f\"Token g\u00e9n\u00e9r\u00e9: {token_data['access_token'][:10]}...\")\n\n# ======================================================\n# 3. INITIER UN PAIEMENT\n# ======================================================\n# REMARQUE IMPORTANTE: Dans l'environnement sandbox MVola:\n# - Le d\u00e9biteur (debit_msisdn) doit \u00eatre le 0343500004\n# - Le cr\u00e9diteur (credit_msisdn) doit \u00eatre le 0343500003\n# C'est l'inverse de ce qu'on pourrait attendre, mais c'est une sp\u00e9cificit\u00e9 de l'environnement de test\nresult = client.initiate_merchant_payment(\n    amount=1000,  # Montant en Ariary (minimum 100)\n    currency=\"Ar\",  # Devise (Ariary)\n    debit_msisdn=\"0343500004\",  # Num\u00e9ro du d\u00e9biteur (celui qui paie)\n    credit_msisdn=\"0343500003\",  # Num\u00e9ro du cr\u00e9diteur (celui qui re\u00e7oit)\n    description=\"Test Transaction\",  # Description de la transaction (max 50 caract\u00e8res)\n    requesting_organisation_transaction_reference=\"REF123456\",  # R\u00e9f\u00e9rence c\u00f4t\u00e9 client\n    callback_url=\"https://example.com/callback\"  # URL o\u00f9 MVola enverra des notifications (optionnel)\n)\n\n# ======================================================\n# 4. SUIVI DE LA TRANSACTION\n# ======================================================\n# L'ID de corr\u00e9lation est n\u00e9cessaire pour suivre l'\u00e9tat de la transaction\nserver_correlation_id = result['serverCorrelationId']\nprint(f\"Transaction initi\u00e9e avec l'ID de corr\u00e9lation: {server_correlation_id}\")\n\n# 4.1 V\u00e9rification initiale du statut\nprint(\"\\n=== Test de get_transaction_status (statut initial) ===\")\nstatus_result = client.get_transaction_status(server_correlation_id)\nprint(f\"Statut de la transaction: {status_result['status']}\")\n\n# 4.2 Suivi automatique du statut - boucle de v\u00e9rification\n# La transaction peut prendre du temps pour \u00eatre trait\u00e9e\nprint(\"\\n=== Boucle de v\u00e9rification du statut ===\")\nmax_attempts = 10  # Maximum d'essais\nwaiting_time = 3   # Secondes entre chaque v\u00e9rification\ncurrent_attempt = 1\ntransaction_status = status_result['status']\n\n# La boucle continue jusqu'\u00e0 ce que le statut change ou le nombre max de tentatives soit atteint\nwhile transaction_status == \"pending\" and current_attempt &lt;= max_attempts:\n    print(f\"Tentative {current_attempt}/{max_attempts} - Statut actuel: {transaction_status}\")\n    print(f\"Attente de {waiting_time} secondes avant nouvelle v\u00e9rification...\")\n    time.sleep(waiting_time)\n\n    # V\u00e9rification p\u00e9riodique du statut\n    status_result = client.get_transaction_status(server_correlation_id)\n    transaction_status = status_result['status']\n    current_attempt += 1\n\nprint(f\"\\nStatut final apr\u00e8s {current_attempt-1} v\u00e9rifications: {transaction_status}\")\n\n# 4.3 Interpr\u00e9tation du statut final\n# Les statuts possibles sont: pending, completed, failed\nif transaction_status == \"pending\":\n    print(\"En attente d'approbation\")\n    print(\"La transaction est toujours en attente apr\u00e8s toutes les tentatives de v\u00e9rification.\")\n    print(\"Vous devrez peut-\u00eatre l'approuver manuellement dans le portail d\u00e9veloppeur MVola.\")\nelif transaction_status == \"completed\":\n    print(\"La transaction est R\u00e9ussie\")\n    print(\"Le paiement a \u00e9t\u00e9 approuv\u00e9 et trait\u00e9 avec succ\u00e8s.\")\nelif transaction_status == \"failed\":\n    print(\"\u00c9chec de transaction\")\n    print(\"Le paiement a \u00e9t\u00e9 rejet\u00e9 ou a \u00e9chou\u00e9 pendant le traitement.\")\nelse:\n    print(f\"Statut final: {transaction_status}\")\n    print(\"Statut non reconnu ou en cours de traitement.\")\n\n# ======================================================\n# 5. D\u00c9TAILS DE LA TRANSACTION\n# ======================================================\n# Obtient des informations compl\u00e8tes sur la transaction\nprint(\"\\n=== Test de get_transaction_details ===\")\n\n# L'objectReference est l'ID unique de la transaction, n\u00e9cessaire pour obtenir les d\u00e9tails\ntransaction_id = status_result.get('objectReference')\n\nif transaction_id and transaction_id.strip():\n    print(f\"ID de transaction obtenu: {transaction_id}\")\n\n    try:\n        # R\u00e9cup\u00e9ration des d\u00e9tails complets\n        details_result = client.get_transaction_details(transaction_id)\n        print(f\"D\u00e9tails de la transaction: {details_result}\")\n\n        # Acc\u00e8s aux d\u00e9tails sp\u00e9cifiques\n        amount = details_result.get('amount')\n        currency = details_result.get('currency')\n        transaction_status = details_result.get('transactionStatus')\n\n        print(f\"Montant: {amount} {currency}\")\n        print(f\"Statut: {transaction_status}\")\n    except Exception as e:\n        print(f\"Erreur lors de la r\u00e9cup\u00e9ration des d\u00e9tails: {str(e)}\")\nelse:\n    print(\"L'objectReference est vide ou non disponible\")\n\n    # Explication selon le statut actuel\n    if transaction_status == \"pending\":\n        print(\"La transaction est encore en attente d'approbation\")\n        print(\"\\nNote: Dans l'environnement sandbox, les transactions restent souvent en \u00e9tat 'pending'\")\n        print(\"Pour les tests, vous devriez approuver manuellement la transaction dans le portail d\u00e9veloppeur MVola\")\n    elif transaction_status == \"completed\":\n        print(\"La transaction est compl\u00e9t\u00e9e mais l'ID de r\u00e9f\u00e9rence n'est pas disponible\")\n        print(\"C'est inhabituel - v\u00e9rifiez dans le portail d\u00e9veloppeur MVola\")\n    elif transaction_status == \"failed\":\n        print(\"La transaction a \u00e9chou\u00e9. Aucun ID de r\u00e9f\u00e9rence n'est g\u00e9n\u00e9r\u00e9 pour les transactions \u00e9chou\u00e9es\")\n        print(\"V\u00e9rifiez les d\u00e9tails de l'\u00e9chec dans le portail d\u00e9veloppeur MVola\")\n    else:\n        print(f\"La transaction a un statut inhabituel: {transaction_status}\")\n        print(\"V\u00e9rifiez le portail d\u00e9veloppeur MVola pour plus de d\u00e9tails\")\n\n# ======================================================\n# REMARQUES SUPPL\u00c9MENTAIRES\n# ======================================================\n# 1. En environnement sandbox, vous devrez approuver manuellement les transactions\n#    dans le portail d\u00e9veloppeur MVola pour qu'elles passent \u00e0 l'\u00e9tat \"completed\"\n# \n# 2. Cette biblioth\u00e8que g\u00e8re automatiquement:\n#    - Le renouvellement du token d'authentification\n#    - Le formatage des requ\u00eates selon les attentes de l'API MVola\n#    - La gestion des erreurs et exceptions\n#\n# 3. Pour l'environnement de production:\n#    - Utilisez l'URL \"https://api.mvola.mg\" lors de l'initialisation du client\n#    - Utilisez vos v\u00e9ritables num\u00e9ros de t\u00e9l\u00e9phone MVola\n#    - Assurez-vous d'avoir les autorisations n\u00e9cessaires \n</code></pre>"},{"location":"#tests-en-sandbox","title":"Tests en sandbox","text":"<p>Pour les tests en sandbox, utilisez les num\u00e9ros de t\u00e9l\u00e9phone de test suivants : - 0343500003 - 0343500004</p>"},{"location":"#endpoints-dapi","title":"Endpoints d'API","text":"<p>La biblioth\u00e8que prend en charge les endpoints suivants :</p> <ol> <li>Authentification : <code>POST /token</code> (avec scope <code>EXT_INT_MVOLA_SCOPE</code>)</li> <li>Paiement marchand : <code>POST /mvola/mm/transactions/type/merchantpay/1.0.0/</code></li> <li>D\u00e9tails de transaction : <code>GET /mvola/mm/transactions/type/merchantpay/1.0.0/{{transID}}</code></li> <li>Statut de transaction : <code>GET /mvola/mm/transactions/type/merchantpay/1.0.0/status/{{serverCorrelationId}}</code></li> </ol>"},{"location":"#structure-de-la-documentation","title":"Structure de la documentation","text":"<p>Cette documentation a \u00e9t\u00e9 structur\u00e9e selon le framework Di\u00e1taxis, qui organise l'information en quatre sections distinctes :</p> <ol> <li>Guides d'utilisation - Orient\u00e9s apprentissage, pour vous aider \u00e0 comprendre les concepts</li> <li>Exemples - Orient\u00e9s probl\u00e8mes, pour r\u00e9soudre des cas d'utilisation sp\u00e9cifiques</li> <li>R\u00e9f\u00e9rence API - Orient\u00e9s information, documentation technique d\u00e9taill\u00e9e</li> <li>Explication - Orient\u00e9s compr\u00e9hension, pour expliquer les choix et l'architecture</li> </ol>"},{"location":"#contribution","title":"Contribution","text":"<p>Les contributions sont les bienvenues ! Consultez notre guide de contribution pour plus d'informations.</p>"},{"location":"#licence","title":"Licence","text":"<p>Ce projet est sous licence MIT. </p>"},{"location":"changelog/","title":"Changelog","text":"<p>Toutes les modifications notables apport\u00e9es \u00e0 ce projet seront document\u00e9es dans ce fichier.</p> <p>Le format est bas\u00e9 sur Keep a Changelog, et ce projet adh\u00e8re au Semantic Versioning.</p>"},{"location":"changelog/#110-2025-06-30","title":"[1.1.0] - 2025-06-30","text":""},{"location":"changelog/#ajoute","title":"Ajout\u00e9","text":"<ul> <li>Support du nouveau param\u00e8tre <code>scope=EXT_INT_MVOLA_SCOPE</code> pour l'authentification</li> <li>Support des nouveaux param\u00e8tres de transaction: <code>requestingOrganisationTransactionReference</code> et <code>originalTransactionReference</code></li> <li>Nouvelle longueur maximale de 50 caract\u00e8res pour la description des transactions</li> </ul>"},{"location":"changelog/#change","title":"Chang\u00e9","text":"<ul> <li>Migration des URLs d'API: </li> <li>Sandbox: <code>https://devapi.mvola.mg</code> (remplace api-uat.orange.mg)</li> <li>Production: <code>https://api.mvola.mg</code> (remplace api.orange.mg)</li> <li>Mise \u00e0 jour du client pour utiliser <code>base_url</code> au lieu de <code>sandbox</code></li> <li>Renommage de la m\u00e9thode <code>initiate_payment</code> en <code>initiate_merchant_payment</code></li> <li>Mise \u00e0 jour compl\u00e8te de la documentation pour refl\u00e9ter les changements d'API</li> <li>Am\u00e9lioration de la gestion des erreurs avec les nouveaux formats de r\u00e9ponse standardis\u00e9s</li> <li>Mise \u00e0 jour du processus de v\u00e9rification de statut pour utiliser <code>serverCorrelationId</code></li> </ul>"},{"location":"changelog/#corrige","title":"Corrig\u00e9","text":"<ul> <li>Format de la r\u00e9ponse de callback pour utiliser <code>transactionStatus</code> au lieu de <code>status</code></li> <li>M\u00e9thode de callback modifi\u00e9e pour utiliser PUT au lieu de POST</li> </ul>"},{"location":"changelog/#100-2024-07-24","title":"[1.0.0] - 2024-07-24","text":""},{"location":"changelog/#ajoute_1","title":"Ajout\u00e9","text":"<ul> <li>Premi\u00e8re version de la biblioth\u00e8que</li> <li>Module d'authentification avec gestion de tokens</li> <li>Module de transaction pour les paiements marchands</li> <li>Support des environnements sandbox et production</li> <li>Gestion compl\u00e8te des erreurs</li> <li>Documentation utilisateur et guide d'int\u00e9gration</li> <li>Exemples d'utilisation</li> </ul>"},{"location":"changelog/#change_1","title":"Chang\u00e9","text":"<ul> <li>N/A (premi\u00e8re version)</li> </ul>"},{"location":"changelog/#corrige_1","title":"Corrig\u00e9","text":"<ul> <li>N/A (premi\u00e8re version)</li> </ul>"},{"location":"changelog/#non-publie","title":"[Non publi\u00e9]","text":""},{"location":"changelog/#ajoute_2","title":"Ajout\u00e9","text":"<ul> <li>Structure initiale du projet</li> <li>Configuration de build avec pyproject.toml</li> <li>Framework de tests</li> <li>Documentation avec MkDocs </li> </ul>"},{"location":"contributing/","title":"Guide de contribution","text":"<p>Nous sommes ravis que vous souhaitiez contribuer \u00e0 la biblioth\u00e8que MVola API ! Ce document vous guidera \u00e0 travers le processus de contribution.</p>"},{"location":"contributing/#code-de-conduite","title":"Code de conduite","text":"<p>En participant \u00e0 ce projet, vous vous engagez \u00e0 maintenir un environnement respectueux et accueillant pour tous. Nous attendons de tous les contributeurs qu'ils se conforment aux principes suivants :</p> <ul> <li>Utiliser un langage accueillant et inclusif</li> <li>Respecter les diff\u00e9rents points de vue et exp\u00e9riences</li> <li>Accepter gracieusement les critiques constructives</li> <li>Se concentrer sur ce qui est le mieux pour la communaut\u00e9</li> <li>Faire preuve d'empathie envers les autres membres de la communaut\u00e9</li> </ul>"},{"location":"contributing/#comment-contribuer","title":"Comment contribuer","text":""},{"location":"contributing/#signaler-des-bugs","title":"Signaler des bugs","text":"<p>Si vous trouvez un bug, veuillez cr\u00e9er une issue sur GitHub avec les informations suivantes :</p> <ol> <li>Un titre clair et descriptif</li> <li>Une description d\u00e9taill\u00e9e du probl\u00e8me</li> <li>Les \u00e9tapes pour reproduire le bug</li> <li>Le comportement attendu vs. le comportement observ\u00e9</li> <li>Toute information suppl\u00e9mentaire (environnement, logs, etc.)</li> </ol>"},{"location":"contributing/#proposer-des-ameliorations","title":"Proposer des am\u00e9liorations","text":"<p>Pour proposer une am\u00e9lioration, cr\u00e9ez une issue en incluant :</p> <ol> <li>Une description claire de l'am\u00e9lioration propos\u00e9e</li> <li>La justification de cette am\u00e9lioration (pourquoi est-elle utile ?)</li> <li>Si possible, un exemple de code ou une esquisse de l'impl\u00e9mentation</li> </ol>"},{"location":"contributing/#contribution-au-code","title":"Contribution au code","text":"<ol> <li>Fork le d\u00e9p\u00f4t sur GitHub</li> <li>Clone votre fork sur votre machine locale</li> <li>Cr\u00e9ez une branche pour votre contribution (<code>git checkout -b feature/ma-fonctionnalite</code>)</li> <li>Modifiez le code en suivant les conventions du projet</li> <li>Testez vos modifications</li> <li>Committez vos changements (<code>git commit -m \"Ajout de ma fonctionnalit\u00e9\"</code>)</li> <li>Poussez votre branche sur GitHub (<code>git push origin feature/ma-fonctionnalite</code>)</li> <li>Cr\u00e9ez une Pull Request sur le d\u00e9p\u00f4t original</li> </ol>"},{"location":"contributing/#compatibilite-avec-lapi-mvola","title":"Compatibilit\u00e9 avec l'API MVola","text":""},{"location":"contributing/#endpoints-actuels","title":"Endpoints actuels","text":"<p>La biblioth\u00e8que doit rester compatible avec les derniers endpoints de l'API MVola :</p> <ul> <li>Authentification : <code>POST /token</code> avec <code>scope=EXT_INT_MVOLA_SCOPE</code></li> <li>Paiement marchand : <code>POST /mvola/mm/transactions/type/merchantpay/1.0.0/</code></li> <li>D\u00e9tails de transaction : <code>GET /mvola/mm/transactions/type/merchantpay/1.0.0/{{transID}}</code></li> <li>Statut de transaction : <code>GET /mvola/mm/transactions/type/merchantpay/1.0.0/status/{{serverCorrelationId}}</code></li> </ul>"},{"location":"contributing/#urls-de-base","title":"URLs de base","text":"<ul> <li>Sandbox : <code>https://devapi.mvola.mg</code></li> <li>Production : <code>https://api.mvola.mg</code></li> </ul>"},{"location":"contributing/#tests-en-sandbox","title":"Tests en sandbox","text":"<p>Pour les tests dans l'environnement sandbox, utilisez uniquement les num\u00e9ros MVola de test : - <code>0343500003</code> - <code>0343500004</code></p>"},{"location":"contributing/#processus-de-developpement","title":"Processus de d\u00e9veloppement","text":""},{"location":"contributing/#environnement-de-developpement","title":"Environnement de d\u00e9veloppement","text":"<p>Pour configurer votre environnement de d\u00e9veloppement :</p> <pre><code># Cloner le d\u00e9p\u00f4t\ngit clone https://github.com/Niainarisoa01/Mvola_API_Lib.git\ncd Mvola_API_Lib\n\n# Installer les d\u00e9pendances de d\u00e9veloppement\npip install -e \".[dev]\"\n</code></pre>"},{"location":"contributing/#executer-les-tests","title":"Ex\u00e9cuter les tests","text":"<pre><code># Ex\u00e9cuter tous les tests\npytest\n\n# Ex\u00e9cuter les tests avec couverture\npytest --cov=mvola_api\n</code></pre>"},{"location":"contributing/#style-de-code","title":"Style de code","text":"<p>Nous utilisons les outils suivants pour maintenir un style de code coh\u00e9rent :</p> <ul> <li>Black pour le formatage de code</li> <li>isort pour trier les imports</li> <li>flake8 pour la v\u00e9rification de style</li> </ul> <p>Vous pouvez les ex\u00e9cuter avec :</p> <pre><code># Formater le code\nblack mvola_api tests\n\n# Trier les imports\nisort mvola_api tests\n\n# V\u00e9rifier le style\nflake8 mvola_api tests\n</code></pre>"},{"location":"contributing/#documentation","title":"Documentation","text":"<p>La documentation est g\u00e9n\u00e9r\u00e9e avec MkDocs et mkdocstrings :</p> <pre><code># Installer les d\u00e9pendances de documentation\npip install -e \".[docs]\"\n\n# Servir la documentation localement\nmkdocs serve\n\n# Construire la documentation\nmkdocs build\n</code></pre>"},{"location":"contributing/#conventions-de-commit","title":"Conventions de commit","text":"<p>Nous suivons une convention de messages de commit simple :</p> <ul> <li><code>feat:</code> pour une nouvelle fonctionnalit\u00e9</li> <li><code>fix:</code> pour une correction de bug</li> <li><code>docs:</code> pour les modifications de documentation</li> <li><code>style:</code> pour les changements de formatage</li> <li><code>refactor:</code> pour les refactorisations de code</li> <li><code>test:</code> pour l'ajout ou la modification de tests</li> <li><code>chore:</code> pour les t\u00e2ches de maintenance</li> </ul> <p>Exemple : <code>feat: Ajout de la fonctionnalit\u00e9 de paiement par callback</code></p>"},{"location":"contributing/#versionnement","title":"Versionnement","text":"<p>Nous suivons le Semantic Versioning :</p> <ul> <li>MAJOR pour les changements incompatibles</li> <li>MINOR pour les ajouts de fonctionnalit\u00e9s r\u00e9trocompatibles</li> <li>PATCH pour les corrections de bugs r\u00e9trocompatibles</li> </ul>"},{"location":"contributing/#processus-de-revue","title":"Processus de revue","text":"<p>Lorsque vous soumettez une Pull Request, un mainteneur du projet la passera en revue. Le processus peut inclure des demandes de modifications ou des discussions sur l'impl\u00e9mentation.</p> <p>Pour faciliter la revue :</p> <ol> <li>Assurez-vous que tous les tests passent</li> <li>Documentez les nouvelles fonctionnalit\u00e9s</li> <li>Maintenez vos Pull Requests focalis\u00e9es sur une seule fonctionnalit\u00e9/correction</li> </ol>"},{"location":"contributing/#remerciements","title":"Remerciements","text":"<p>Un grand merci \u00e0 tous les contributeurs qui aident \u00e0 am\u00e9liorer cette biblioth\u00e8que ! </p>"},{"location":"documentation/","title":"Documentation de l'API MVola","text":""},{"location":"documentation/#introduction","title":"Introduction","text":"<p>Cette documentation d\u00e9crit l'int\u00e9gration des services de paiement mobile MVola dans vos applications. MVola est un service de paiement mobile op\u00e9r\u00e9 par Telma Madagascar permettant aux entreprises de recevoir des paiements \u00e9lectroniques.</p>"},{"location":"documentation/#table-des-matieres","title":"Table des mati\u00e8res","text":"<ol> <li>Portail d\u00e9veloppeur MVola</li> <li>Configuration de l'API</li> <li>API d'authentification</li> <li>API de paiement marchand</li> <li>Codes d'erreur</li> <li>Environnement de test</li> <li>Bonnes pratiques</li> </ol>"},{"location":"documentation/#portail","title":"Portail","text":""},{"location":"documentation/#creation-de-compte-et-connexion","title":"Cr\u00e9ation de compte et connexion","text":"<ol> <li>Acc\u00e9dez au portail MVola Developer et cliquez sur \"Connectez-vous\".</li> <li>Pour cr\u00e9er un compte:</li> <li>Saisissez une adresse email valide</li> <li>Remplissez vos informations personnelles</li> <li>Acceptez les conditions d'utilisation</li> <li>Confirmez via le lien envoy\u00e9 par email</li> </ol>"},{"location":"documentation/#declaration-dapplication","title":"D\u00e9claration d'application","text":"<ol> <li>Une fois connect\u00e9, d\u00e9clarez votre application.</li> <li>Fournissez des informations pr\u00e9cises et compl\u00e8tes.</li> <li>Attendez la validation par l'\u00e9quipe MVola.</li> </ol>"},{"location":"documentation/#abonnement-aux-api","title":"Abonnement aux API","text":"<ol> <li>Apr\u00e8s validation de votre application, acc\u00e9dez \u00e0 l'onglet \"Subscriptions\".</li> <li>Abonnez-vous aux API MVola pour recevoir vos cl\u00e9s d'acc\u00e8s.</li> <li>Un email de confirmation vous sera envoy\u00e9.</li> </ol>"},{"location":"documentation/#configuration","title":"Configuration","text":""},{"location":"documentation/#environnements-disponibles","title":"Environnements disponibles","text":"Environnement Base URL Sandbox https://devapi.mvola.mg Production https://api.mvola.mg"},{"location":"documentation/#obtention-des-cles-api","title":"Obtention des cl\u00e9s API","text":"<ol> <li>Dans la section \"SUBSCRIPTIONS\", cliquez sur \"SANDBOX KEYS\".</li> <li>D\u00e9cochez tous les \"grant types\" sauf \"Client Credentials\".</li> <li>Vous obtiendrez votre Consumer Key et Consumer Secret.</li> </ol>"},{"location":"documentation/#configuration-de-lenvironnement","title":"Configuration de l'environnement","text":"<p>Pour passer en production: 1. Cliquez sur \"GO LIVE\" dans le portail d\u00e9veloppeur. 2. Suivez les \u00e9tapes de validation. 3. Utilisez les cl\u00e9s de production une fois approuv\u00e9es.</p>"},{"location":"documentation/#authentification","title":"Authentification","text":""},{"location":"documentation/#endpoints","title":"Endpoints","text":"Environnement M\u00e9thode URL Sandbox POST https://devapi.mvola.mg/token Production POST https://api.mvola.mg/token"},{"location":"documentation/#en-tetes-requis","title":"En-t\u00eates requis","text":"Cl\u00e9 Valeur Authorization Basic Base64(consumer-key:consumer-secret) Content-Type application/x-www-form-urlencoded Cache-Control no-cache"},{"location":"documentation/#corps-de-la-requete","title":"Corps de la requ\u00eate","text":"Param\u00e8tre Valeur grant_type client_credentials scope EXT_INT_MVOLA_SCOPE"},{"location":"documentation/#exemple-de-requete","title":"Exemple de requ\u00eate","text":"<pre><code>curl --location --request POST 'https://devapi.mvola.mg/token' \\\n--header 'Authorization: Basic Base64(consumer-key:consumer-secret)' \\\n--header 'Content-Type: application/x-www-form-urlencoded' \\\n--header 'Cache-Control: no-cache' \\\n--data-urlencode 'grant_type=client_credentials' \\\n--data-urlencode 'scope=EXT_INT_MVOLA_SCOPE'\n</code></pre>"},{"location":"documentation/#reponse-en-cas-de-succes-200","title":"R\u00e9ponse en cas de succ\u00e8s (200)","text":"<pre><code>{\n  \"access_token\": \"&lt;ACCESS_TOKEN&gt;\",\n  \"scope\": \"EXT_INT_MVOLA_SCOPE\",\n  \"token_type\": \"Bearer\",\n  \"expires_in\": 3600\n}\n</code></pre> <p>Notes: - Le token expire apr\u00e8s 3600 secondes (1 heure) - L'encodage Base64 utilise le format <code>consumer-key:consumer-secret</code> avec un deux-points (:)</p>"},{"location":"documentation/#paiement","title":"Paiement","text":""},{"location":"documentation/#endpoints_1","title":"Endpoints","text":"Ressource M\u00e9thode URL Sandbox URL Production Initier une transaction POST https://devapi.mvola.mg/mvola/mm/transactions/type/merchantpay/1.0.0/ https://api.mvola.mg/mvola/mm/transactions/type/merchantpay/1.0.0/ D\u00e9tails de transaction GET https://devapi.mvola.mg/mvola/mm/transactions/type/merchantpay/1.0.0/{transID} https://api.mvola.mg/mvola/mm/transactions/type/merchantpay/1.0.0/{transID} Statut de transaction GET https://devapi.mvola.mg/mvola/mm/transactions/type/merchantpay/1.0.0/status/{serverCorrelationId} https://api.mvola.mg/mvola/mm/transactions/type/merchantpay/1.0.0/status/{serverCorrelationId}"},{"location":"documentation/#en-tetes-communs","title":"En-t\u00eates communs","text":"Cl\u00e9 Valeur Authorization Bearer  Version 1.0 X-CorrelationID ID unique (ex: UUID) UserLanguage FR (Fran\u00e7ais) ou MG (Malgache) UserAccountIdentifier msisdn;{num\u00e9ro} (ex: msisdn;0340017983) partnerName Nom de votre entreprise Content-Type application/json Cache-Control no-cache"},{"location":"documentation/#initier-une-transaction-post","title":"Initier une transaction (POST)","text":"<p>En-t\u00eates additionnels: - <code>X-Callback-URL</code>: URL pour notifications (optionnel)</p> <p>Corps de la requ\u00eate: <pre><code>{  \n  \"amount\": \"10000\",  \n  \"currency\": \"Ar\",  \n  \"descriptionText\": \"Paiement Marchand\",  \n  \"requestDate\": \"2023-10-05T14:30:00.000Z\",  \n  \"debitParty\": [{\"key\": \"msisdn\", \"value\": \"0340017983\"}],  \n  \"creditParty\": [{\"key\": \"msisdn\", \"value\": \"0340017984\"}],  \n  \"metadata\": [  \n    {\"key\": \"partnerName\", \"value\": \"MonEntreprise\"},  \n    {\"key\": \"fc\", \"value\": \"USD\"},  \n    {\"key\": \"amountFc\", \"value\": \"10\"}  \n  ]  \n}\n</code></pre></p> <p>R\u00e9ponse (succ\u00e8s): <pre><code>{  \n  \"status\": \"pending\",  \n  \"serverCorrelationId\": \"421a22a2-effd-42bc-9452-f4939a3d5cdf\",  \n  \"notificationMethod\": \"callback\"  \n}\n</code></pre></p>"},{"location":"documentation/#obtenir-les-details-dune-transaction-get","title":"Obtenir les d\u00e9tails d'une transaction (GET)","text":"<p>Requ\u00eate: <pre><code>GET /mvola/mm/transactions/type/merchantpay/1.0.0/{transID}\n</code></pre></p> <p>R\u00e9ponse (succ\u00e8s): <pre><code>{  \n  \"amount\": \"10000\",  \n  \"currency\": \"Ar\",  \n  \"transactionReference\": \"123456\",  \n  \"transactionStatus\": \"completed\",  \n  \"debitParty\": [{\"key\": \"msisdn\", \"value\": \"0340017983\"}],  \n  \"creditParty\": [{\"key\": \"msisdn\", \"value\": \"0340017984\"}]  \n}\n</code></pre></p>"},{"location":"documentation/#verifier-le-statut-dune-transaction-get","title":"V\u00e9rifier le statut d'une transaction (GET)","text":"<p>Requ\u00eate: <pre><code>GET /mvola/mm/transactions/type/merchantpay/1.0.0/status/{serverCorrelationId}\n</code></pre></p> <p>R\u00e9ponse (succ\u00e8s): <pre><code>{  \n  \"status\": \"completed\",  \n  \"serverCorrelationId\": \"421a22a2-effd-42bc-9452-f4939a3d5cdf\",  \n  \"notificationMethod\": \"polling\",  \n  \"objectReference\": \"123456\"  \n}\n</code></pre></p>"},{"location":"documentation/#erreurs","title":"Erreurs","text":""},{"location":"documentation/#codes-http","title":"Codes HTTP","text":"Code Signification 200 OK \u2013 Requ\u00eate r\u00e9ussie 400 Param\u00e8tres manquants ou invalides 401 Authentification \u00e9chou\u00e9e / Token invalide 402 \u00c9chec m\u00e9tier (ex: solde insuffisant) 403 Droits insuffisants 404 Ressource introuvable 409 Conflit (ex: cl\u00e9 idempotente dupliqu\u00e9e) 429 Trop de requ\u00eates 5xx Erreur serveur"},{"location":"documentation/#format-des-erreurs","title":"Format des erreurs","text":"<pre><code>{  \n  \"ErrorCategory\": \"Transaction\",  \n  \"ErrorCode\": \"5001\",  \n  \"ErrorDescription\": \"Solde insuffisant\",  \n  \"ErrorDateTime\": \"2023-10-05T12:34:56Z\",  \n  \"ErrorParameters\": {\"param\": \"value\"}  \n}\n</code></pre> <p>Erreur d'authentification: <pre><code>{  \n  \"fault\": {  \n    \"code\": 900901,  \n    \"message\": \"Invalid Credentials\",  \n    \"description\": \"Invalid Credentials. Make sure you have given the correct access token.\"  \n  }  \n}\n</code></pre></p>"},{"location":"documentation/#test","title":"Test","text":""},{"location":"documentation/#numeros-de-test-disponibles","title":"Num\u00e9ros de test disponibles","text":"<p>Pour l'environnement Sandbox, utilisez uniquement: - 0343500003 - 0343500004</p>"},{"location":"documentation/#test-des-transactions","title":"Test des transactions","text":"<ol> <li>Dans le portail d\u00e9veloppeur MVola, section \"TRY OUT\":</li> <li>S\u00e9lectionnez votre application</li> <li> <p>G\u00e9n\u00e9rez une cl\u00e9 de test</p> </li> <li> <p>Ex\u00e9cutez vos requ\u00eates de test</p> </li> <li> <p>Approuvez les transactions en attente via \"Transaction Approvals\"</p> </li> </ol>"},{"location":"documentation/#pratiques","title":"Pratiques","text":"<ol> <li>Gestion des tokens</li> <li>Stockez le token de mani\u00e8re s\u00e9curis\u00e9e</li> <li> <p>Int\u00e9grez un m\u00e9canisme de rafra\u00eechissement automatique (avant expiration)</p> </li> <li> <p>Validation des param\u00e8tres</p> </li> <li>V\u00e9rifiez les num\u00e9ros de t\u00e9l\u00e9phone (format valide)</li> <li> <p>\u00c9vitez les caract\u00e8res sp\u00e9ciaux dans les descriptions</p> </li> <li> <p>Dates et formats</p> </li> <li>Format des dates: ISO 8601 (yyyy-MM-dd'T'HH:mm:ss.SSSZ)</li> <li> <p>Utilisez UTC pour \u00e9viter les probl\u00e8mes de fuseau horaire</p> </li> <li> <p>Suivi des transactions</p> </li> <li>Conservez le serverCorrelationId pour suivre les statuts</li> <li> <p>Impl\u00e9mentez un syst\u00e8me de webhook pour les notifications</p> </li> <li> <p>S\u00e9curit\u00e9</p> </li> <li>Utilisez HTTPS pour toutes les communications</li> <li>Ne stockez jamais les credentials en clair</li> <li>Impl\u00e9mentez une rotation r\u00e9guli\u00e8re des cl\u00e9s d'API</li> </ol>"},{"location":"documentation/#support-et-assistance","title":"Support et assistance","text":"<p>Pour toute question technique, contactez MVola via le portail d\u00e9veloppeur ou \u00e0 l'adresse support-api@mvola.mg. </p>"},{"location":"api-reference/auth/","title":"R\u00e9f\u00e9rence du module d'authentification","text":"<p>Le module d'authentification <code>mvola_api.auth</code> g\u00e8re l'authentification aupr\u00e8s de l'API MVola en utilisant OAuth 2.0. Il s'occupe de la g\u00e9n\u00e9ration, du stockage et du rafra\u00eechissement des tokens d'acc\u00e8s.</p>"},{"location":"api-reference/auth/#classe-mvolaauth","title":"Classe MVolaAuth","text":"<p>La classe <code>MVolaAuth</code> est responsable de toutes les op\u00e9rations li\u00e9es \u00e0 l'authentification aupr\u00e8s de l'API MVola.</p>"},{"location":"api-reference/auth/#initialisation","title":"Initialisation","text":"<pre><code>from mvola_api.auth import MVolaAuth\n\nauth = MVolaAuth(\n    consumer_key=\"votre_consumer_key\",\n    consumer_secret=\"votre_consumer_secret\",\n    base_url=\"https://devapi.mvola.mg\"  # URL de l'API (sandbox par d\u00e9faut)\n)\n</code></pre>"},{"location":"api-reference/auth/#generation-dun-token","title":"G\u00e9n\u00e9ration d'un token","text":"<pre><code># G\u00e9n\u00e9rer un nouveau token\nauth_token = auth.generate_token()\n\n# Le token est un dictionnaire contenant:\n# - access_token: Le token d'acc\u00e8s \u00e0 utiliser dans les requ\u00eates\n# - token_type: Le type de token (g\u00e9n\u00e9ralement \"Bearer\")\n# - expires_in: Dur\u00e9e de validit\u00e9 du token en secondes (3600 secondes = 1 heure)\n# - scope: Le scope du token (EXT_INT_MVOLA_SCOPE)\n\nprint(f\"Token d'acc\u00e8s: {auth_token['access_token']}\")\nprint(f\"Expire dans: {auth_token['expires_in']} secondes\")\nprint(f\"Type de token: {auth_token['token_type']}\")\nprint(f\"Scope: {auth_token['scope']}\")\n</code></pre>"},{"location":"api-reference/auth/#obtention-dun-token-dacces","title":"Obtention d'un token d'acc\u00e8s","text":"<pre><code># Obtenir uniquement la cha\u00eene du token d'acc\u00e8s\naccess_token = auth.get_access_token()\n\n# Cette m\u00e9thode g\u00e9n\u00e8re un nouveau token si n\u00e9cessaire\n# ou retourne le token existant s'il est encore valide\n\n# Forcer le rafra\u00eechissement du token, m\u00eame s'il est encore valide\naccess_token = auth.get_access_token(force_refresh=True)\n</code></pre>"},{"location":"api-reference/auth/#exceptions-dauthentification","title":"Exceptions d'authentification","text":"<p>Le module d'authentification peut lever les exceptions suivantes :</p> <ul> <li><code>MVolaAuthError</code>: Exception de base pour les erreurs d'authentification</li> <li>Inclut des informations comme le code HTTP, le message d'erreur et la r\u00e9ponse compl\u00e8te</li> </ul> <pre><code>from mvola_api.exceptions import MVolaAuthError\n\ntry:\n    token = auth.generate_token()\nexcept MVolaAuthError as e:\n    print(f\"Code d'erreur HTTP: {e.code}\")\n    print(f\"Message d'erreur: {e.message}\")\n    print(f\"R\u00e9ponse compl\u00e8te: {e.response}\")\n</code></pre>"},{"location":"api-reference/auth/#fonctionnement-interne","title":"Fonctionnement interne","text":""},{"location":"api-reference/auth/#endpoints-dauthentification","title":"Endpoints d'authentification","text":"<p>Le module utilise diff\u00e9rents endpoints en fonction de l'environnement:</p> <ul> <li>Sandbox: <code>https://devapi.mvola.mg/token</code></li> <li>Production: <code>https://api.mvola.mg/token</code></li> </ul>"},{"location":"api-reference/auth/#format-de-la-requete-dauthentification","title":"Format de la requ\u00eate d'authentification","text":"<pre><code># Requ\u00eate POST avec les param\u00e8tres suivants:\nheaders = {\n    \"Authorization\": \"Basic {credentials_b64}\",  # Base64(consumer_key:consumer_secret)\n    \"Content-Type\": \"application/x-www-form-urlencoded\",\n    \"Cache-Control\": \"no-cache\"\n}\n\ndata = {\n    \"grant_type\": \"client_credentials\",\n    \"scope\": \"EXT_INT_MVOLA_SCOPE\"\n}\n</code></pre>"},{"location":"api-reference/auth/#format-de-la-reponse","title":"Format de la r\u00e9ponse","text":"<p>En cas de succ\u00e8s, la r\u00e9ponse contient:</p> <pre><code>{\n    \"access_token\": \"&lt;ACCESS_TOKEN&gt;\",\n    \"scope\": \"EXT_INT_MVOLA_SCOPE\",\n    \"token_type\": \"Bearer\",\n    \"expires_in\": 3600\n}\n</code></pre> <p>En cas d'\u00e9chec, la r\u00e9ponse peut contenir:</p> <pre><code>{\n    \"ErrorCategory\": \"Error category\",\n    \"ErrorCode\": \"Error Code\",\n    \"ErrorDescription\": \"description on the error\",\n    \"ErrorDateTime\": \"Date and time when the error occurred\",\n    \"ErrorParameters\": \"Key/value which add more details on the nature of the error\"\n}\n</code></pre>"},{"location":"api-reference/auth/#stockage-du-token","title":"Stockage du token","text":"<p>Le token est stock\u00e9 en m\u00e9moire, dans l'instance de la classe <code>MVolaAuth</code>. Il n'est pas persistant entre les red\u00e9marrages de l'application. Si vous avez besoin de persistance, vous devez impl\u00e9menter votre propre m\u00e9canisme de stockage.</p>"},{"location":"api-reference/auth/#codes-derreur-http","title":"Codes d'erreur HTTP","text":"<p>L'API utilise les codes d'erreur HTTP standard:</p> <ul> <li>200 - OK: Tout a fonctionn\u00e9 comme pr\u00e9vu.</li> <li>400 - Bad Request: La requ\u00eate est inacceptable, souvent en raison d'un param\u00e8tre manquant.</li> <li>401 - Unauthorized: Aucune cl\u00e9 API valide fournie.</li> <li>402 - Request Failed: Les param\u00e8tres \u00e9taient valides mais la requ\u00eate a \u00e9chou\u00e9.</li> <li>403 - Forbidden: La cl\u00e9 API n'a pas les permissions pour effectuer la requ\u00eate.</li> <li>404 - Not Found: La ressource demand\u00e9e n'existe pas.</li> <li>409 - Conflict: La requ\u00eate est en conflit avec une autre requ\u00eate.</li> <li>429 - Too Many Requests: Trop de requ\u00eates envoy\u00e9es \u00e0 l'API trop rapidement.</li> <li>500, 502, 503, 504 - Server Errors: Une erreur s'est produite sur le serveur.</li> </ul>"},{"location":"api-reference/auth/#bonnes-pratiques","title":"Bonnes pratiques","text":"<ol> <li> <p>S\u00e9curit\u00e9: Ne stockez jamais les cl\u00e9s d'API (consumer_key, consumer_secret) directement dans le code. Utilisez des variables d'environnement ou un syst\u00e8me de gestion de secrets.</p> </li> <li> <p>Gestion des tokens: Laissez la biblioth\u00e8que g\u00e9rer automatiquement les tokens avec <code>get_access_token()</code> plut\u00f4t que de les g\u00e9rer manuellement.</p> </li> <li> <p>Environnement de test: Commencez toujours par l'environnement sandbox (<code>https://devapi.mvola.mg</code>) avant de passer \u00e0 la production.</p> </li> <li> <p>Gestion des erreurs: Impl\u00e9mentez une gestion d'erreurs robuste autour des appels d'authentification, car ils peuvent \u00e9chouer pour diverses raisons (r\u00e9seau, identifiants invalides, etc.).</p> </li> <li> <p>Backoff exponentiel: En cas d'erreur 429 (trop de requ\u00eates), impl\u00e9mentez un d\u00e9lai exponentiel entre les tentatives.</p> </li> </ol>"},{"location":"api-reference/auth/#voir-aussi","title":"Voir aussi","text":"<ul> <li>Guide d'authentification - Guide complet sur l'authentification avec MVola</li> <li>R\u00e9f\u00e9rence MVolaClient - Documentation de la classe principale qui utilise MVolaAuth</li> <li>Gestion des erreurs - Comment g\u00e9rer les erreurs d'authentification</li> </ul>"},{"location":"api-reference/client/","title":"Client MVola API","text":"<p>Le <code>MVolaClient</code> est la classe principale qui vous permet d'interagir avec l'API MVola. Il encapsule les fonctionnalit\u00e9s des modules d'authentification et de transaction, offrant une interface unifi\u00e9e et simple pour effectuer des op\u00e9rations avec l'API MVola.</p>"},{"location":"api-reference/client/#classe-mvolaclient","title":"Classe MVolaClient","text":"<p>La classe <code>MVolaClient</code> est le point d'entr\u00e9e principal pour l'utilisation de la biblioth\u00e8que MVola API.</p>"},{"location":"api-reference/client/#initialisation","title":"Initialisation","text":"<pre><code>from mvola_api import MVolaClient\n\n# Initialisation pour l'environnement sandbox (d\u00e9veloppement)\nclient = MVolaClient(\n    consumer_key=\"votre_consumer_key\",\n    consumer_secret=\"votre_consumer_secret\",\n    partner_name=\"Nom de votre application\",\n    partner_msisdn=\"0343500003\",  # Votre num\u00e9ro MVola\n    base_url=\"https://devapi.mvola.mg\"  # URL de l'API (sandbox par d\u00e9faut)\n)\n\n# Initialisation pour l'environnement de production\nprod_client = MVolaClient(\n    consumer_key=\"votre_consumer_key_prod\",\n    consumer_secret=\"votre_consumer_secret_prod\",\n    partner_name=\"Nom de votre application\",\n    partner_msisdn=\"0343500003\",  # Votre num\u00e9ro MVola\n    base_url=\"https://api.mvola.mg\"  # URL de l'API de production\n)\n</code></pre>"},{"location":"api-reference/client/#utilisation-dun-logger-personnalise","title":"Utilisation d'un logger personnalis\u00e9","text":"<p>Vous pouvez fournir votre propre logger pour surveiller les op\u00e9rations :</p> <pre><code>import logging\n\n# Configurer un logger personnalis\u00e9\nlogger = logging.getLogger(\"mvola_custom_logger\")\nhandler = logging.StreamHandler()\nhandler.setFormatter(logging.Formatter(\"%(asctime)s - %(name)s - %(levelname)s - %(message)s\"))\nlogger.addHandler(handler)\nlogger.setLevel(logging.DEBUG)\n\n# Utiliser le logger personnalis\u00e9\nclient = MVolaClient(\n    consumer_key=\"votre_consumer_key\",\n    consumer_secret=\"votre_consumer_secret\",\n    partner_name=\"Nom de votre application\",\n    partner_msisdn=\"0343500003\",\n    base_url=\"https://devapi.mvola.mg\",\n    logger=logger  # Fournir votre logger personnalis\u00e9\n)\n</code></pre>"},{"location":"api-reference/client/#methodes-principales","title":"M\u00e9thodes principales","text":""},{"location":"api-reference/client/#gestion-des-tokens","title":"Gestion des tokens","text":"<pre><code># G\u00e9n\u00e9rer un token d'authentification\ntoken = client.generate_token()\nprint(f\"Token: {token['access_token']}\")\nprint(f\"Expire dans: {token['expires_in']} secondes\")\n\n# Obtenir directement la cha\u00eene du token d'acc\u00e8s\naccess_token = client.get_access_token()\nprint(f\"Token d'acc\u00e8s: {access_token}\")\n</code></pre>"},{"location":"api-reference/client/#operations-de-transaction","title":"Op\u00e9rations de transaction","text":"<pre><code># Initier un paiement merchant\ntransaction_info = client.initiate_merchant_payment(\n    amount=\"1000\",                # Montant en ariary (cha\u00eene)\n    debit_msisdn=\"0343500003\",    # Num\u00e9ro qui paie\n    credit_msisdn=\"0343500004\",   # Num\u00e9ro qui re\u00e7oit\n    description=\"Paiement pour produit ABC\",  # Max 50 caract\u00e8res\n    currency=\"Ar\",                # Devise (Ar par d\u00e9faut)\n    requesting_organisation_transaction_reference=\"REF123456\",  # R\u00e9f\u00e9rence unique (optionnel)\n    original_transaction_reference=\"\",  # R\u00e9f\u00e9rence transaction originale (optionnel)\n    callback_url=\"https://example.com/callback\"  # URL de notification (optionnel)\n)\n\n# R\u00e9cup\u00e9rer l'ID de corr\u00e9lation pour le suivi\nserver_correlation_id = transaction_info['response']['serverCorrelationId']\nprint(f\"ID de corr\u00e9lation: {server_correlation_id}\")\n\n# V\u00e9rifier le statut d'une transaction\nstatus = client.get_transaction_status(\n    server_correlation_id=server_correlation_id\n)\nprint(f\"Statut: {status['response']['status']}\")  # pending, completed, ou failed\n\n# Si la transaction est compl\u00e9t\u00e9e, r\u00e9cup\u00e9rer son ID\nif status['response']['status'] == 'completed' and 'objectReference' in status['response']:\n    transaction_id = status['response']['objectReference']\n\n    # R\u00e9cup\u00e9rer les d\u00e9tails d'une transaction\n    details = client.get_transaction_details(transaction_id=transaction_id)\n    print(f\"Montant: {details['response'].get('amount')} {details['response'].get('currency')}\")\n    print(f\"R\u00e9f\u00e9rence: {details['response'].get('transactionReference')}\")\n</code></pre>"},{"location":"api-reference/client/#format-des-reponses","title":"Format des r\u00e9ponses","text":""},{"location":"api-reference/client/#reponse-dinitiation-de-transaction","title":"R\u00e9ponse d'initiation de transaction","text":"<pre><code>{\n    'response': {\n        'status': 'pending',  # Toujours \"pending\" \u00e0 l'initiation\n        'serverCorrelationId': '421a22a2-ef1d-42bc-9452-f4939a3d5cdf',  # ID pour suivi\n        'notificationMethod': 'polling'  # ou \"callback\" si URL fournie\n    },\n    'status_code': 200,\n    'headers': { ... }  # En-t\u00eates de la r\u00e9ponse HTTP\n}\n</code></pre>"},{"location":"api-reference/client/#reponse-de-statut-de-transaction","title":"R\u00e9ponse de statut de transaction","text":"<pre><code>{\n    'response': {\n        'status': 'completed',  # ou \"pending\", \"failed\"\n        'serverCorrelationId': '421a22a2-ef1d-42bc-9452-f4939a3d5cdf',\n        'notificationMethod': 'polling',\n        'objectReference': 'transactionID123'  # Pr\u00e9sent si status = \"completed\"\n    },\n    'status_code': 200,\n    'headers': { ... }\n}\n</code></pre>"},{"location":"api-reference/client/#reponse-de-details-de-transaction","title":"R\u00e9ponse de d\u00e9tails de transaction","text":"<pre><code>{\n    'response': {\n        'amount': '1000',\n        'currency': 'Ar',\n        'transactionReference': 'transactionID123',\n        'transactionStatus': 'completed',\n        'createDate': '2023-07-24T10:15:30.000Z',\n        'debitParty': [\n            {'key': 'msisdn', 'value': '0343500003'}\n        ],\n        'creditParty': [\n            {'key': 'msisdn', 'value': '0343500004'}\n        ],\n        'fee': [\n            {'feeAmount': '20'}\n        ],\n        'metadata': [\n            {'key': 'originalTransactionResult', 'value': '0'},\n            {'key': 'originalTransactionResultDesc', 'value': 'Success'}\n        ]\n    },\n    'status_code': 200,\n    'headers': { ... }\n}\n</code></pre>"},{"location":"api-reference/client/#gestion-des-erreurs","title":"Gestion des erreurs","text":"<pre><code>from mvola_api.exceptions import MVolaError\n\ntry:\n    # Tentative d'op\u00e9ration\n    result = client.initiate_merchant_payment(...)\nexcept MVolaError as e:\n    print(f\"Erreur MVola: {e}\")\n    print(f\"Code HTTP: {getattr(e, 'status_code', 'N/A')}\")\n    print(f\"D\u00e9tails: {getattr(e, 'details', 'N/A')}\")\n</code></pre>"},{"location":"api-reference/client/#notes-importantes","title":"Notes importantes","text":"<ol> <li> <p>Gestion des tokens : Le client g\u00e8re automatiquement les tokens d'authentification, en les g\u00e9n\u00e9rant et les rafra\u00eechissant au besoin.</p> </li> <li> <p>Environnements : L'environnement sandbox (<code>https://devapi.mvola.mg</code>) doit \u00eatre utilis\u00e9 pour les tests avant de passer \u00e0 la production (<code>https://api.mvola.mg</code>).</p> </li> <li> <p>Num\u00e9ros de t\u00e9l\u00e9phone : Les num\u00e9ros de t\u00e9l\u00e9phone doivent \u00eatre au format national malgache (ex: 034XXXXXXX).</p> </li> <li> <p>Description des transactions : La description ne doit pas d\u00e9passer 50 caract\u00e8res et ne peut contenir que des caract\u00e8res alphanum\u00e9riques, espaces, tirets, points, underscores et virgules.</p> </li> <li> <p>R\u00e9f\u00e9rences de transaction : Utilisez <code>requesting_organisation_transaction_reference</code> pour associer vos propres identifiants aux transactions.</p> </li> <li> <p>Suivi des transactions : Stockez toujours le <code>serverCorrelationId</code> retourn\u00e9 lors de l'initiation pour pouvoir v\u00e9rifier le statut ult\u00e9rieurement.</p> </li> <li> <p>Webhook vs Polling : Si vous fournissez une URL de callback, MVola notifiera cette URL lorsque la transaction sera termin\u00e9e. Sinon, vous devrez interroger l'API pour conna\u00eetre le statut.</p> </li> </ol>"},{"location":"api-reference/client/#voir-aussi","title":"Voir aussi","text":"<ul> <li>Guide d'authentification - Guide complet sur l'authentification</li> <li>Guide des transactions - Guide complet sur les transactions</li> <li>R\u00e9f\u00e9rence d'authentification - Documentation d\u00e9taill\u00e9e du module d'authentification</li> <li>R\u00e9f\u00e9rence de transaction - Documentation d\u00e9taill\u00e9e du module de transaction </li> </ul>"},{"location":"api-reference/exceptions/","title":"R\u00e9f\u00e9rence des exceptions","text":"<p>Le module <code>mvola_api.exceptions</code> d\u00e9finit toutes les exceptions sp\u00e9cifiques \u00e0 la biblioth\u00e8que MVola API. Ces exceptions vous permettent de g\u00e9rer pr\u00e9cis\u00e9ment les diff\u00e9rents types d'erreurs qui peuvent survenir lors de l'utilisation de l'API.</p>"},{"location":"api-reference/exceptions/#hierarchie-des-exceptions","title":"Hi\u00e9rarchie des exceptions","text":"<p>La biblioth\u00e8que utilise une hi\u00e9rarchie d'exceptions pour vous permettre de capturer des cat\u00e9gories sp\u00e9cifiques d'erreurs :</p> <pre><code>MVolaError (Exception de base)\n\u251c\u2500\u2500 MVolaAuthError (Erreurs d'authentification)\n\u2502   \u2514\u2500\u2500 MVolaInvalidCredentialsError\n\u251c\u2500\u2500 MVolaTransactionError (Erreurs de transaction)\n\u2502   \u251c\u2500\u2500 MVolaTransactionValidationError\n\u2502   \u251c\u2500\u2500 MVolaTransactionStatusError\n\u2502   \u2514\u2500\u2500 MVolaTransactionCreationError\n\u251c\u2500\u2500 MVolaValidationError (Erreurs de validation)\n\u2502   \u251c\u2500\u2500 MVolaInvalidParameterError\n\u2502   \u2514\u2500\u2500 MVolaInvalidDescriptionError\n\u251c\u2500\u2500 MVolaConnectionError (Erreurs de connexion)\n\u2502   \u251c\u2500\u2500 MVolaRequestTimeoutError\n\u2502   \u2514\u2500\u2500 MVolaServerError\n\u2514\u2500\u2500 MVolaConfigError (Erreurs de configuration)\n</code></pre>"},{"location":"api-reference/exceptions/#exception-de-base","title":"Exception de base","text":"<p><code>MVolaError</code></p> <p>Cette classe est l'exception de base pour toutes les erreurs sp\u00e9cifiques \u00e0 la biblioth\u00e8que MVola API. Elle \u00e9tend la classe <code>Exception</code> standard de Python et ajoute des fonctionnalit\u00e9s suppl\u00e9mentaires pour la gestion des erreurs.</p> <pre><code>try:\n    # Code utilisant MVola API\nexcept mvola_api.exceptions.MVolaError as e:\n    print(f\"Une erreur MVola s'est produite: {e}\")\n    print(f\"D\u00e9tails suppl\u00e9mentaires: {e.details if hasattr(e, 'details') else 'Aucun'}\")\n    print(f\"Code HTTP: {e.status_code if hasattr(e, 'status_code') else 'N/A'}\")\n</code></pre>"},{"location":"api-reference/exceptions/#exceptions-dauthentification","title":"Exceptions d'authentification","text":"<p><code>MVolaAuthError</code></p> <p>Cette classe repr\u00e9sente les erreurs li\u00e9es \u00e0 l'authentification avec l'API MVola.</p>"},{"location":"api-reference/exceptions/#mvolainvalidcredentialserror","title":"MVolaInvalidCredentialsError","text":"<p>Lev\u00e9e lorsque les identifiants fournis (consumer_key, consumer_secret) sont invalides ou incorrects.</p> <pre><code>try:\n    auth.generate_token()\nexcept mvola_api.exceptions.MVolaInvalidCredentialsError as e:\n    print(f\"Identifiants invalides: {e}\")\n    print(f\"Message d'erreur: {e.message}\")\n    print(f\"Code d'erreur: {e.code}\")\n    print(f\"Description: {e.description}\")\n</code></pre>"},{"location":"api-reference/exceptions/#exceptions-de-transaction","title":"Exceptions de transaction","text":"<p><code>MVolaTransactionError</code></p> <p>Cette classe repr\u00e9sente les erreurs qui se produisent lors des op\u00e9rations de transaction.</p>"},{"location":"api-reference/exceptions/#mvolatransactionvalidationerror","title":"MVolaTransactionValidationError","text":"<p>Lev\u00e9e lorsque les donn\u00e9es de transaction ne passent pas la validation (montant incorrect, num\u00e9ro de t\u00e9l\u00e9phone invalide, description non conforme, etc.).</p> <pre><code>try:\n    transaction.initiate_merchant_payment(amount=\"-100\", ...)  # Montant n\u00e9gatif\nexcept mvola_api.exceptions.MVolaTransactionValidationError as e:\n    print(f\"Erreur de validation: {e}\")\n    print(f\"Champ en erreur: {e.field}\")\n    print(f\"D\u00e9tails: {e.details}\")\n</code></pre>"},{"location":"api-reference/exceptions/#mvolatransactionstatuserror","title":"MVolaTransactionStatusError","text":"<p>Lev\u00e9e lorsqu'une erreur se produit pendant la v\u00e9rification du statut d'une transaction.</p> <pre><code>try:\n    transaction.get_transaction_status(server_correlation_id=\"id-inexistant\", ...)\nexcept mvola_api.exceptions.MVolaTransactionStatusError as e:\n    print(f\"Erreur de statut: {e}\")\n    print(f\"ID de corr\u00e9lation: {e.server_correlation_id}\")\n    print(f\"Code d'erreur: {e.error_code}\")\n    print(f\"Description: {e.error_description}\")\n</code></pre>"},{"location":"api-reference/exceptions/#mvolatransactioncreationerror","title":"MVolaTransactionCreationError","text":"<p>Lev\u00e9e lorsqu'une erreur se produit pendant la cr\u00e9ation d'une transaction.</p> <pre><code>try:\n    transaction.initiate_merchant_payment(...)\nexcept mvola_api.exceptions.MVolaTransactionCreationError as e:\n    print(f\"Erreur lors de la cr\u00e9ation de la transaction: {e}\")\n    print(f\"Cat\u00e9gorie d'erreur: {e.error_category}\")\n    print(f\"Code d'erreur: {e.error_code}\")\n    print(f\"Description: {e.error_description}\")\n    print(f\"Date et heure: {e.error_datetime}\")\n    print(f\"Param\u00e8tres: {e.error_parameters}\")\n</code></pre>"},{"location":"api-reference/exceptions/#exceptions-de-validation","title":"Exceptions de validation","text":"<p><code>MVolaValidationError</code></p> <p>Cette classe repr\u00e9sente les erreurs de validation des param\u00e8tres et donn\u00e9es.</p>"},{"location":"api-reference/exceptions/#mvolainvalidparametererror","title":"MVolaInvalidParameterError","text":"<p>Lev\u00e9e lorsqu'un param\u00e8tre fourni est invalide pour une op\u00e9ration.</p> <pre><code>try:\n    client = MVolaClient(consumer_key=None, ...)  # consumer_key manquant\nexcept mvola_api.exceptions.MVolaInvalidParameterError as e:\n    print(f\"Param\u00e8tre invalide: {e}\")\n    print(f\"Nom du param\u00e8tre: {e.parameter_name}\")\n    print(f\"Raison: {e.reason}\")\n</code></pre>"},{"location":"api-reference/exceptions/#mvolainvaliddescriptionerror","title":"MVolaInvalidDescriptionError","text":"<p>Lev\u00e9e lorsque le texte de description ne respecte pas les contraintes de l'API MVola (max 50 caract\u00e8res, caract\u00e8res sp\u00e9ciaux limit\u00e9s).</p> <pre><code>try:\n    # Description trop longue ou avec caract\u00e8res non autoris\u00e9s\n    transaction.initiate_merchant_payment(\n        description=\"Texte avec caract\u00e8res sp\u00e9ciaux interdits ! @ # $ % ^ &amp; * ( )\",\n        ...\n    )\nexcept mvola_api.exceptions.MVolaInvalidDescriptionError as e:\n    print(f\"Description invalide: {e}\")\n    print(f\"Texte fourni: {e.description}\")\n    print(f\"Raison: {e.reason}\")\n</code></pre>"},{"location":"api-reference/exceptions/#exceptions-de-connexion","title":"Exceptions de connexion","text":"<p><code>MVolaConnectionError</code></p> <p>Cette classe repr\u00e9sente les erreurs de connexion \u00e0 l'API MVola.</p>"},{"location":"api-reference/exceptions/#mvolarequesttimeouterror","title":"MVolaRequestTimeoutError","text":"<p>Lev\u00e9e lorsqu'une requ\u00eate d\u00e9passe le d\u00e9lai d'attente configur\u00e9.</p> <pre><code>try:\n    transaction.initiate_merchant_payment(...)\nexcept mvola_api.exceptions.MVolaRequestTimeoutError as e:\n    print(f\"D\u00e9lai d'attente d\u00e9pass\u00e9: {e}\")\n    print(f\"URL: {e.url}\")\n    print(f\"Temps \u00e9coul\u00e9: {e.timeout} secondes\")\n</code></pre>"},{"location":"api-reference/exceptions/#mvolaservererror","title":"MVolaServerError","text":"<p>Lev\u00e9e lorsque le serveur MVola renvoie une erreur (500, 502, 503, etc.).</p> <pre><code>try:\n    transaction.initiate_merchant_payment(...)\nexcept mvola_api.exceptions.MVolaServerError as e:\n    print(f\"Erreur serveur MVola: {e}\")\n    print(f\"Code HTTP: {e.status_code}\")\n    print(f\"URL: {e.url}\")\n    print(f\"R\u00e9ponse: {e.response}\")\n</code></pre>"},{"location":"api-reference/exceptions/#exceptions-de-configuration","title":"Exceptions de configuration","text":"<p><code>MVolaConfigError</code></p> <p>Cette classe repr\u00e9sente les erreurs de configuration de la biblioth\u00e8que.</p> <pre><code>try:\n    # Tentative d'initialisation avec une configuration incompl\u00e8te\n    client = MVolaClient(...)\nexcept mvola_api.exceptions.MVolaConfigError as e:\n    print(f\"Erreur de configuration: {e}\")\n</code></pre>"},{"location":"api-reference/exceptions/#formats-derreur-de-lapi-mvola","title":"Formats d'erreur de l'API MVola","text":"<p>L'API MVola renvoie des erreurs dans deux formats diff\u00e9rents selon le type d'erreur.</p>"},{"location":"api-reference/exceptions/#format-derreur-standard","title":"Format d'erreur standard","text":"<pre><code>{\n    \"ErrorCategory\": \"Error category\",\n    \"ErrorCode\": \"Error Code\",\n    \"ErrorDescription\": \"Description on the error\",\n    \"ErrorDateTime\": \"Date and time when the error occurred\",\n    \"ErrorParameters\": {\n        \"key1\": \"value1\",\n        \"key2\": \"value2\"\n    }\n}\n</code></pre>"},{"location":"api-reference/exceptions/#format-derreur-dauthentification","title":"Format d'erreur d'authentification","text":"<pre><code>{\n    \"fault\": {\n        \"code\": 900901,\n        \"message\": \"Invalid Credentials\",\n        \"description\": \"Invalid Credentials. Make sure you have given the correct access token\"\n    }\n}\n</code></pre> <p>La biblioth\u00e8que MVola API transforme ces formats d'erreur en exceptions Python appropri\u00e9es, en pr\u00e9servant toutes les informations pertinentes.</p>"},{"location":"api-reference/exceptions/#strategies-de-gestion-des-erreurs","title":"Strat\u00e9gies de gestion des erreurs","text":""},{"location":"api-reference/exceptions/#approche-par-type-specifique","title":"Approche par type sp\u00e9cifique","text":"<p>Attrapez d'abord les exceptions les plus sp\u00e9cifiques, puis les plus g\u00e9n\u00e9rales :</p> <pre><code>try:\n    # Code utilisant MVola API\nexcept mvola_api.exceptions.MVolaInvalidCredentialsError as e:\n    # G\u00e9rer les erreurs d'identifiants sp\u00e9cifiquement\n    print(f\"Identifiants invalides: {e}\")\nexcept mvola_api.exceptions.MVolaAuthError as e:\n    # G\u00e9rer les autres erreurs d'authentification\n    print(f\"Erreur d'authentification: {e}\")\nexcept mvola_api.exceptions.MVolaTransactionValidationError as e:\n    # G\u00e9rer les erreurs de validation\n    print(f\"Erreur de validation: {e}\")\nexcept mvola_api.exceptions.MVolaTransactionError as e:\n    # G\u00e9rer les autres erreurs de transaction\n    print(f\"Erreur de transaction: {e}\")\nexcept mvola_api.exceptions.MVolaConnectionError as e:\n    # G\u00e9rer les erreurs de connexion\n    print(f\"Erreur de connexion: {e}\")\nexcept mvola_api.exceptions.MVolaError as e:\n    # G\u00e9rer toutes les autres erreurs MVola\n    print(f\"Erreur MVola: {e}\")\nexcept Exception as e:\n    # Attraper toutes les autres exceptions Python\n    print(f\"Erreur inattendue: {e}\")\n</code></pre>"},{"location":"api-reference/exceptions/#gestion-avec-retries","title":"Gestion avec retries","text":"<p>Pour certaines erreurs temporaires (timeout, erreurs serveur), vous pouvez impl\u00e9menter une strat\u00e9gie de retry :</p> <pre><code>from mvola_api.exceptions import MVolaRequestTimeoutError, MVolaServerError\nimport time\n\nmax_retries = 3\nretry_count = 0\n\nwhile retry_count &lt; max_retries:\n    try:\n        result = transaction.initiate_merchant_payment(...)\n        # Succ\u00e8s, sortie de la boucle\n        break\n    except (MVolaRequestTimeoutError, MVolaServerError) as e:\n        retry_count += 1\n        if retry_count &gt;= max_retries:\n            print(f\"\u00c9chec apr\u00e8s {max_retries} tentatives: {e}\")\n            raise\n\n        wait_time = 2 ** retry_count  # Backoff exponentiel\n        print(f\"Erreur temporaire: {e}. Tentative {retry_count}/{max_retries} dans {wait_time}s\")\n        time.sleep(wait_time)\n</code></pre>"},{"location":"api-reference/exceptions/#codes-derreur-http","title":"Codes d'erreur HTTP","text":"<p>L'API utilise les codes d'erreur HTTP standard:</p> <ul> <li>200 - OK: Tout a fonctionn\u00e9 comme pr\u00e9vu.</li> <li>400 - Bad Request: La requ\u00eate est inacceptable, souvent en raison d'un param\u00e8tre manquant.</li> <li>401 - Unauthorized: Aucune cl\u00e9 API valide fournie.</li> <li>402 - Request Failed: Les param\u00e8tres \u00e9taient valides mais la requ\u00eate a \u00e9chou\u00e9.</li> <li>403 - Forbidden: La cl\u00e9 API n'a pas les permissions pour effectuer la requ\u00eate.</li> <li>404 - Not Found: La ressource demand\u00e9e n'existe pas.</li> <li>409 - Conflict: La requ\u00eate est en conflit avec une autre requ\u00eate.</li> <li>429 - Too Many Requests: Trop de requ\u00eates envoy\u00e9es \u00e0 l'API trop rapidement.</li> <li>500, 502, 503, 504 - Server Errors: Une erreur s'est produite sur le serveur.</li> </ul>"},{"location":"api-reference/exceptions/#bonnes-pratiques","title":"Bonnes pratiques","text":"<ol> <li> <p>Utilisez des exceptions sp\u00e9cifiques : Attrapez les exceptions les plus sp\u00e9cifiques pertinentes pour votre cas d'utilisation.</p> </li> <li> <p>Journalisez les d\u00e9tails : Les exceptions contiennent des informations utiles pour le d\u00e9bogage - journalisez-les.</p> </li> <li> <p>Impl\u00e9mentez des retries : Pour les erreurs temporaires, mettez en place une logique de retry avec backoff exponentiel.</p> </li> <li> <p>Validez en amont : Pour \u00e9viter certaines exceptions de validation, validez vos donn\u00e9es avant d'appeler l'API.</p> </li> <li> <p>Backoff exponentiel : En cas d'erreur 429 (trop de requ\u00eates), impl\u00e9mentez un d\u00e9lai exponentiel entre les tentatives.</p> </li> <li> <p>Traitement sp\u00e9cifique : Certaines erreurs, comme les soldes insuffisants ou les num\u00e9ros invalides, n\u00e9cessitent un traitement sp\u00e9cifique dans votre application.</p> </li> </ol>"},{"location":"api-reference/exceptions/#voir-aussi","title":"Voir aussi","text":"<ul> <li>Guide de gestion des erreurs - Strat\u00e9gies compl\u00e8tes pour la gestion des erreurs</li> <li>R\u00e9f\u00e9rence MVolaClient - Documentation de la classe principale</li> <li>Utilisation basique - Exemples incluant la gestion des erreurs</li> </ul>"},{"location":"api-reference/transaction/","title":"R\u00e9f\u00e9rence du module de transaction","text":"<p>Le module de transaction <code>mvola_api.transaction</code> g\u00e8re toutes les op\u00e9rations de paiement et de v\u00e9rification de statut aupr\u00e8s de l'API MVola. Ce module permet d'initier des paiements, de v\u00e9rifier leur statut et de r\u00e9cup\u00e9rer les d\u00e9tails des transactions.</p>"},{"location":"api-reference/transaction/#classe-mvolatransaction","title":"Classe MVolaTransaction","text":"<p>La classe <code>MVolaTransaction</code> est responsable de toutes les op\u00e9rations li\u00e9es aux transactions financi\u00e8res via l'API MVola.</p>"},{"location":"api-reference/transaction/#initialisation","title":"Initialisation","text":"<pre><code>from mvola_api.transaction import MVolaTransaction\nfrom mvola_api.auth import MVolaAuth\n\n# Initialiser l'authentification\nauth = MVolaAuth(\n    consumer_key=\"votre_consumer_key\",\n    consumer_secret=\"votre_consumer_secret\",\n    base_url=\"https://devapi.mvola.mg\"  # URL de l'API (sandbox par d\u00e9faut)\n)\n\n# Initialiser le gestionnaire de transactions\ntransaction = MVolaTransaction(\n    auth=auth,\n    base_url=\"https://devapi.mvola.mg\",  # URL de l'API (sandbox par d\u00e9faut)\n    partner_name=\"NOM_DU_PARTENAIRE\",\n    partner_msisdn=\"0343500003\"  # Format: 03XXXXXXXX\n)\n</code></pre>"},{"location":"api-reference/transaction/#operations-principales","title":"Op\u00e9rations principales","text":""},{"location":"api-reference/transaction/#initier-un-paiement","title":"Initier un paiement","text":"<pre><code>try:\n    transaction_info = transaction.initiate_merchant_payment(\n        amount=\"1000\",                           # Montant en ariary (sous forme de cha\u00eene)\n        debit_msisdn=\"0343500003\",               # Num\u00e9ro qui paie (format: 03XXXXXXXX)\n        credit_msisdn=\"0343500004\",              # Num\u00e9ro qui re\u00e7oit (format: 03XXXXXXXX)\n        description=\"Paiement pour produit ABC\", # Description (max 50 caract\u00e8res)\n        currency=\"Ar\",                          # Devise (Ar par d\u00e9faut)\n        requesting_organisation_transaction_reference=\"REF123456\",  # R\u00e9f\u00e9rence unique (optionnel)\n        original_transaction_reference=\"\",       # R\u00e9f\u00e9rence de transaction originale (optionnel)\n        foreign_currency=\"USD\",                  # Devise \u00e9trang\u00e8re (optionnel)\n        foreign_amount=\"2.5\",                    # Montant en devise \u00e9trang\u00e8re (optionnel)\n        callback_url=\"https://example.com/callback\",  # URL de notification (optionnel)\n        correlation_id=None,                     # ID de corr\u00e9lation (g\u00e9n\u00e9r\u00e9 automatiquement si non fourni)\n        user_language=\"FR\"                       # Langue (FR ou MG)\n    )\n\n    # R\u00e9cup\u00e9rer les informations importantes\n    server_correlation_id = transaction_info['response']['serverCorrelationId']\n    status = transaction_info['response']['status']  # G\u00e9n\u00e9ralement \"pending\" \u00e0 ce stade\n    notification_method = transaction_info['response']['notificationMethod']  # \"callback\" ou \"polling\"\n\n    print(f\"Transaction initi\u00e9e avec succ\u00e8s. ID: {server_correlation_id}\")\n    print(f\"Statut initial: {status}\")\n    print(f\"M\u00e9thode de notification: {notification_method}\")\n\nexcept Exception as e:\n    print(f\"Erreur lors de l'initiation du paiement: {e}\")\n</code></pre>"},{"location":"api-reference/transaction/#verifier-le-statut-dune-transaction","title":"V\u00e9rifier le statut d'une transaction","text":"<pre><code>try:\n    status_info = transaction.get_transaction_status(\n        server_correlation_id=\"correlation-id-12345\",  # ID de corr\u00e9lation re\u00e7u lors de l'initiation\n        correlation_id=None,  # ID de corr\u00e9lation pour cette requ\u00eate (optionnel)\n        user_language=\"FR\"    # Langue (FR ou MG)\n    )\n\n    status = status_info['response']['status']\n    print(f\"Statut de la transaction: {status}\")  # pending, completed, ou failed\n\n    # Si la transaction est compl\u00e9t\u00e9e, l'ID de transaction sera disponible\n    if status == \"completed\" and 'objectReference' in status_info['response']:\n        transaction_id = status_info['response']['objectReference']\n        print(f\"ID de transaction: {transaction_id}\")\n\nexcept Exception as e:\n    print(f\"Erreur lors de la v\u00e9rification du statut: {e}\")\n</code></pre>"},{"location":"api-reference/transaction/#recuperer-les-details-dune-transaction","title":"R\u00e9cup\u00e9rer les d\u00e9tails d'une transaction","text":"<pre><code>try:\n    transaction_details = transaction.get_transaction_details(\n        transaction_id=\"transaction-id-12345\",  # ID de transaction obtenu apr\u00e8s compl\u00e9tion\n        correlation_id=None,  # ID de corr\u00e9lation pour cette requ\u00eate (optionnel)\n        user_language=\"FR\"    # Langue (FR ou MG)\n    )\n\n    details = transaction_details['response']\n    print(f\"Montant: {details.get('amount')} {details.get('currency')}\")\n    print(f\"Statut: {details.get('transactionStatus')}\")\n    print(f\"R\u00e9f\u00e9rence: {details.get('transactionReference')}\")\n    print(f\"Date: {details.get('createDate')}\")\n\n    # Informations sur le d\u00e9biteur et le cr\u00e9diteur\n    debit_party = next((party for party in details.get('debitParty', []) if party.get('key') == 'msisdn'), {})\n    credit_party = next((party for party in details.get('creditParty', []) if party.get('key') == 'msisdn'), {})\n\n    print(f\"D\u00e9biteur: {debit_party.get('value')}\")\n    print(f\"Cr\u00e9diteur: {credit_party.get('value')}\")\n\n    # Frais de transaction\n    fee = next((f for f in details.get('fee', [])), {})\n    print(f\"Frais: {fee.get('feeAmount')}\")\n\nexcept Exception as e:\n    print(f\"Erreur lors de la r\u00e9cup\u00e9ration des d\u00e9tails: {e}\")\n</code></pre>"},{"location":"api-reference/transaction/#structure-des-donnees-de-transaction","title":"Structure des donn\u00e9es de transaction","text":""},{"location":"api-reference/transaction/#requete-dinitiation-de-paiement","title":"Requ\u00eate d'initiation de paiement","text":"<pre><code>headers = {\n    \"Authorization\": \"Bearer &lt;ACCESS_TOKEN&gt;\",\n    \"Version\": \"1.0\",\n    \"X-CorrelationID\": \"&lt;ID_CORRELATION&gt;\",\n    \"UserLanguage\": \"FR\",  # ou \"MG\"\n    \"UserAccountIdentifier\": \"msisdn;&lt;MSISDN_PARTENAIRE&gt;\",\n    \"partnerName\": \"&lt;NOM_PARTENAIRE&gt;\",\n    \"Content-Type\": \"application/json\",\n    \"Cache-Control\": \"no-cache\"\n}\n\npayload = {\n    \"amount\": \"1000\",\n    \"currency\": \"Ar\",\n    \"descriptionText\": \"Description du paiement\",\n    \"requestDate\": \"2023-07-24T10:15:30.000Z\",\n    \"requestingOrganisationTransactionReference\": \"REF123456\",\n    \"originalTransactionReference\": \"\",\n    \"debitParty\": [{\"key\": \"msisdn\", \"value\": \"0343500003\"}],\n    \"creditParty\": [{\"key\": \"msisdn\", \"value\": \"0343500004\"}],\n    \"metadata\": [\n        {\"key\": \"partnerName\", \"value\": \"NomPartenaire\"},\n        {\"key\": \"fc\", \"value\": \"USD\"},  # Optionnel - devise \u00e9trang\u00e8re\n        {\"key\": \"amountFc\", \"value\": \"2.5\"}  # Optionnel - montant en devise \u00e9trang\u00e8re\n    ]\n}\n</code></pre>"},{"location":"api-reference/transaction/#reponse-dinitiation-de-paiement","title":"R\u00e9ponse d'initiation de paiement","text":"<pre><code>{\n    \"status\": \"pending\",                 # Statut initial (toujours \"pending\")\n    \"serverCorrelationId\": \"421a22a2-ef1d-42bc-9452-f4939a3d5cdf\",  # ID de corr\u00e9lation\n    \"notificationMethod\": \"polling\"      # M\u00e9thode de notification (polling ou callback)\n}\n</code></pre>"},{"location":"api-reference/transaction/#reponse-de-statut-de-transaction","title":"R\u00e9ponse de statut de transaction","text":"<pre><code>{\n    \"status\": \"completed\",              # pending, completed, ou failed\n    \"serverCorrelationId\": \"421a22a2-ef1d-42bc-9452-f4939a3d5cdf\",\n    \"notificationMethod\": \"polling\",\n    \"objectReference\": \"transactionID123\"  # Disponible uniquement si status = \"completed\"\n}\n</code></pre>"},{"location":"api-reference/transaction/#reponse-de-details-de-transaction","title":"R\u00e9ponse de d\u00e9tails de transaction","text":"<pre><code>{\n    \"amount\": \"1000\",\n    \"currency\": \"Ar\",\n    \"transactionReference\": \"transactionID123\",\n    \"transactionStatus\": \"completed\",    # ou \"failed\"\n    \"createDate\": \"2023-07-24T10:15:30.000Z\",\n    \"debitParty\": [\n        {\"key\": \"msisdn\", \"value\": \"0343500003\"}\n    ],\n    \"creditParty\": [\n        {\"key\": \"msisdn\", \"value\": \"0343500004\"}\n    ],\n    \"fee\": [\n        {\"feeAmount\": \"20\"}\n    ],\n    \"metadata\": [\n        {\"key\": \"originalTransactionResult\", \"value\": \"0\"},\n        {\"key\": \"originalTransactionResultDesc\", \"value\": \"Success\"}\n    ]\n}\n</code></pre>"},{"location":"api-reference/transaction/#reponse-de-callback-succes","title":"R\u00e9ponse de callback (succ\u00e8s)","text":"<pre><code>{\n    \"transactionStatus\": \"completed\",\n    \"serverCorrelationId\": \"421a22a2-ef1d-42bc-9452-f4939a3d5cdf\",\n    \"transactionReference\": \"641235\",\n    \"requestDate\": \"2023-07-24T10:15:30.000Z\",\n    \"debitParty\": [\n        {\"key\": \"msisdn\", \"value\": \"0343500003\"}\n    ],\n    \"creditParty\": [\n        {\"key\": \"msisdn\", \"value\": \"0343500004\"}\n    ],\n    \"fees\": [\n        {\"feeAmount\": \"20\"}\n    ],\n    \"metadata\": [\n        {\"key\": \"string\", \"value\": \"string\"}\n    ]\n}\n</code></pre>"},{"location":"api-reference/transaction/#reponse-de-callback-echec","title":"R\u00e9ponse de callback (\u00e9chec)","text":"<pre><code>{\n    \"transactionStatus\": \"failed\",\n    \"serverCorrelationId\": \"421a22a2-ef1d-42bc-9452-f4939a3d5cdf\",\n    \"transactionReference\": \"641235\",\n    \"requestDate\": \"2023-07-24T10:15:30.000Z\",\n    \"debitParty\": [\n        {\"key\": \"msisdn\", \"value\": \"0343500003\"}\n    ],\n    \"creditParty\": [\n        {\"key\": \"msisdn\", \"value\": \"0343500004\"}\n    ],\n    \"metadata\": [\n        {\"key\": \"string\", \"value\": \"string\"}\n    ]\n}\n</code></pre>"},{"location":"api-reference/transaction/#validation-des-donnees","title":"Validation des donn\u00e9es","text":"<p>Le module de transaction effectue une validation approfondie des donn\u00e9es avant d'envoyer des requ\u00eates \u00e0 l'API MVola:</p> <pre><code># Validation du montant\n# - Doit \u00eatre un nombre positif\n\n# Validation de la description\n# - Max 50 caract\u00e8res\n# - Seuls les caract\u00e8res suivants sont autoris\u00e9s: alphanum\u00e9riques, espace, tiret, point, underscore, virgule\n\n# Validation des num\u00e9ros MSISDN\n# - Format national malgache (034XXXXXXX, etc.)\n</code></pre>"},{"location":"api-reference/transaction/#endpoints-des-transactions","title":"Endpoints des transactions","text":"<p>Le module utilise les endpoints suivants:</p> <p>Sandbox: - Initiation de paiement: <code>https://devapi.mvola.mg/mvola/mm/transactions/type/merchantpay/1.0.0/</code> - V\u00e9rification de statut: <code>https://devapi.mvola.mg/mvola/mm/transactions/type/merchantpay/1.0.0/status/{serverCorrelationId}</code> - D\u00e9tails de transaction: <code>https://devapi.mvola.mg/mvola/mm/transactions/type/merchantpay/1.0.0/{transactionId}</code></p> <p>Production: - Initiation de paiement: <code>https://api.mvola.mg/mvola/mm/transactions/type/merchantpay/1.0.0/</code> - V\u00e9rification de statut: <code>https://api.mvola.mg/mvola/mm/transactions/type/merchantpay/1.0.0/status/{serverCorrelationId}</code> - D\u00e9tails de transaction: <code>https://api.mvola.mg/mvola/mm/transactions/type/merchantpay/1.0.0/{transactionId}</code></p>"},{"location":"api-reference/transaction/#codes-derreur-http","title":"Codes d'erreur HTTP","text":"<p>L'API utilise les codes d'erreur HTTP standard:</p> <ul> <li>200 - OK: Tout a fonctionn\u00e9 comme pr\u00e9vu.</li> <li>400 - Bad Request: La requ\u00eate est inacceptable, souvent en raison d'un param\u00e8tre manquant.</li> <li>401 - Unauthorized: Aucune cl\u00e9 API valide fournie.</li> <li>402 - Request Failed: Les param\u00e8tres \u00e9taient valides mais la requ\u00eate a \u00e9chou\u00e9.</li> <li>403 - Forbidden: La cl\u00e9 API n'a pas les permissions pour effectuer la requ\u00eate.</li> <li>404 - Not Found: La ressource demand\u00e9e n'existe pas.</li> <li>409 - Conflict: La requ\u00eate est en conflit avec une autre requ\u00eate.</li> <li>429 - Too Many Requests: Trop de requ\u00eates envoy\u00e9es \u00e0 l'API trop rapidement.</li> <li>500, 502, 503, 504 - Server Errors: Une erreur s'est produite sur le serveur.</li> </ul>"},{"location":"api-reference/transaction/#format-derreur-dauthentification","title":"Format d'erreur d'authentification","text":"<pre><code>{\n    \"fault\": {\n        \"code\": 900901,\n        \"message\": \"Invalid Credentials\",\n        \"description\": \"Invalid Credentials. Make sure you have given the correct access token\"\n    }\n}\n</code></pre>"},{"location":"api-reference/transaction/#bonnes-pratiques","title":"Bonnes pratiques","text":"<ol> <li> <p>G\u00e9n\u00e9rez des r\u00e9f\u00e9rences uniques pour chaque transaction. Utilisez le param\u00e8tre <code>requesting_organisation_transaction_reference</code> pour faciliter le suivi c\u00f4t\u00e9 client.</p> </li> <li> <p>Stockez les IDs de corr\u00e9lation retourn\u00e9s par l'API (<code>serverCorrelationId</code>) pour v\u00e9rifier le statut ult\u00e9rieurement.</p> </li> <li> <p>Impl\u00e9mentez un syst\u00e8me de retry pour v\u00e9rifier le statut des transactions jusqu'\u00e0 ce qu'elles soient termin\u00e9es.</p> </li> <li> <p>Utilisez les webhooks (URL de callback) lorsque c'est possible, plut\u00f4t que de faire des sondages r\u00e9p\u00e9t\u00e9s.</p> </li> <li> <p>V\u00e9rifiez toujours le statut final d'une transaction avant de consid\u00e9rer un paiement comme r\u00e9ussi.</p> </li> <li> <p>Validez la description en vous assurant qu'elle ne d\u00e9passe pas 50 caract\u00e8res et qu'elle ne contient que les caract\u00e8res autoris\u00e9s.</p> </li> <li> <p>Utilisez l'environnement sandbox avec les num\u00e9ros de test (0343500003 et 0343500004) pour vos d\u00e9veloppements.</p> </li> </ol>"},{"location":"api-reference/transaction/#voir-aussi","title":"Voir aussi","text":"<ul> <li>Guide des transactions - Guide complet sur les transactions MVola</li> <li>R\u00e9f\u00e9rence MVolaClient - Documentation de la classe principale qui utilise MVolaTransaction</li> <li>Gestion des Webhooks - Comment g\u00e9rer les notifications de transaction </li> </ul>"},{"location":"api-reference/utils/","title":"R\u00e9f\u00e9rence des utilitaires","text":"<p>Le module <code>mvola_api.utils</code> fournit un ensemble de fonctions utilitaires et d'outils pour faciliter l'utilisation de la biblioth\u00e8que MVola API. Ces utilitaires vous aident \u00e0 formater les donn\u00e9es, valider les param\u00e8tres, g\u00e9rer les num\u00e9ros de t\u00e9l\u00e9phone et plus encore.</p>"},{"location":"api-reference/utils/#fonctions-utilitaires","title":"Fonctions utilitaires","text":"<p>Ce module contient plusieurs fonctions utilitaires qui vous aident \u00e0 travailler avec l'API MVola.</p>"},{"location":"api-reference/utils/#validation-des-numeros-de-telephone","title":"Validation des num\u00e9ros de t\u00e9l\u00e9phone","text":"<pre><code>from mvola_api.utils import validate_msisdn, format_msisdn\n\n# Validation d'un num\u00e9ro de t\u00e9l\u00e9phone\ntry:\n    # V\u00e9rifie si le format du num\u00e9ro est valide\n    validate_msisdn(\"0343500003\")  # Valide\n    validate_msisdn(\"0343500004\")  # Valide\n    validate_msisdn(\"0340000\")     # L\u00e8ve MVolaValidationError (trop court)\n    validate_msisdn(\"abcdefghij\")  # L\u00e8ve MVolaValidationError (format invalide)\nexcept Exception as e:\n    print(f\"Num\u00e9ro invalide: {e}\")\n\n# Formatage du num\u00e9ro de t\u00e9l\u00e9phone au format requis par l'API\nformatted_number = format_msisdn(\"0343500003\")\nprint(formatted_number)  # Affiche: 0343500003\n</code></pre>"},{"location":"api-reference/utils/#validation-du-texte-de-description","title":"Validation du texte de description","text":"<pre><code>from mvola_api.utils import validate_description\n\n# Validation de la description des transactions\ntry:\n    # V\u00e9rification du texte de description (max 50 caract\u00e8res et caract\u00e8res sp\u00e9ciaux limit\u00e9s)\n    validate_description(\"Paiement pour produit ABC\")  # Valide\n    validate_description(\"Paiement avec tiret-underscore_point.\")  # Valide\n    validate_description(\"Texte avec virgule, et espace\")  # Valide\n\n    # Invalides :\n    validate_description(\"Texte avec caract\u00e8re sp\u00e9cial interdit ! @ # $ % ^ &amp; * ( )\")  # L\u00e8ve MVolaValidationError\n    validate_description(\"Texte beaucoup trop long qui d\u00e9passe largement la limite de 50 caract\u00e8res impos\u00e9e par l'API MVola\")  # L\u00e8ve MVolaValidationError\nexcept Exception as e:\n    print(f\"Description invalide: {e}\")\n</code></pre>"},{"location":"api-reference/utils/#generation-didentifiants","title":"G\u00e9n\u00e9ration d'identifiants","text":"<pre><code>from mvola_api.utils import generate_correlation_id, generate_reference\n\n# G\u00e9n\u00e9ration d'un ID de corr\u00e9lation unique (UUID v4)\ncorrelation_id = generate_correlation_id()\nprint(correlation_id)  # Ex: 550e8400-e29b-41d4-a716-446655440000\n\n# G\u00e9n\u00e9ration d'une r\u00e9f\u00e9rence unique pour les transactions\nreference = generate_reference(prefix=\"PAY\")\nprint(reference)  # Ex: PAY-12AB34CD\n</code></pre>"},{"location":"api-reference/utils/#formatage-de-donnees","title":"Formatage de donn\u00e9es","text":"<pre><code>from mvola_api.utils import format_date\n\n# Formatage de la date au format ISO 8601 requis par l'API\niso_date = format_date()  # Utilise la date et heure actuelles\nprint(iso_date)  # Ex: 2023-07-24T10:15:30.000Z\n\n# Formatage avec une date sp\u00e9cifique\nfrom datetime import datetime\nspecific_date = datetime(2023, 1, 1, 12, 0, 0)\nformatted_date = format_date(specific_date)\nprint(formatted_date)  # \"2023-01-01T12:00:00.000Z\"\n</code></pre>"},{"location":"api-reference/utils/#validation-des-parametres","title":"Validation des param\u00e8tres","text":"<pre><code>from mvola_api.utils import validate_required_params\n\n# Validation des param\u00e8tres requis\ndata = {\n    \"param1\": \"value1\",\n    \"param2\": None,\n    \"param3\": \"value3\"\n}\n\nrequired_params = [\"param1\", \"param2\", \"param4\"]\n\ntry:\n    # V\u00e9rifie si tous les param\u00e8tres requis sont pr\u00e9sents et non None\n    validate_required_params(data, required_params)\nexcept Exception as e:\n    print(f\"Param\u00e8tres manquants: {e}\")\n    # Affiche: \"Param\u00e8tres manquants: Les param\u00e8tres suivants sont requis: param2, param4\"\n</code></pre>"},{"location":"api-reference/utils/#construction-des-en-tetes-pour-les-requetes-api","title":"Construction des en-t\u00eates pour les requ\u00eates API","text":"<pre><code>from mvola_api.utils import build_headers\n\n# Construction des en-t\u00eates pour les requ\u00eates API\nheaders = build_headers(\n    access_token=\"votre_token_d_acces\",\n    correlation_id=\"550e8400-e29b-41d4-a716-446655440000\",\n    user_language=\"FR\",\n    partner_name=\"NomPartenaire\",\n    partner_msisdn=\"0343500003\"\n)\n\nprint(headers)\n# Affiche:\n# {\n#     \"Authorization\": \"Bearer votre_token_d_acces\",\n#     \"Version\": \"1.0\",\n#     \"X-CorrelationID\": \"550e8400-e29b-41d4-a716-446655440000\",\n#     \"UserLanguage\": \"FR\",\n#     \"UserAccountIdentifier\": \"msisdn;0343500003\",\n#     \"partnerName\": \"NomPartenaire\",\n#     \"Content-Type\": \"application/json\",\n#     \"Cache-Control\": \"no-cache\"\n# }\n</code></pre>"},{"location":"api-reference/utils/#preparation-des-donnees-pour-les-requetes-api","title":"Pr\u00e9paration des donn\u00e9es pour les requ\u00eates API","text":"<pre><code>from mvola_api.utils import prepare_transaction_request\n\n# Pr\u00e9paration des donn\u00e9es pour une requ\u00eate de transaction\ntransaction_data = prepare_transaction_request(\n    amount=\"1000\",\n    currency=\"Ar\",\n    description=\"Paiement produit\",\n    debit_msisdn=\"0343500003\",\n    credit_msisdn=\"0343500004\",\n    partner_name=\"NomPartenaire\",\n    requesting_organisation_transaction_reference=\"REF123456\",\n    original_transaction_reference=\"\",\n    foreign_currency=\"USD\",\n    foreign_amount=\"2.5\"\n)\n\nprint(transaction_data)\n# Affiche:\n# {\n#     \"amount\": \"1000\",\n#     \"currency\": \"Ar\",\n#     \"descriptionText\": \"Paiement produit\",\n#     \"requestDate\": \"2023-07-24T10:15:30.000Z\",\n#     \"requestingOrganisationTransactionReference\": \"REF123456\",\n#     \"originalTransactionReference\": \"\",\n#     \"debitParty\": [{\"key\": \"msisdn\", \"value\": \"0343500003\"}],\n#     \"creditParty\": [{\"key\": \"msisdn\", \"value\": \"0343500004\"}],\n#     \"metadata\": [\n#         {\"key\": \"partnerName\", \"value\": \"NomPartenaire\"},\n#         {\"key\": \"fc\", \"value\": \"USD\"},\n#         {\"key\": \"amountFc\", \"value\": \"2.5\"}\n#     ]\n# }\n</code></pre>"},{"location":"api-reference/utils/#configuration-du-logging","title":"Configuration du logging","text":"<pre><code>from mvola_api.utils import setup_logger\nimport logging\n\n# Configuration du logger par d\u00e9faut\nlogger = setup_logger()\nlogger.info(\"Message d'information\")\nlogger.error(\"Message d'erreur\")\n\n# Configuration personnalis\u00e9e\ncustom_logger = setup_logger(\n    name=\"custom_logger\",\n    level=logging.DEBUG,\n    log_format=\"%(asctime)s - %(name)s - %(levelname)s - %(message)s\",\n    log_file=\"mvola.log\"  # Optionnel\n)\n\ncustom_logger.debug(\"Message de d\u00e9bogage\")\n</code></pre>"},{"location":"api-reference/utils/#gestion-des-requetes-http","title":"Gestion des requ\u00eates HTTP","text":"<pre><code>from mvola_api.utils import make_api_request\nimport requests\n\n# Effectuer une requ\u00eate API avec gestion d'erreurs\ntry:\n    response = make_api_request(\n        method=\"POST\",\n        url=\"https://devapi.mvola.mg/mvola/mm/transactions/type/merchantpay/1.0.0/\",\n        headers={\n            \"Authorization\": \"Bearer token\",\n            \"Version\": \"1.0\",\n            \"X-CorrelationID\": \"550e8400-e29b-41d4-a716-446655440000\",\n            \"Content-Type\": \"application/json\"\n        },\n        json={\n            \"amount\": \"1000\",\n            \"currency\": \"Ar\",\n            \"descriptionText\": \"Paiement produit\"\n            # Autres champs...\n        },\n        timeout=30\n    )\n\n    # Traiter la r\u00e9ponse\n    print(f\"Statut: {response.status_code}\")\n    print(f\"R\u00e9ponse: {response.json()}\")\n\nexcept Exception as e:\n    print(f\"Erreur lors de la requ\u00eate: {e}\")\n</code></pre>"},{"location":"api-reference/utils/#outils-de-debogage","title":"Outils de d\u00e9bogage","text":"<pre><code>from mvola_api.utils import debug_request, debug_response\n\n# Afficher les d\u00e9tails d'une requ\u00eate HTTP pour le d\u00e9bogage\ndebug_request(\n    method=\"POST\",\n    url=\"https://devapi.mvola.mg/mvola/mm/transactions/type/merchantpay/1.0.0/\",\n    headers={\n        \"Authorization\": \"Bearer token\", \n        \"Content-Type\": \"application/json\"\n    },\n    data={\n        \"amount\": \"1000\",\n        \"currency\": \"Ar\"\n    }\n)\n\n# Afficher les d\u00e9tails d'une r\u00e9ponse HTTP pour le d\u00e9bogage\nresponse = requests.post(\n    \"https://devapi.mvola.mg/mvola/mm/transactions/type/merchantpay/1.0.0/\",\n    headers={\"Authorization\": \"Bearer token\"},\n    json={\"amount\": \"1000\"}\n)\ndebug_response(response)\n</code></pre>"},{"location":"api-reference/utils/#utilitaires-de-securite","title":"Utilitaires de s\u00e9curit\u00e9","text":"<pre><code>from mvola_api.utils import encode_credentials, mask_sensitive_data\n\n# Encodage des identifiants en Base64 pour l'authentification\nencoded = encode_credentials(\"consumer_key\", \"consumer_secret\")\nprint(encoded)  # Cha\u00eene encod\u00e9e en Base64\n\n# Masquage des donn\u00e9es sensibles pour la journalisation\ndata = {\n    \"consumer_key\": \"my_consumer_key\",\n    \"consumer_secret\": \"my_consumer_secret\",\n    \"debitParty\": [{\"key\": \"msisdn\", \"value\": \"0343500003\"}],\n    \"amount\": \"1000\"\n}\n\nmasked_data = mask_sensitive_data(data)\nprint(masked_data)\n# Affiche: {'consumer_key': '***', 'consumer_secret': '***', 'debitParty': [{'key': 'msisdn', 'value': '0343******'}], 'amount': '1000'}\n</code></pre>"},{"location":"api-reference/utils/#analyse-des-reponses","title":"Analyse des r\u00e9ponses","text":"<pre><code>from mvola_api.utils import extract_transaction_info, parse_api_response\n\n# Extraire les informations d'une transaction \u00e0 partir d'une r\u00e9ponse\nresponse_data = {\n    \"amount\": \"1000\",\n    \"currency\": \"Ar\",\n    \"transactionReference\": \"transactionID123\",\n    \"transactionStatus\": \"completed\"\n}\n\ntransaction_info = extract_transaction_info(response_data)\nprint(f\"Montant: {transaction_info['amount']}\")\nprint(f\"Statut: {transaction_info['status']}\")\n\n# Analyser une r\u00e9ponse d'API compl\u00e8te\nresponse = requests.post(\n    \"https://devapi.mvola.mg/mvola/mm/transactions/type/merchantpay/1.0.0/\",\n    headers={\"Authorization\": \"Bearer token\"},\n    json={\"amount\": \"1000\"}\n)\n\nparsed_response = parse_api_response(response)\nprint(f\"Statut HTTP: {parsed_response['status_code']}\")\nprint(f\"Corps de la r\u00e9ponse: {parsed_response['response']}\")\nprint(f\"En-t\u00eates: {parsed_response['headers']}\")\n</code></pre>"},{"location":"api-reference/utils/#bonnes-pratiques","title":"Bonnes pratiques","text":"<ol> <li> <p>Validez les num\u00e9ros de t\u00e9l\u00e9phone : Utilisez <code>validate_msisdn</code> pour vous assurer que les num\u00e9ros sont au format correct avant d'effectuer des transactions.</p> </li> <li> <p>Validez les descriptions : Utilisez <code>validate_description</code> pour vous assurer que les descriptions respectent les contraintes de l'API MVola (50 caract\u00e8res max, caract\u00e8res sp\u00e9ciaux limit\u00e9s).</p> </li> <li> <p>G\u00e9n\u00e9rez des r\u00e9f\u00e9rences uniques : Utilisez <code>generate_reference</code> pour cr\u00e9er des r\u00e9f\u00e9rences de transaction uniques et tra\u00e7ables.</p> </li> <li> <p>Utilisez le logging : Configurez un logger avec <code>setup_logger</code> pour faciliter le d\u00e9bogage et le suivi des op\u00e9rations.</p> </li> <li> <p>Masquez les donn\u00e9es sensibles : Utilisez <code>mask_sensitive_data</code> avant de journaliser des informations qui pourraient contenir des donn\u00e9es confidentielles.</p> </li> <li> <p>Gestion des erreurs HTTP : Utilisez <code>make_api_request</code> qui g\u00e8re les erreurs HTTP communes et transforme les r\u00e9ponses d'erreur en exceptions Python compr\u00e9hensibles.</p> </li> </ol>"},{"location":"api-reference/utils/#voir-aussi","title":"Voir aussi","text":"<ul> <li>Guide des transactions - Voir comment ces utilitaires sont utilis\u00e9s dans les transactions</li> <li>R\u00e9f\u00e9rence du client - Documentation de la classe principale qui utilise ces utilitaires</li> <li>Gestion des erreurs - Comment les utilitaires contribuent \u00e0 la gestion des erreurs </li> </ul>"},{"location":"examples/basic-usage/","title":"Utilisation basique","text":"<p>Ce guide fournit des exemples simples d'utilisation de la biblioth\u00e8que MVola API.</p>"},{"location":"examples/basic-usage/#installation","title":"Installation","text":"<p>Commencez par installer la biblioth\u00e8que :</p> <pre><code> pip install mvola-api-lib\n</code></pre>"},{"location":"examples/basic-usage/#initialisation","title":"Initialisation","text":"<p>Pour commencer \u00e0 utiliser la biblioth\u00e8que MVola API, vous devez d'abord initialiser un client :</p> <pre><code>from mvola_api import MVolaClient\n\n# Initialisation pour l'environnement sandbox (d\u00e9veloppement)\nclient = MVolaClient(\n    consumer_key=\"votre_consumer_key\",\n    consumer_secret=\"votre_consumer_secret\",\n    partner_name=\"Nom de votre application\",\n    partner_msisdn=\"0343500003\",  # Votre num\u00e9ro MVola\n    base_url=\"https://devapi.mvola.mg\"  # URL de l'API sandbox\n)\n\n# Initialisation pour l'environnement de production\nprod_client = MVolaClient(\n    consumer_key=\"votre_consumer_key_prod\",\n    consumer_secret=\"votre_consumer_secret_prod\",\n    partner_name=\"Nom de votre application\",\n    partner_msisdn=\"0343500003\",  # Votre num\u00e9ro MVola\n    base_url=\"https://api.mvola.mg\"  # URL de l'API de production\n)\n</code></pre>"},{"location":"examples/basic-usage/#generation-dun-token","title":"G\u00e9n\u00e9ration d'un token","text":"<p>La biblioth\u00e8que g\u00e8re automatiquement les tokens d'authentification, mais vous pouvez \u00e9galement g\u00e9n\u00e9rer un token manuellement :</p> <pre><code># G\u00e9n\u00e9rer un token d'authentification\ntoken = client.generate_token()\nprint(f\"Token: {token['access_token']}\")\nprint(f\"Expire dans: {token['expires_in']} secondes\")\nprint(f\"Type: {token['token_type']}\")\nprint(f\"Scope: {token['scope']}\")\n\n# Obtenir directement le token d'acc\u00e8s (la m\u00e9thode g\u00e9n\u00e8re un nouveau token si n\u00e9cessaire)\naccess_token = client.get_access_token()\nprint(f\"Token d'acc\u00e8s: {access_token}\")\n</code></pre>"},{"location":"examples/basic-usage/#initier-un-paiement","title":"Initier un paiement","text":"<p>Pour initier un paiement MVola :</p> <pre><code>try:\n    transaction_info = client.initiate_merchant_payment(\n        amount=\"1000\",                           # Montant en ariary (cha\u00eene)\n        debit_msisdn=\"0343500003\",               # Num\u00e9ro qui paie\n        credit_msisdn=\"0343500004\",              # Num\u00e9ro qui re\u00e7oit\n        description=\"Paiement pour produit ABC\", # Description (max 50 caract\u00e8res)\n        currency=\"Ar\",                           # Devise (Ar par d\u00e9faut)\n        requesting_organisation_transaction_reference=\"REF123456\",  # R\u00e9f\u00e9rence unique (optionnel)\n        callback_url=\"https://example.com/callback\"  # URL de notification (optionnel)\n    )\n\n    # R\u00e9cup\u00e9rer les informations importantes\n    server_correlation_id = transaction_info['response']['serverCorrelationId']\n    status = transaction_info['response']['status']  # G\u00e9n\u00e9ralement \"pending\" \u00e0 ce stade\n    notification_method = transaction_info['response']['notificationMethod']  # \"callback\" ou \"polling\"\n\n    print(f\"Transaction initi\u00e9e avec succ\u00e8s. ID: {server_correlation_id}\")\n    print(f\"Statut initial: {status}\")\n    print(f\"M\u00e9thode de notification: {notification_method}\")\n\nexcept Exception as e:\n    print(f\"Erreur lors de l'initiation du paiement: {e}\")\n</code></pre>"},{"location":"examples/basic-usage/#verifier-le-statut-dune-transaction","title":"V\u00e9rifier le statut d'une transaction","text":"<p>Pour v\u00e9rifier le statut d'une transaction en cours :</p> <pre><code>try:\n    status_info = client.get_transaction_status(\n        server_correlation_id=\"server-correlation-id-12345\"  # ID obtenu lors de l'initiation\n    )\n\n    status = status_info['response']['status']\n    print(f\"Statut de la transaction: {status}\")  # pending, completed, ou failed\n\n    # \u00c9tats possibles : pending, completed, failed\n    if status == 'completed' and 'objectReference' in status_info['response']:\n        transaction_id = status_info['response']['objectReference']\n        print(f\"Transaction r\u00e9ussie! ID de transaction: {transaction_id}\")\n    elif status == 'pending':\n        print(\"Transaction en attente de confirmation...\")\n    else:\n        print(f\"Transaction termin\u00e9e avec statut: {status}\")\n\nexcept Exception as e:\n    print(f\"Erreur lors de la v\u00e9rification du statut: {e}\")\n</code></pre>"},{"location":"examples/basic-usage/#recuperer-les-details-dune-transaction","title":"R\u00e9cup\u00e9rer les d\u00e9tails d'une transaction","text":"<p>Pour obtenir tous les d\u00e9tails d'une transaction termin\u00e9e :</p> <pre><code>try:\n    # Note: Vous avez besoin de l'ID de transaction (objectReference) et non du server_correlation_id\n    transaction_details = client.get_transaction_details(\n        transaction_id=\"transaction-id-12345\"  # ID obtenu apr\u00e8s compl\u00e9tion\n    )\n\n    details = transaction_details['response']\n    print(f\"Montant: {details.get('amount')} {details.get('currency')}\")\n    print(f\"Statut: {details.get('transactionStatus')}\")\n    print(f\"R\u00e9f\u00e9rence: {details.get('transactionReference')}\")\n    print(f\"Date: {details.get('createDate')}\")\n\n    # Acc\u00e9der aux informations du payeur\n    debit_party = next((party for party in details.get('debitParty', []) if party.get('key') == 'msisdn'), {})\n    print(f\"Payeur: {debit_party.get('value')}\")\n\n    # Acc\u00e9der aux informations du b\u00e9n\u00e9ficiaire\n    credit_party = next((party for party in details.get('creditParty', []) if party.get('key') == 'msisdn'), {})\n    print(f\"B\u00e9n\u00e9ficiaire: {credit_party.get('value')}\")\n\n    # Acc\u00e9der aux frais\n    fee = next((f for f in details.get('fee', [])), {})\n    print(f\"Frais: {fee.get('feeAmount')}\")\n\nexcept Exception as e:\n    print(f\"Erreur lors de la r\u00e9cup\u00e9ration des d\u00e9tails: {e}\")\n</code></pre>"},{"location":"examples/basic-usage/#exemple-complet","title":"Exemple complet","text":"<p>Voici un exemple complet qui combine plusieurs op\u00e9rations :</p> <pre><code>from mvola_api import MVolaClient\nfrom mvola_api.exceptions import MVolaError, MVolaTransactionError\nimport uuid\nimport time\n\n# G\u00e9n\u00e9rer un ID de corr\u00e9lation unique pour cette session\ncorrelation_id = str(uuid.uuid4())\n\n# Initialisation du client\ntry:\n    client = MVolaClient(\n        consumer_key=\"votre_consumer_key\",\n        consumer_secret=\"votre_consumer_secret\",\n        partner_name=\"Nom de votre application\",\n        partner_msisdn=\"0343500003\",\n        base_url=\"https://devapi.mvola.mg\"\n    )\n\n    # G\u00e9n\u00e9rer une r\u00e9f\u00e9rence unique pour la transaction\n    reference = f\"REF-{uuid.uuid4().hex[:8].upper()}\"\n\n    # Initier un paiement\n    print(\"Initiation du paiement...\")\n    transaction_info = client.initiate_merchant_payment(\n        amount=\"1000\",\n        debit_msisdn=\"0343500003\",\n        credit_msisdn=\"0343500004\",\n        description=\"Paiement test\",\n        requesting_organisation_transaction_reference=reference,\n        correlation_id=correlation_id\n    )\n\n    server_correlation_id = transaction_info['response']['serverCorrelationId']\n    print(f\"Transaction initi\u00e9e avec succ\u00e8s!\")\n    print(f\"ID de corr\u00e9lation du serveur: {server_correlation_id}\")\n    print(f\"R\u00e9f\u00e9rence: {reference}\")\n\n    # V\u00e9rifier le statut initial\n    print(\"\\nV\u00e9rification du statut initial...\")\n    status_info = client.get_transaction_status(\n        server_correlation_id=server_correlation_id,\n        correlation_id=correlation_id\n    )\n\n    print(f\"Statut initial: {status_info['response']['status']}\")\n    print(\"Veuillez confirmer la transaction sur votre t\u00e9l\u00e9phone...\")\n\n    # Simuler une attente pour la confirmation\n    print(\"\\nAttente de la confirmation de la transaction (simulation)...\")\n    time.sleep(5)  # Attendre 5 secondes pour la simulation\n\n    # V\u00e9rifier \u00e0 nouveau le statut\n    print(\"\\nV\u00e9rification du statut apr\u00e8s confirmation...\")\n    status_info = client.get_transaction_status(\n        server_correlation_id=server_correlation_id,\n        correlation_id=correlation_id\n    )\n\n    status = status_info['response']['status']\n    print(f\"Statut actuel: {status}\")\n\n    # Si la transaction est compl\u00e9t\u00e9e, r\u00e9cup\u00e9rer les d\u00e9tails\n    if status == 'completed' and 'objectReference' in status_info['response']:\n        transaction_id = status_info['response']['objectReference']\n\n        print(\"\\nR\u00e9cup\u00e9ration des d\u00e9tails de la transaction...\")\n        details = client.get_transaction_details(\n            transaction_id=transaction_id,\n            correlation_id=correlation_id\n        )\n\n        print(f\"D\u00e9tails de la transaction:\")\n        print(f\"- Montant: {details['response'].get('amount')} {details['response'].get('currency')}\")\n        print(f\"- Statut: {details['response'].get('transactionStatus')}\")\n        print(f\"- Date: {details['response'].get('createDate')}\")\n\nexcept MVolaTransactionError as e:\n    print(f\"Erreur de transaction: {e}\")\n    if hasattr(e, 'field'):\n        print(f\"Champ en erreur: {e.field}\")\n\nexcept MVolaError as e:\n    print(f\"Erreur MVola: {e}\")\n    if hasattr(e, 'status_code'):\n        print(f\"Code HTTP: {e.status_code}\")\n\nexcept Exception as e:\n    print(f\"Erreur inattendue: {e}\")\n</code></pre>"},{"location":"examples/basic-usage/#gestion-avec-environnement-virtuel","title":"Gestion avec environnement virtuel","text":"<p>Pour une utilisation dans un projet, il est recommand\u00e9 de configurer un environnement virtuel :</p> <pre><code># Cr\u00e9er un environnement virtuel\npython -m venv venv\n\n# Activer l'environnement virtuel\n# Sur Windows\nvenv\\Scripts\\activate\n# Sur macOS/Linux\nsource venv/bin/activate\n\n# Installer la biblioth\u00e8que\n pip install mvola-api-lib\n</code></pre>"},{"location":"examples/basic-usage/#voir-aussi","title":"Voir aussi","text":"<ul> <li>Guide d'authentification - Guide complet sur l'authentification</li> <li>Guide des transactions - Guide complet sur les transactions</li> <li>Gestion des erreurs - Comment g\u00e9rer les erreurs efficacement</li> <li>Int\u00e9gration web - Exemples d'int\u00e9gration avec des frameworks web </li> </ul>"},{"location":"examples/web-integration/","title":"Int\u00e9gration Web","text":"<p>Ce guide explique comment int\u00e9grer la biblioth\u00e8que MVola API dans une application web en utilisant Flask comme exemple.</p>"},{"location":"examples/web-integration/#configuration-du-projet","title":"Configuration du projet","text":"<p>Avant de commencer, assurez-vous d'avoir install\u00e9 la biblioth\u00e8que MVola API ainsi que Flask :</p> <pre><code> pip install mvola-api-lib | flask python-dotenv\n</code></pre>"},{"location":"examples/web-integration/#structure-du-projet","title":"Structure du projet","text":"<p>Voici une structure de projet recommand\u00e9e pour une application web Flask avec MVola :</p> <pre><code>mvola-web-app/\n\u2502\n\u251c\u2500\u2500 app/\n\u2502   \u251c\u2500\u2500 __init__.py\n\u2502   \u251c\u2500\u2500 config.py\n\u2502   \u251c\u2500\u2500 models.py\n\u2502   \u251c\u2500\u2500 controllers/\n\u2502   \u2502   \u251c\u2500\u2500 __init__.py\n\u2502   \u2502   \u251c\u2500\u2500 payment_controller.py\n\u2502   \u2502   \u2514\u2500\u2500 webhook_controller.py\n\u2502   \u251c\u2500\u2500 services/\n\u2502   \u2502   \u251c\u2500\u2500 __init__.py\n\u2502   \u2502   \u2514\u2500\u2500 mvola_service.py\n\u2502   \u251c\u2500\u2500 static/\n\u2502   \u2502   \u251c\u2500\u2500 css/\n\u2502   \u2502   \u2514\u2500\u2500 js/\n\u2502   \u2514\u2500\u2500 templates/\n\u2502       \u251c\u2500\u2500 base.html\n\u2502       \u251c\u2500\u2500 index.html\n\u2502       \u2514\u2500\u2500 payment.html\n\u2502\n\u251c\u2500\u2500 .env\n\u251c\u2500\u2500 requirements.txt\n\u2514\u2500\u2500 run.py\n</code></pre>"},{"location":"examples/web-integration/#configuration-de-lapplication","title":"Configuration de l'application","text":"<p>Commen\u00e7ons par configurer l'application Flask.</p> <p>app/config.py:</p> <pre><code>import os\nfrom dotenv import load_dotenv\n\nload_dotenv()\n\nclass Config:\n    SECRET_KEY = os.environ.get('SECRET_KEY', 'dev-key-change-in-production')\n\n    # Configuration MVola\n    MVOLA_CONSUMER_KEY = os.environ.get('MVOLA_CONSUMER_KEY')\n    MVOLA_CONSUMER_SECRET = os.environ.get('MVOLA_CONSUMER_SECRET')\n    MVOLA_PARTNER_NAME = os.environ.get('MVOLA_PARTNER_NAME')\n    MVOLA_PARTNER_MSISDN = os.environ.get('MVOLA_PARTNER_MSISDN')\n    MVOLA_BASE_URL = os.environ.get('MVOLA_BASE_URL', 'https://devapi.mvola.mg')\n\n    # URL pour les webhooks (url publique)\n    WEBHOOK_BASE_URL = os.environ.get('WEBHOOK_BASE_URL', 'https://example.com')\n</code></pre> <p>app/init.py:</p> <pre><code>from flask import Flask\nfrom app.config import Config\n\ndef create_app(config_class=Config):\n    app = Flask(__name__)\n    app.config.from_object(config_class)\n\n    # Enregistrement des blueprints\n    from app.controllers.payment_controller import payment_bp\n    from app.controllers.webhook_controller import webhook_bp\n\n    app.register_blueprint(payment_bp)\n    app.register_blueprint(webhook_bp)\n\n    return app\n</code></pre>"},{"location":"examples/web-integration/#service-mvola","title":"Service MVola","text":"<p>Cr\u00e9ons un service qui encapsule notre logique d'interaction avec MVola.</p> <p>app/services/mvola_service.py:</p> <pre><code>import uuid\nimport logging\nfrom mvola_api import MVolaClient\nfrom mvola_api.exceptions import MVolaError, MVolaAuthError, MVolaTransactionError\n\nclass MVolaService:\n    def __init__(self, config):\n        self.logger = logging.getLogger('mvola_service')\n\n        self.client = MVolaClient(\n            consumer_key=config['MVOLA_CONSUMER_KEY'],\n            consumer_secret=config['MVOLA_CONSUMER_SECRET'],\n            partner_name=config['MVOLA_PARTNER_NAME'],\n            partner_msisdn=config['MVOLA_PARTNER_MSISDN'],\n            base_url=config['MVOLA_BASE_URL']\n        )\n\n        self.webhook_base_url = config['WEBHOOK_BASE_URL']\n\n    def generate_reference(self):\n        \"\"\"G\u00e9n\u00e8re une r\u00e9f\u00e9rence unique pour une transaction.\"\"\"\n        return f\"WEB-{uuid.uuid4().hex[:12].upper()}\"\n\n    def initiate_payment(self, amount, debit_msisdn, description, order_id=None):\n        \"\"\"\n        Initie un paiement MVola.\n\n        Args:\n            amount (str): Le montant \u00e0 payer (en cha\u00eene de caract\u00e8res)\n            debit_msisdn (str): Le MSISDN du client qui paie\n            description (str): Description du paiement (max 50 caract\u00e8res)\n            order_id (str, optional): Identifiant de commande pour le callback\n\n        Returns:\n            dict: Les informations de la transaction\n        \"\"\"\n        reference = self.generate_reference()\n\n        # Construire l'URL de callback avec l'ID de commande si fourni\n        callback_url = f\"{self.webhook_base_url}/webhooks/mvola/callback\"\n        if order_id:\n            callback_url = f\"{callback_url}?order_id={order_id}\"\n\n        try:\n            self.logger.info(f\"Initiation de paiement: {amount} Ar depuis {debit_msisdn}\")\n\n            transaction_info = self.client.initiate_merchant_payment(\n                amount=amount,\n                debit_msisdn=debit_msisdn,\n                credit_msisdn=self.client.partner_msisdn,\n                description=description,\n                requesting_organisation_transaction_reference=reference,\n                callback_url=callback_url\n            )\n\n            server_correlation_id = transaction_info['response']['serverCorrelationId']\n            self.logger.info(f\"Paiement initi\u00e9 avec succ\u00e8s. ID: {server_correlation_id}\")\n\n            # Stocker les infos de transaction avec l'ID de commande pour le suivi\n            return {\n                'server_correlation_id': server_correlation_id,\n                'reference': reference,\n                'amount': amount,\n                'debit_msisdn': debit_msisdn,\n                'status': 'pending',\n                'order_id': order_id\n            }\n\n        except MVolaError as e:\n            self.logger.error(f\"Erreur lors de l'initiation du paiement: {e}\")\n            raise\n\n    def check_transaction_status(self, server_correlation_id):\n        \"\"\"V\u00e9rifie le statut d'une transaction.\"\"\"\n        try:\n            status_info = self.client.get_transaction_status(\n                server_correlation_id=server_correlation_id\n            )\n\n            return status_info['response']\n\n        except MVolaError as e:\n            self.logger.error(f\"Erreur lors de la v\u00e9rification du statut: {e}\")\n            raise\n\n    def get_transaction_details(self, transaction_id):\n        \"\"\"R\u00e9cup\u00e8re les d\u00e9tails d'une transaction compl\u00e9t\u00e9e.\"\"\"\n        try:\n            details = self.client.get_transaction_details(\n                transaction_id=transaction_id\n            )\n\n            return details['response']\n\n        except MVolaError as e:\n            self.logger.error(f\"Erreur lors de la r\u00e9cup\u00e9ration des d\u00e9tails: {e}\")\n            raise\n\n## Contr\u00f4leur de paiement\n\nCr\u00e9ons le contr\u00f4leur qui g\u00e8re les routes pour l'interface utilisateur et le traitement des paiements.\n\n**app/controllers/payment_controller.py**:\n\n```python\nfrom flask import Blueprint, render_template, request, jsonify, current_app, redirect, url_for, flash, session\nfrom app.services.mvola_service import MVolaService\nfrom mvola_api.exceptions import MVolaError, MVolaValidationError\n\npayment_bp = Blueprint('payment', __name__)\n\n@payment_bp.route('/')\ndef index():\n    \"\"\"Page d'accueil avec formulaire de paiement.\"\"\"\n    return render_template('index.html')\n\n@payment_bp.route('/pay', methods=['POST'])\ndef process_payment():\n    \"\"\"Traite une demande de paiement.\"\"\"\n    form_data = request.form\n\n    # Validation des donn\u00e9es\n    if not form_data.get('amount') or not form_data.get('phone'):\n        flash('Veuillez fournir un montant et un num\u00e9ro de t\u00e9l\u00e9phone', 'danger')\n        return redirect(url_for('payment.index'))\n\n    try:\n        # Initialiser le service MVola\n        mvola_service = MVolaService(current_app.config)\n\n        # G\u00e9n\u00e9rer un ID de commande unique\n        order_id = str(uuid.uuid4())\n\n        # Stocker les informations de commande dans la session\n        session['order'] = {\n            'id': order_id,\n            'amount': form_data.get('amount'),\n            'phone': form_data.get('phone'),\n            'description': form_data.get('description', 'Paiement en ligne'),\n            'timestamp': datetime.now().isoformat()\n        }\n\n        # Initier le paiement\n        transaction = mvola_service.initiate_payment(\n            amount=form_data.get('amount'),\n            debit_msisdn=form_data.get('phone'),\n            description=form_data.get('description', 'Paiement en ligne'),\n            order_id=order_id\n        )\n\n        # Stocker l'ID de corr\u00e9lation pour le suivi\n        session['server_correlation_id'] = transaction['server_correlation_id']\n\n        # Rediriger vers la page de statut\n        return redirect(url_for('payment.payment_status', order_id=order_id))\n\n    except MVolaValidationError as e:\n        flash(f'Erreur de validation: {e}', 'danger')\n        return redirect(url_for('payment.index'))\n    except MVolaError as e:\n        flash(f'Erreur MVola: {e}', 'danger')\n        return redirect(url_for('payment.index'))\n    except Exception as e:\n        flash(f'Erreur inattendue: {e}', 'danger')\n        return redirect(url_for('payment.index'))\n\n@payment_bp.route('/status/&lt;order_id&gt;')\ndef payment_status(order_id):\n    \"\"\"Page de statut de paiement avec rafra\u00eechissement automatique.\"\"\"\n\n    # V\u00e9rifier si la commande existe dans la session\n    if 'order' not in session or session['order']['id'] != order_id:\n        flash('Commande introuvable', 'danger')\n        return redirect(url_for('payment.index'))\n\n    order = session['order']\n    server_correlation_id = session.get('server_correlation_id')\n\n    # Si pas d'ID de corr\u00e9lation, impossible de v\u00e9rifier le statut\n    if not server_correlation_id:\n        flash('Impossible de v\u00e9rifier le statut du paiement', 'danger')\n        return redirect(url_for('payment.index'))\n\n    try:\n        # V\u00e9rifier le statut actuel\n        mvola_service = MVolaService(current_app.config)\n        status_info = mvola_service.check_transaction_status(server_correlation_id)\n\n        status = status_info.get('status')\n\n        # Si la transaction est compl\u00e9t\u00e9e, r\u00e9cup\u00e9rer les d\u00e9tails\n        transaction_details = None\n        if status == 'completed' and 'objectReference' in status_info:\n            transaction_id = status_info['objectReference']\n            transaction_details = mvola_service.get_transaction_details(transaction_id)\n\n        return render_template(\n            'payment_status.html',\n            order=order,\n            server_correlation_id=server_correlation_id,\n            status=status,\n            transaction_details=transaction_details\n        )\n\n    except Exception as e:\n        flash(f'Erreur lors de la v\u00e9rification du statut: {e}', 'danger')\n        return redirect(url_for('payment.index'))\n</code></pre>"},{"location":"examples/web-integration/#controleur-de-webhook","title":"Contr\u00f4leur de webhook","text":"<p>Cr\u00e9ons le contr\u00f4leur pour g\u00e9rer les webhooks de MVola.</p> <p>app/controllers/webhook_controller.py:</p> <pre><code>import logging\nfrom flask import Blueprint, request, jsonify, current_app\n\nwebhook_bp = Blueprint('webhook', __name__, url_prefix='/webhooks')\nlogger = logging.getLogger('webhook_controller')\n\n@webhook_bp.route('/mvola/callback', methods=['PUT'])\ndef mvola_callback():\n    \"\"\"\n    Endpoint pour recevoir les notifications de MVola.\n    MVola envoie les notifications de statut \u00e0 cet endpoint.\n    \"\"\"\n    webhook_data = request.get_json()\n\n    if not webhook_data:\n        return jsonify({'status': 'error', 'message': 'Invalid data'}), 400\n\n    # Log des donn\u00e9es re\u00e7ues\n    current_app.logger.info(f\"Webhook MVola re\u00e7u: {json.dumps(webhook_data)}\")\n\n    # Extraire les informations importantes\n    server_correlation_id = webhook_data.get('serverCorrelationId')\n    transaction_status = webhook_data.get('transactionStatus')\n    transaction_reference = webhook_data.get('transactionReference')\n\n    if not server_correlation_id or not transaction_status:\n        return jsonify({'status': 'error', 'message': 'Missing required fields'}), 400\n\n    # R\u00e9cup\u00e9rer l'ID de commande depuis les param\u00e8tres de la requ\u00eate\n    order_id = request.args.get('order_id')\n\n    # Mettre \u00e0 jour le statut de la commande dans la base de donn\u00e9es\n    update_order_status(order_id, transaction_status, transaction_reference, webhook_data)\n\n    # Renvoyer un succ\u00e8s pour indiquer que la notification a \u00e9t\u00e9 re\u00e7ue\n    return jsonify({'status': 'success'}), 200\n</code></pre>"},{"location":"examples/web-integration/#templates","title":"Templates","text":"<p>Cr\u00e9ons les templates de base pour notre application.</p> <p>app/templates/base.html:</p> <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html lang=\"fr\"&gt;\n&lt;head&gt;\n    &lt;meta charset=\"UTF-8\"&gt;\n    &lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"&gt;\n    &lt;title&gt;{% block title %}MVola Payment Demo{% endblock %}&lt;/title&gt;\n    &lt;link rel=\"stylesheet\" href=\"{{ url_for('static', filename='css/style.css') }}\"&gt;\n&lt;/head&gt;\n&lt;body&gt;\n    &lt;header&gt;\n        &lt;h1&gt;MVola Payment Demo&lt;/h1&gt;\n        &lt;nav&gt;\n            &lt;ul&gt;\n                &lt;li&gt;&lt;a href=\"{{ url_for('payment.index') }}\"&gt;Accueil&lt;/a&gt;&lt;/li&gt;\n                &lt;li&gt;&lt;a href=\"{{ url_for('payment.payment') }}\"&gt;Paiement&lt;/a&gt;&lt;/li&gt;\n            &lt;/ul&gt;\n        &lt;/nav&gt;\n    &lt;/header&gt;\n\n    &lt;main&gt;\n        {% with messages = get_flashed_messages(with_categories=true) %}\n            {% if messages %}\n                &lt;div class=\"flashes\"&gt;\n                    {% for category, message in messages %}\n                        &lt;div class=\"flash {{ category }}\"&gt;{{ message }}&lt;/div&gt;\n                    {% endfor %}\n                &lt;/div&gt;\n            {% endif %}\n        {% endwith %}\n\n        {% block content %}{% endblock %}\n    &lt;/main&gt;\n\n    &lt;footer&gt;\n        &lt;p&gt;&amp;copy; {% now \"Y\" %} MVola API Demo&lt;/p&gt;\n    &lt;/footer&gt;\n\n    {% block scripts %}{% endblock %}\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre> <p>app/templates/index.html:</p> <pre><code>{% extends \"base.html\" %}\n\n{% block title %}Accueil - MVola Payment Demo{% endblock %}\n\n{% block content %}\n&lt;section class=\"hero\"&gt;\n    &lt;h2&gt;Paiements faciles avec MVola API&lt;/h2&gt;\n    &lt;p&gt;D\u00e9couvrez comment int\u00e9grer MVola dans votre application web&lt;/p&gt;\n    &lt;a href=\"{{ url_for('payment.payment') }}\" class=\"btn btn-primary\"&gt;Essayer maintenant&lt;/a&gt;\n&lt;/section&gt;\n\n&lt;section class=\"features\"&gt;\n    &lt;div class=\"feature\"&gt;\n        &lt;h3&gt;Simple&lt;/h3&gt;\n        &lt;p&gt;Int\u00e9gration facile avec la biblioth\u00e8que MVola API&lt;/p&gt;\n    &lt;/div&gt;\n    &lt;div class=\"feature\"&gt;\n        &lt;h3&gt;S\u00e9curis\u00e9&lt;/h3&gt;\n        &lt;p&gt;Transactions s\u00e9curis\u00e9es avec validation&lt;/p&gt;\n    &lt;/div&gt;\n    &lt;div class=\"feature\"&gt;\n        &lt;h3&gt;Rapide&lt;/h3&gt;\n        &lt;p&gt;Paiements instantan\u00e9s avec notifications&lt;/p&gt;\n    &lt;/div&gt;\n&lt;/section&gt;\n{% endblock %}\n</code></pre> <p>app/templates/payment.html:</p> <pre><code>{% extends \"base.html\" %}\n\n{% block title %}Paiement - MVola Payment Demo{% endblock %}\n\n{% block content %}\n&lt;section class=\"payment-form\"&gt;\n    &lt;h2&gt;Effectuer un paiement&lt;/h2&gt;\n\n    &lt;form method=\"POST\" action=\"{{ url_for('payment.payment') }}\"&gt;\n        &lt;div class=\"form-group\"&gt;\n            &lt;label for=\"amount\"&gt;Montant (Ar)&lt;/label&gt;\n            &lt;input type=\"number\" id=\"amount\" name=\"amount\" min=\"100\" step=\"100\" \n                   value=\"{{ form_data.amount if form_data else 1000 }}\" required&gt;\n        &lt;/div&gt;\n\n        &lt;div class=\"form-group\"&gt;\n            &lt;label for=\"phone_number\"&gt;Num\u00e9ro de t\u00e9l\u00e9phone&lt;/label&gt;\n            &lt;input type=\"text\" id=\"phone_number\" name=\"phone_number\" \n                   placeholder=\"0343500003\" \n                   value=\"{{ form_data.phone_number if form_data else '' }}\" required&gt;\n            &lt;small&gt;Format: 034XXXXXXX ou 038XXXXXXX&lt;/small&gt;\n        &lt;/div&gt;\n\n        &lt;div class=\"form-group\"&gt;\n            &lt;label for=\"description\"&gt;Description&lt;/label&gt;\n            &lt;input type=\"text\" id=\"description\" name=\"description\" \n                   value=\"{{ form_data.description if form_data else 'Achat en ligne' }}\"&gt;\n        &lt;/div&gt;\n\n        &lt;div class=\"form-actions\"&gt;\n            &lt;button type=\"submit\" class=\"btn btn-primary\"&gt;Payer maintenant&lt;/button&gt;\n        &lt;/div&gt;\n    &lt;/form&gt;\n&lt;/section&gt;\n{% endblock %}\n</code></pre> <p>app/templates/status.html:</p> <pre><code>{% extends \"base.html\" %}\n\n{% block title %}Statut du paiement - MVola Payment Demo{% endblock %}\n\n{% block content %}\n&lt;section class=\"payment-status\"&gt;\n    &lt;h2&gt;Statut du paiement&lt;/h2&gt;\n\n    &lt;div class=\"status-card\"&gt;\n        &lt;p&gt;ID de transaction: &lt;strong&gt;{{ transaction_id }}&lt;/strong&gt;&lt;/p&gt;\n\n        {% if status_info %}\n            &lt;div class=\"status-info\"&gt;\n                &lt;p&gt;Statut: &lt;strong&gt;{{ status_info.get('status', 'Inconnu') }}&lt;/strong&gt;&lt;/p&gt;\n                &lt;p&gt;Date: {{ status_info.get('date', 'N/A') }}&lt;/p&gt;\n                {% if status_info.get('status', '').lower() == 'completed' %}\n                    &lt;div class=\"success-message\"&gt;\n                        &lt;p&gt;Paiement r\u00e9ussi!&lt;/p&gt;\n                    &lt;/div&gt;\n                {% elif status_info.get('status', '').lower() in ['failed', 'rejected', 'cancelled'] %}\n                    &lt;div class=\"error-message\"&gt;\n                        &lt;p&gt;Le paiement a \u00e9chou\u00e9&lt;/p&gt;\n                    &lt;/div&gt;\n                {% else %}\n                    &lt;div class=\"pending-message\"&gt;\n                        &lt;p&gt;Paiement en attente&lt;/p&gt;\n                        &lt;p&gt;Veuillez confirmer sur votre t\u00e9l\u00e9phone&lt;/p&gt;\n                    &lt;/div&gt;\n                {% endif %}\n            &lt;/div&gt;\n        {% else %}\n            &lt;p&gt;En attente de confirmation...&lt;/p&gt;\n        {% endif %}\n\n        &lt;div class=\"status-actions\"&gt;\n            &lt;a href=\"{{ url_for('payment.status', check=1) }}\" class=\"btn btn-secondary\"&gt;V\u00e9rifier le statut&lt;/a&gt;\n            &lt;a href=\"{{ url_for('payment.index') }}\" class=\"btn btn-link\"&gt;Retour \u00e0 l'accueil&lt;/a&gt;\n        &lt;/div&gt;\n    &lt;/div&gt;\n&lt;/section&gt;\n{% endblock %}\n\n{% block scripts %}\n&lt;script&gt;\n    // V\u00e9rifier automatiquement le statut toutes les 5 secondes\n    {% if not status_info or status_info.get('status', '').lower() not in ['completed', 'failed', 'rejected', 'cancelled'] %}\n    const checkInterval = 5000; // 5 secondes\n\n    function checkStatus() {\n        window.location.href = \"{{ url_for('payment.status', check=1) }}\";\n    }\n\n    // D\u00e9finir un timeout pour v\u00e9rifier le statut\n    setTimeout(checkStatus, checkInterval);\n    {% endif %}\n&lt;/script&gt;\n{% endblock %}\n</code></pre>"},{"location":"examples/web-integration/#point-dentree-de-lapplication","title":"Point d'entr\u00e9e de l'application","text":"<p>Cr\u00e9ons le point d'entr\u00e9e principal de l'application.</p> <p>run.py:</p> <pre><code>import os\nimport logging\nfrom app import create_app\n\n# Configuration du logging\nlogging.basicConfig(\n    level=logging.INFO,\n    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s'\n)\n\n# Cr\u00e9ation de l'application\napp = create_app()\n\nif __name__ == '__main__':\n    port = int(os.environ.get('PORT', 5000))\n    app.run(host='0.0.0.0', port=port, debug=True)\n</code></pre>"},{"location":"examples/web-integration/#fichier-denvironnement","title":"Fichier d'environnement","text":"<p>Cr\u00e9ez un fichier <code>.env</code> \u00e0 la racine du projet avec les configurations n\u00e9cessaires :</p> <pre><code>SECRET_KEY=votre_secret_key_generee_aleatoirement\nMVOLA_CONSUMER_KEY=votre_consumer_key\nMVOLA_CONSUMER_SECRET=votre_consumer_secret\nMVOLA_PARTNER_NAME=NOM_DU_PARTENAIRE\nMVOLA_PARTNER_MSISDN=0343500003\nMVOLA_BASE_URL=https://devapi.mvola.mg\nWEBHOOK_BASE_URL=https://votre-domaine.com\n</code></pre> <p>Note: Pour les tests en d\u00e9veloppement local, vous pouvez utiliser un service comme ngrok pour cr\u00e9er un tunnel vers votre localhost et obtenir une URL publique temporaire pour les webhooks.</p>"},{"location":"examples/web-integration/#dependances-du-projet","title":"D\u00e9pendances du projet","text":"<p>Cr\u00e9ez un fichier <code>requirements.txt</code> \u00e0 la racine du projet :</p> <pre><code>flask==2.0.1\npython-dotenv==0.19.0\nmvola-api==1.0.0\ngunicorn==21.0.0\n</code></pre>"},{"location":"examples/web-integration/#lancement-de-lapplication","title":"Lancement de l'application","text":"<p>Pour lancer l'application en d\u00e9veloppement :</p> <pre><code>python run.py\n</code></pre> <p>Pour le d\u00e9ploiement en production, utilisez un serveur WSGI comme Gunicorn :</p> <pre><code>gunicorn -w 4 -b 0.0.0.0:5000 \"app:create_app()\"\n</code></pre>"},{"location":"examples/web-integration/#tests-et-debogage","title":"Tests et d\u00e9bogage","text":""},{"location":"examples/web-integration/#test-des-webhooks-en-local","title":"Test des webhooks en local","text":"<p>Pour tester les webhooks en d\u00e9veloppement local, vous pouvez utiliser ngrok :</p> <pre><code># Installation de ngrok (si ce n'est pas d\u00e9j\u00e0 fait)\npip install pyngrok\n\n# Dans un terminal s\u00e9par\u00e9, lancez ngrok\nngrok http 5000\n</code></pre> <p>Utilisez l'URL fournie par ngrok comme valeur pour <code>WEBHOOK_BASE_URL</code> dans votre fichier <code>.env</code>.</p>"},{"location":"examples/web-integration/#simulations-de-paiement","title":"Simulations de paiement","text":"<p>Vous pouvez simuler des paiements en utilisant l'environnement sandbox de MVola. Dans cet environnement, les transactions sont simul\u00e9es sans mouvement d'argent r\u00e9el.</p>"},{"location":"examples/web-integration/#conclusion","title":"Conclusion","text":"<p>Cette int\u00e9gration web montre comment :</p> <ol> <li>Initialiser la biblioth\u00e8que MVola API dans une application Flask</li> <li>Cr\u00e9er un formulaire de paiement pour les utilisateurs</li> <li>G\u00e9rer le flux de paiement complet</li> <li>Recevoir et traiter les notifications via webhooks</li> </ol> <p>Vous pouvez adapter ce code \u00e0 votre framework web pr\u00e9f\u00e9r\u00e9 en suivant les m\u00eames principes.</p>"},{"location":"examples/web-integration/#prochaines-etapes","title":"Prochaines \u00e9tapes","text":"<p>Pour compl\u00e9ter votre int\u00e9gration, consultez:</p> <ul> <li>Guide de gestion des webhooks pour plus de d\u00e9tails sur les notifications</li> <li>Gestion des erreurs pour une meilleure gestion des cas d'erreur </li> </ul>"},{"location":"examples/webhook-handling/","title":"Gestion des Webhooks","text":"<p>Ce guide explique comment configurer et g\u00e9rer les webhooks pour les notifications de transactions MVola dans votre application.</p>"},{"location":"examples/webhook-handling/#quest-ce-quun-webhook","title":"Qu'est-ce qu'un webhook?","text":"<p>Un webhook est un m\u00e9canisme qui permet \u00e0 MVola d'envoyer automatiquement des notifications \u00e0 votre application lorsqu'un \u00e9v\u00e9nement se produit, comme un changement de statut de transaction. Au lieu de v\u00e9rifier p\u00e9riodiquement le statut d'une transaction (polling), votre serveur re\u00e7oit une notification d\u00e8s que le statut change.</p>"},{"location":"examples/webhook-handling/#architecture-des-webhooks","title":"Architecture des webhooks","text":"<p>Voici comment les webhooks fonctionnent avec MVola:</p> <ol> <li>Lors de l'initiation d'une transaction, vous fournissez une URL de callback</li> <li>Le client confirme la transaction sur son t\u00e9l\u00e9phone mobile</li> <li>MVola traite la transaction et met \u00e0 jour son statut</li> <li>MVola envoie une notification \u00e0 votre URL de callback avec les d\u00e9tails de la transaction</li> <li>Votre serveur traite cette notification et met \u00e0 jour vos syst\u00e8mes</li> </ol> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  Votre  \u2502         \u2502  API    \u2502         \u2502 Mobile  \u2502\n\u2502 Serveur \u2502\u25c4\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502  MVola  \u2502\u25c4\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502 Client  \u2502\n\u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518         \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n     \u2502                                        \u25b2\n     \u2502                                        \u2502\n     \u2502                                        \u2502\n     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n            Notification par webhook\n</code></pre>"},{"location":"examples/webhook-handling/#configuration-dun-callback-url","title":"Configuration d'un callback URL","text":"<p>Lorsque vous initiez un paiement, vous pouvez sp\u00e9cifier une URL de callback avec l'en-t\u00eate <code>X-Callback-URL</code> ou le param\u00e8tre <code>callback_url</code> dans la m\u00e9thode :</p> <pre><code>from mvola_api import MVolaClient\n\nclient = MVolaClient(\n    consumer_key=\"votre_consumer_key\",\n    consumer_secret=\"votre_consumer_secret\",\n    partner_name=\"NOM_DU_PARTENAIRE\",\n    partner_msisdn=\"0343500003\",\n    base_url=\"https://devapi.mvola.mg\"  # URL de l'API sandbox\n)\n\ntransaction_info = client.initiate_merchant_payment(\n    amount=\"1000\",\n    debit_msisdn=\"0343500003\",\n    credit_msisdn=\"0343500004\",\n    description=\"Paiement produit\",\n    requesting_organisation_transaction_reference=\"REF123456\",\n    callback_url=\"https://votre-domaine.com/webhooks/mvola/callback\"\n)\n</code></pre> <p>Cette URL doit \u00eatre accessible publiquement sur Internet pour que MVola puisse y envoyer des requ\u00eates.</p>"},{"location":"examples/webhook-handling/#format-des-notifications-de-webhook","title":"Format des notifications de webhook","text":"<p>MVola envoie des notifications au format JSON via une requ\u00eate PUT \u00e0 votre URL de callback. Voici les formats typiques:</p>"},{"location":"examples/webhook-handling/#notification-de-succes","title":"Notification de succ\u00e8s","text":"<pre><code>{\n  \"transactionStatus\": \"completed\",\n  \"serverCorrelationId\": \"421a22a2-ef1d-42bc-9452-f4939a3d5cdf\",\n  \"transactionReference\": \"641235\",\n  \"requestDate\": \"2021-02-24T03:28:00.567Z\",\n  \"debitParty\": [\n    {\n      \"key\": \"msisdn\",\n      \"value\": \"0343500003\"\n    }\n  ],\n  \"creditParty\": [\n    {\n      \"key\": \"msisdn\",\n      \"value\": \"0343500004\"\n    }\n  ],\n  \"fees\": [\n    {\n      \"feeAmount\": \"20\"\n    }\n  ],\n  \"metadata\": [\n    {\n      \"key\": \"partnerName\",\n      \"value\": \"NomPartenaire\"\n    }\n  ]\n}\n</code></pre>"},{"location":"examples/webhook-handling/#notification-dechec","title":"Notification d'\u00e9chec","text":"<pre><code>{\n  \"transactionStatus\": \"failed\",\n  \"serverCorrelationId\": \"421a22a2-ef1d-42bc-9452-f4939a3d5cdf\",\n  \"transactionReference\": \"641235\",\n  \"requestDate\": \"2021-02-24T03:28:00.567Z\",\n  \"debitParty\": [\n    {\n      \"key\": \"msisdn\",\n      \"value\": \"0343500003\"\n    }\n  ],\n  \"creditParty\": [\n    {\n      \"key\": \"msisdn\",\n      \"value\": \"0343500004\"\n    }\n  ],\n  \"metadata\": [\n    {\n      \"key\": \"partnerName\",\n      \"value\": \"NomPartenaire\"\n    }\n  ]\n}\n</code></pre> <p>Les statuts possibles incluent: - <code>pending</code>: La transaction est en attente de confirmation - <code>completed</code>: La transaction a \u00e9t\u00e9 trait\u00e9e avec succ\u00e8s - <code>failed</code>: La transaction a \u00e9chou\u00e9</p>"},{"location":"examples/webhook-handling/#creation-dun-endpoint-de-webhook","title":"Cr\u00e9ation d'un endpoint de webhook","text":""},{"location":"examples/webhook-handling/#avec-flask","title":"Avec Flask","text":"<p>Voici un exemple d'endpoint pour recevoir les notifications avec Flask:</p> <pre><code>from flask import Blueprint, request, jsonify\nimport logging\nimport json\n\nwebhook_bp = Blueprint('webhook', __name__, url_prefix='/webhooks')\nlogger = logging.getLogger('webhook')\n\n@webhook_bp.route('/mvola/callback', methods=['PUT'])  # MVola utilise PUT pour les callbacks\ndef mvola_callback():\n    # R\u00e9cup\u00e9rer les donn\u00e9es du webhook\n    webhook_data = request.get_json()\n\n    if not webhook_data:\n        logger.error(\"Donn\u00e9es de webhook invalides ou vides\")\n        return jsonify({\"status\": \"error\", \"message\": \"Invalid data\"}), 400\n\n    # Enregistrer les donn\u00e9es pour d\u00e9bogage\n    logger.info(f\"Webhook re\u00e7u: {json.dumps(webhook_data)}\")\n\n    # Extraire les informations importantes\n    server_correlation_id = webhook_data.get('serverCorrelationId')\n    transaction_status = webhook_data.get('transactionStatus')\n    transaction_reference = webhook_data.get('transactionReference')\n\n    # R\u00e9cup\u00e9rer les num\u00e9ros MSISDN\n    debit_party = webhook_data.get('debitParty', [])\n    debit_msisdn = next((item.get('value') for item in debit_party \n                         if item.get('key') == 'msisdn'), None)\n\n    credit_party = webhook_data.get('creditParty', [])\n    credit_msisdn = next((item.get('value') for item in credit_party \n                          if item.get('key') == 'msisdn'), None)\n\n    # R\u00e9cup\u00e9rer les frais si disponibles\n    fees = webhook_data.get('fees', [])\n    fee_amount = next((fee.get('feeAmount') for fee in fees), None)\n\n    # Traiter selon le statut\n    if transaction_status == 'completed':\n        # La transaction a r\u00e9ussi\n        logger.info(f\"Transaction {transaction_reference} compl\u00e9t\u00e9e avec succ\u00e8s\")\n        # Mettre \u00e0 jour votre base de donn\u00e9es, envoyer un email, etc.\n        update_transaction_status(server_correlation_id, transaction_status, transaction_reference)\n        send_confirmation_email(debit_msisdn, webhook_data)\n\n    elif transaction_status == 'failed':\n        # La transaction a \u00e9chou\u00e9\n        logger.warning(f\"Transaction {server_correlation_id} a \u00e9chou\u00e9\")\n        update_transaction_status(server_correlation_id, transaction_status, transaction_reference)\n        send_failure_notification(debit_msisdn, webhook_data)\n\n    # Toujours retourner un succ\u00e8s (HTTP 200) pour indiquer que vous avez re\u00e7u la notification\n    return jsonify({\"status\": \"success\"}), 200\n\ndef update_transaction_status(server_correlation_id, status, transaction_reference=None):\n    # Impl\u00e9mentez la mise \u00e0 jour de votre base de donn\u00e9es\n    pass\n\ndef send_confirmation_email(msisdn, webhook_data):\n    # Envoyez un email de confirmation\n    pass\n\ndef send_failure_notification(msisdn, webhook_data):\n    # Envoyez une notification d'\u00e9chec\n    pass\n</code></pre>"},{"location":"examples/webhook-handling/#avec-django","title":"Avec Django","text":"<p>Voici un exemple avec Django:</p> <pre><code># urls.py\nfrom django.urls import path\nfrom . import views\n\nurlpatterns = [\n    path('webhooks/mvola/callback', views.mvola_callback, name='mvola_callback'),\n]\n\n# views.py\nimport json\nimport logging\nfrom django.http import JsonResponse\nfrom django.views.decorators.csrf import csrf_exempt\nfrom django.views.decorators.http import require_http_methods\n\nlogger = logging.getLogger('mvola_webhooks')\n\n@csrf_exempt  # Important: les webhooks externes ne peuvent pas fournir de token CSRF\n@require_http_methods([\"PUT\"])  # MVola utilise PUT pour les callbacks\ndef mvola_callback(request):\n    try:\n        webhook_data = json.loads(request.body)\n    except json.JSONDecodeError:\n        logger.error(\"Donn\u00e9es JSON invalides\")\n        return JsonResponse({\"status\": \"error\", \"message\": \"Invalid JSON\"}, status=400)\n\n    # Extraire les informations importantes\n    server_correlation_id = webhook_data.get('serverCorrelationId')\n    transaction_status = webhook_data.get('transactionStatus')\n    transaction_reference = webhook_data.get('transactionReference')\n\n    # Traiter les donn\u00e9es selon le statut...\n\n    return JsonResponse({\"status\": \"success\"})\n</code></pre>"},{"location":"examples/webhook-handling/#securisation-des-webhooks","title":"S\u00e9curisation des webhooks","text":"<p>Pour s\u00e9curiser vos webhooks:</p>"},{"location":"examples/webhook-handling/#validation-de-la-source","title":"Validation de la source","text":"<p>Vous pouvez valider que les requ\u00eates proviennent bien de MVola en v\u00e9rifiant les adresses IP ou en impl\u00e9mentant une authentification:</p> <pre><code>def is_valid_mvola_request(request):\n    # Liste des IPs autoris\u00e9es (exemple fictif - \u00e0 remplacer par les vraies IPs de MVola)\n    allowed_ips = ['203.0.113.1', '203.0.113.2']\n    client_ip = request.remote_addr\n\n    return client_ip in allowed_ips\n\n@webhook_bp.route('/mvola/callback', methods=['PUT'])\ndef mvola_callback():\n    if not is_valid_mvola_request(request):\n        logger.warning(f\"Tentative d'acc\u00e8s non autoris\u00e9e depuis {request.remote_addr}\")\n        return jsonify({\"status\": \"error\", \"message\": \"Unauthorized\"}), 403\n\n    # Suite du traitement...\n</code></pre>"},{"location":"examples/webhook-handling/#verification-des-transactions","title":"V\u00e9rification des transactions","text":"<p>Validez syst\u00e9matiquement les donn\u00e9es re\u00e7ues en les comparant avec vos enregistrements:</p> <pre><code>def validate_transaction(server_correlation_id, transaction_reference, debit_msisdn):\n    # R\u00e9cup\u00e9rer la transaction depuis votre base de donn\u00e9es\n    stored_transaction = get_transaction_from_db(server_correlation_id)\n\n    if not stored_transaction:\n        logger.warning(f\"Transaction inconnue: {server_correlation_id}\")\n        return False\n\n    # V\u00e9rifier que les d\u00e9tails correspondent\n    if stored_transaction.debit_msisdn != debit_msisdn:\n        logger.warning(f\"D\u00e9tails de transaction non concordants: {server_correlation_id}\")\n        return False\n\n    return True\n</code></pre>"},{"location":"examples/webhook-handling/#gestion-des-erreurs-et-retransmissions","title":"Gestion des erreurs et retransmissions","text":"<p>MVola peut retransmettre les notifications en cas d'\u00e9chec. Votre endpoint doit \u00eatre idempotent, c'est-\u00e0-dire qu'il doit pouvoir recevoir plusieurs fois la m\u00eame notification sans causer de probl\u00e8mes:</p> <pre><code>def process_transaction_completion(server_correlation_id, transaction_status, transaction_reference):\n    # V\u00e9rifier si la transaction a d\u00e9j\u00e0 \u00e9t\u00e9 trait\u00e9e\n    if is_transaction_already_processed(server_correlation_id, transaction_reference):\n        logger.info(f\"Transaction {server_correlation_id} d\u00e9j\u00e0 trait\u00e9e, ignor\u00e9e\")\n        return\n\n    # Traiter la transaction et marquer comme trait\u00e9e\n    mark_transaction_as_processed(server_correlation_id, transaction_status, transaction_reference)\n    # D\u00e9clencher les actions correspondantes\n    trigger_post_payment_actions(server_correlation_id, transaction_reference)\n</code></pre>"},{"location":"examples/webhook-handling/#test-des-webhooks-en-developpement","title":"Test des webhooks en d\u00e9veloppement","text":"<p>Pour tester les webhooks en d\u00e9veloppement local:</p>"},{"location":"examples/webhook-handling/#utilisation-de-ngrok","title":"Utilisation de ngrok","text":"<p>ngrok vous permet d'exposer votre serveur local \u00e0 Internet:</p> <pre><code># Installer ngrok\npip install pyngrok\n\n# Exposer votre serveur local (ex: port 5000)\nngrok http 5000\n</code></pre> <p>ngrok vous fournira une URL publique (ex: <code>https://abc123.ngrok.io</code>) que vous pourrez utiliser comme URL de callback.</p>"},{"location":"examples/webhook-handling/#utilisation-de-requestbin","title":"Utilisation de requestbin","text":"<p>RequestBin permet de capturer et d'inspecter les requ\u00eates HTTP:</p> <ol> <li>Cr\u00e9ez un nouveau bin sur RequestBin</li> <li>Utilisez l'URL fournie comme URL de callback</li> <li>Visualisez les requ\u00eates re\u00e7ues dans l'interface web</li> </ol>"},{"location":"examples/webhook-handling/#simulation-de-webhooks","title":"Simulation de webhooks","text":"<p>Vous pouvez simuler des webhooks pour tester votre logique de traitement:</p> <pre><code># test_webhooks.py\nimport requests\nimport json\nimport uuid\nfrom datetime import datetime\n\ndef simulate_webhook(callback_url, server_correlation_id, status):\n    # Cr\u00e9er un payload de test\n    webhook_data = {\n        \"transactionStatus\": status,\n        \"serverCorrelationId\": server_correlation_id,\n        \"transactionReference\": f\"REF-{uuid.uuid4().hex[:8].upper()}\",\n        \"requestDate\": datetime.utcnow().strftime(\"%Y-%m-%dT%H:%M:%S.%f\")[:-3] + \"Z\",\n        \"debitParty\": [\n            {\n                \"key\": \"msisdn\",\n                \"value\": \"0343500003\"\n            }\n        ],\n        \"creditParty\": [\n            {\n                \"key\": \"msisdn\",\n                \"value\": \"0343500004\"\n            }\n        ]\n    }\n\n    # Ajouter les frais pour les transactions r\u00e9ussies\n    if status == \"completed\":\n        webhook_data[\"fees\"] = [\n            {\n                \"feeAmount\": \"20\"\n            }\n        ]\n\n    # Ajouter des m\u00e9tadonn\u00e9es\n    webhook_data[\"metadata\"] = [\n        {\n            \"key\": \"partnerName\",\n            \"value\": \"NomPartenaire\"\n        }\n    ]\n\n    # Envoyer la requ\u00eate PUT (MVola utilise PUT pour les callbacks)\n    response = requests.put(\n        callback_url,\n        json=webhook_data,\n        headers={\"Content-Type\": \"application/json\"}\n    )\n\n    print(f\"Statut: {response.status_code}\")\n    print(f\"R\u00e9ponse: {response.text}\")\n\n# Simuler diff\u00e9rents statuts\nsimulate_webhook(\"http://localhost:5000/webhooks/mvola/callback\", \n                 \"corr-\" + str(uuid.uuid4()), \"pending\")\nsimulate_webhook(\"http://localhost:5000/webhooks/mvola/callback\", \n                 \"corr-\" + str(uuid.uuid4()), \"completed\")\nsimulate_webhook(\"http://localhost:5000/webhooks/mvola/callback\", \n                 \"corr-\" + str(uuid.uuid4()), \"failed\")\n</code></pre>"},{"location":"examples/webhook-handling/#journalisation-et-monitoring","title":"Journalisation et monitoring","text":"<p>Impl\u00e9mentez une journalisation compl\u00e8te pour faciliter le d\u00e9bogage:</p> <pre><code>import logging\n\n# Configuration du logger\nlogging.basicConfig(\n    level=logging.INFO,\n    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',\n    handlers=[\n        logging.FileHandler('webhooks.log'),\n        logging.StreamHandler()\n    ]\n)\n\nlogger = logging.getLogger('mvola_webhooks')\n\n# Dans le handler de webhook\n@webhook_bp.route('/mvola/callback', methods=['PUT'])\ndef mvola_callback():\n    webhook_data = request.get_json()\n\n    # Journalisation compl\u00e8te\n    logger.info(f\"Webhook re\u00e7u: {json.dumps(webhook_data)}\")\n\n    # Traitement...\n\n    # Journalisation du r\u00e9sultat\n    logger.info(f\"Webhook trait\u00e9 avec succ\u00e8s pour la transaction {webhook_data.get('serverCorrelationId')}\")\n\n    return jsonify({\"status\": \"success\"}), 200\n</code></pre>"},{"location":"examples/webhook-handling/#webhooks-dans-un-environnement-de-production","title":"Webhooks dans un environnement de production","text":"<p>Pour un environnement de production:</p> <ol> <li>Utiliser HTTPS: Assurez-vous que votre endpoint est accessible en HTTPS</li> <li>Ajouter une surveillance: Mettez en place des alertes en cas d'erreur de traitement</li> <li>Impl\u00e9menter des retries: Si votre logique interne \u00e9choue, mettez en place un m\u00e9canisme de retry</li> <li>Configurer des timeouts: Limitez le temps de traitement des webhooks pour \u00e9viter les longues op\u00e9rations</li> <li>Utiliser des queues: Enregistrez les notifications dans une queue pour un traitement asynchrone</li> </ol>"},{"location":"examples/webhook-handling/#exemple-complet-dintegration","title":"Exemple complet d'int\u00e9gration","text":"<p>Voici un exemple complet qui int\u00e8gre toutes les bonnes pratiques:</p> <pre><code>import json\nimport logging\nimport time\nfrom flask import Blueprint, request, jsonify\nfrom threading import Thread\nfrom queue import Queue\n\n# Configuration du logging\nlogging.basicConfig(level=logging.INFO)\nlogger = logging.getLogger('mvola_webhooks')\n\n# File d'attente pour le traitement asynchrone\nwebhook_queue = Queue()\n\nwebhook_bp = Blueprint('webhook', __name__, url_prefix='/webhooks')\n\n@webhook_bp.route('/mvola/callback', methods=['PUT'])\ndef mvola_callback():\n    start_time = time.time()\n\n    # 1. Validation de base\n    if not request.is_json:\n        logger.error(\"Content-Type non JSON\")\n        return jsonify({\"status\": \"error\", \"message\": \"Content-Type must be application/json\"}), 400\n\n    webhook_data = request.get_json()\n\n    if not webhook_data:\n        logger.error(\"Donn\u00e9es de webhook vides\")\n        return jsonify({\"status\": \"error\", \"message\": \"Empty payload\"}), 400\n\n    # 2. Validation minimale des donn\u00e9es requises\n    server_correlation_id = webhook_data.get('serverCorrelationId')\n    transaction_status = webhook_data.get('transactionStatus')\n\n    if not server_correlation_id or not transaction_status:\n        logger.error(f\"Donn\u00e9es incompl\u00e8tes: {json.dumps(webhook_data)}\")\n        return jsonify({\"status\": \"error\", \"message\": \"Missing required fields\"}), 400\n\n    # 3. Journalisation\n    logger.info(f\"Webhook re\u00e7u pour transaction {server_correlation_id}, statut: {transaction_status}\")\n\n    # 4. Traitement asynchrone pour \u00e9viter de bloquer la r\u00e9ponse\n    webhook_queue.put(webhook_data)\n\n    # 5. R\u00e9pondre rapidement\n    processing_time = time.time() - start_time\n    logger.info(f\"Webhook mis en file d'attente en {processing_time:.3f}s\")\n\n    return jsonify({\n        \"status\": \"success\", \n        \"message\": \"Webhook received and queued for processing\",\n        \"server_correlation_id\": server_correlation_id\n    }), 200\n\n# Traitement des webhooks en arri\u00e8re-plan\ndef process_webhook_queue():\n    while True:\n        try:\n            # R\u00e9cup\u00e9rer le prochain webhook \u00e0 traiter\n            webhook_data = webhook_queue.get()\n\n            if not webhook_data:\n                continue\n\n            server_correlation_id = webhook_data.get('serverCorrelationId')\n            transaction_status = webhook_data.get('transactionStatus')\n            transaction_reference = webhook_data.get('transactionReference')\n\n            logger.info(f\"Traitement du webhook pour transaction {server_correlation_id}\")\n\n            # V\u00e9rifier si la transaction existe et n'a pas d\u00e9j\u00e0 \u00e9t\u00e9 trait\u00e9e\n            transaction = get_transaction(server_correlation_id)\n\n            if not transaction:\n                logger.warning(f\"Transaction inconnue: {server_correlation_id}\")\n                webhook_queue.task_done()\n                continue\n\n            if transaction.status == transaction_status:\n                logger.info(f\"Transaction {server_correlation_id} d\u00e9j\u00e0 dans l'\u00e9tat {transaction_status}, ignor\u00e9e\")\n                webhook_queue.task_done()\n                continue\n\n            # Traiter selon le statut\n            if transaction_status == 'completed':\n                # Marquer la commande comme pay\u00e9e, envoyer confirmation, etc.\n                complete_order(transaction, transaction_reference)\n                logger.info(f\"Transaction {server_correlation_id} compl\u00e9t\u00e9e et trait\u00e9e\")\n\n            elif transaction_status == 'failed':\n                # Marquer la commande comme \u00e9chou\u00e9e\n                fail_order(transaction)\n                logger.info(f\"Transaction {server_correlation_id} \u00e9chou\u00e9e\")\n\n            # Mettre \u00e0 jour le statut dans la base de donn\u00e9es\n            update_transaction_status(server_correlation_id, transaction_status, transaction_reference)\n\n            # Signaler que le traitement est termin\u00e9\n            webhook_queue.task_done()\n\n        except Exception as e:\n            logger.exception(f\"Erreur lors du traitement du webhook: {e}\")\n            # Continuer \u00e0 traiter les autres webhooks m\u00eame en cas d'erreur\n\n# D\u00e9marrer le thread de traitement\nwebhook_processor = Thread(target=process_webhook_queue, daemon=True)\nwebhook_processor.start()\n\n# Fonctions fictives \u00e0 impl\u00e9menter selon votre application\ndef get_transaction(server_correlation_id):\n    # R\u00e9cup\u00e9rer la transaction depuis la base de donn\u00e9es\n    pass\n\ndef update_transaction_status(server_correlation_id, status, transaction_reference=None):\n    # Mettre \u00e0 jour le statut dans la base de donn\u00e9es\n    pass\n\ndef complete_order(transaction, transaction_reference):\n    # Marquer la commande comme pay\u00e9e\n    pass\n\ndef fail_order(transaction):\n    # Marquer la commande comme \u00e9chou\u00e9e\n    pass\n</code></pre>"},{"location":"examples/webhook-handling/#conclusion","title":"Conclusion","text":"<p>Les webhooks sont un m\u00e9canisme puissant pour construire des int\u00e9grations robustes avec MVola. En suivant ces bonnes pratiques, vous pourrez:</p> <ol> <li>Recevoir des notifications en temps r\u00e9el sur les changements de statut des transactions</li> <li>Traiter ces notifications de mani\u00e8re fiable et s\u00e9curis\u00e9e</li> <li>Automatiser vos processus m\u00e9tier en fonction des paiements</li> </ol>"},{"location":"examples/webhook-handling/#prochaines-etapes","title":"Prochaines \u00e9tapes","text":"<ul> <li>Consultez le guide Int\u00e9gration Web pour voir comment impl\u00e9menter une solution de paiement compl\u00e8te</li> <li>Explorez la gestion des erreurs pour rendre votre syst\u00e8me encore plus robuste </li> </ul>"},{"location":"explanation/architecture/","title":"Architecture de la biblioth\u00e8que MVola API","text":"<p>Cette page explique l'architecture interne de la biblioth\u00e8que MVola API, sa conception, et les d\u00e9cisions prises lors de son d\u00e9veloppement.</p>"},{"location":"explanation/architecture/#vue-densemble-de-larchitecture","title":"Vue d'ensemble de l'architecture","text":"<p>La biblioth\u00e8que MVola API est con\u00e7ue selon un mod\u00e8le \u00e0 plusieurs couches :</p> <pre><code>+------------------------------------------+\n|            MVolaClient                   |  &lt;- Interface publique principale\n+------------------------------------------+\n          |                  |\n          v                  v\n+------------------+  +------------------+\n|    MVolaAuth     |  | MVolaTransaction |  &lt;- Modules sp\u00e9cialis\u00e9s\n+------------------+  +------------------+\n          |                  |\n          v                  v\n+------------------------------------------+\n|          Couche HTTP (requests)          |  &lt;- Communication HTTP\n+------------------------------------------+\n          |\n          v\n+------------------------------------------+\n|            API MVola (externe)           |  &lt;- API externe\n+------------------------------------------+\n</code></pre>"},{"location":"explanation/architecture/#principes-de-conception","title":"Principes de conception","text":"<p>La biblioth\u00e8que a \u00e9t\u00e9 con\u00e7ue avec les principes suivants :</p> <ol> <li>Separation of Concerns (SoC) - Chaque module a une responsabilit\u00e9 claire et distincte</li> <li>Interface intuitive - API simple et facile \u00e0 utiliser pour les d\u00e9veloppeurs</li> <li>Robustesse - Gestion compl\u00e8te des erreurs et validation des donn\u00e9es</li> <li>Flexibilit\u00e9 - Support des environnements sandbox et production</li> </ol>"},{"location":"explanation/architecture/#composants-principaux","title":"Composants principaux","text":""},{"location":"explanation/architecture/#mvolaclient","title":"MVolaClient","text":"<p>Le client est le point d'entr\u00e9e principal de la biblioth\u00e8que. Il : - Coordonne les interactions entre les diff\u00e9rents modules - Fournit une interface simplifi\u00e9e pour les op\u00e9rations courantes - G\u00e8re la journalisation et les param\u00e8tres globaux - Configure les URLs pour les environnements sandbox (https://devapi.mvola.mg) et production (https://api.mvola.mg)</p>"},{"location":"explanation/architecture/#mvolaauth","title":"MVolaAuth","text":"<p>Le module d'authentification : - G\u00e8re la g\u00e9n\u00e9ration de tokens OAuth avec le scope <code>EXT_INT_MVOLA_SCOPE</code> - Maintient l'\u00e9tat du token et g\u00e8re son expiration - Rafra\u00eechit automatiquement le token lorsque n\u00e9cessaire - G\u00e8re les en-t\u00eates d'authentification pour les appels API</p>"},{"location":"explanation/architecture/#mvolatransaction","title":"MVolaTransaction","text":"<p>Le module de transaction : - Impl\u00e9mente les op\u00e9rations de paiement marchand via l'endpoint <code>/mvola/mm/transactions/type/merchantpay/1.0.0/</code> - G\u00e8re la validation des param\u00e8tres de transaction avec la nouvelle limite de 50 caract\u00e8res pour la description - Fournit des m\u00e9thodes pour v\u00e9rifier le statut des transactions via <code>serverCorrelationId</code> - R\u00e9cup\u00e8re les d\u00e9tails des transactions avec une r\u00e9ponse structur\u00e9e standardis\u00e9e - Prend en charge les nouveaux param\u00e8tres comme <code>requestingOrganisationTransactionReference</code> et <code>originalTransactionReference</code></p>"},{"location":"explanation/architecture/#gestion-des-erreurs","title":"Gestion des erreurs","text":"<p>Le syst\u00e8me de gestion des erreurs utilise une hi\u00e9rarchie d'exceptions : - <code>MVolaError</code> - Classe de base pour toutes les erreurs - <code>MVolaAuthError</code> - Erreurs li\u00e9es \u00e0 l'authentification - <code>MVolaTransactionError</code> - Erreurs li\u00e9es aux transactions - <code>MVolaValidationError</code> - Erreurs de validation des param\u00e8tres - <code>MVolaConnectionError</code> - Erreurs de connexion r\u00e9seau</p>"},{"location":"explanation/architecture/#flux-de-donnees","title":"Flux de donn\u00e9es","text":"<ol> <li> <p>Authentification :    <pre><code>MVolaClient \u2192 MVolaAuth \u2192 API MVola \u2192 Token d'acc\u00e8s \u2192 Stock\u00e9 dans MVolaAuth\n</code></pre></p> </li> <li> <p>Initiation de paiement marchand :    <pre><code>MVolaClient \u2192 MVolaTransaction \u2192 Validation des param\u00e8tres \u2192 \nMVolaTransaction demande token \u00e0 MVolaAuth \u2192 \nMVolaTransaction envoie requ\u00eate \u00e0 API MVola \u2192 \nR\u00e9sultat retourn\u00e9 \u00e0 MVolaClient\n</code></pre></p> </li> <li> <p>V\u00e9rification de statut :    <pre><code>MVolaClient \u2192 MVolaTransaction \u2192 \nMVolaTransaction demande token \u00e0 MVolaAuth \u2192 \nMVolaTransaction envoie requ\u00eate avec serverCorrelationId \u00e0 API MVola \u2192 \nR\u00e9sultat retourn\u00e9 \u00e0 MVolaClient\n</code></pre></p> </li> </ol>"},{"location":"explanation/architecture/#considerations-de-performances","title":"Consid\u00e9rations de performances","text":"<ul> <li>R\u00e9utilisation des tokens - Les tokens sont r\u00e9utilis\u00e9s jusqu'\u00e0 leur expiration</li> <li>Validation pr\u00e9coce - Les param\u00e8tres sont valid\u00e9s avant d'envoyer des requ\u00eates pour \u00e9viter des appels API inutiles</li> <li>Journalisation configurable - Permet d'ajuster le niveau de journalisation selon les besoins</li> </ul>"},{"location":"explanation/architecture/#securite","title":"S\u00e9curit\u00e9","text":"<ul> <li>Pas de stockage persistant de credentials - Les identifiants ne sont jamais \u00e9crits sur disque</li> <li>Communication HTTPS - Toutes les communications avec l'API MVola utilisent HTTPS</li> <li>Validation des entr\u00e9es - Toutes les entr\u00e9es utilisateur sont valid\u00e9es avant utilisation</li> <li>Scope sp\u00e9cifique - Utilisation du scope <code>EXT_INT_MVOLA_SCOPE</code> pour l'authentification</li> </ul>"},{"location":"explanation/architecture/#evolutivite","title":"\u00c9volutivit\u00e9","text":"<p>La biblioth\u00e8que est con\u00e7ue pour \u00e9voluer facilement : - Ajout de nouveaux endpoints API - Support de nouvelles fonctionnalit\u00e9s MVola - Extension \u00e0 d'autres services de paiement mobile</p>"},{"location":"explanation/architecture/#defis-techniques","title":"D\u00e9fis techniques","text":"<p>Lors du d\u00e9veloppement, plusieurs d\u00e9fis ont \u00e9t\u00e9 relev\u00e9s : - Gestion coh\u00e9rente des erreurs provenant de l'API MVola - Conception d'une API intuitive tout en exposant les fonctionnalit\u00e9s n\u00e9cessaires - \u00c9quilibre entre simplicit\u00e9 d'utilisation et flexibilit\u00e9 - Adaptation aux changements d'API avec les nouveaux formats de r\u00e9ponse standardis\u00e9s </p>"},{"location":"guides/authentication/","title":"Guide d'authentification","text":"<p>Ce guide vous explique comment configurer et g\u00e9rer l'authentification avec l'API MVola en utilisant la biblioth\u00e8que MVola API.</p>"},{"location":"guides/authentication/#obtenir-les-identifiants-api","title":"Obtenir les identifiants API","text":"<p>Avant de pouvoir vous authentifier aupr\u00e8s de l'API MVola, vous devez obtenir vos identifiants API (Consumer Key et Consumer Secret) :</p> <ol> <li>Cr\u00e9ez un compte sur le Portail D\u00e9veloppeur MVola</li> <li>Cr\u00e9ez une nouvelle application dans votre tableau de bord d\u00e9veloppeur</li> <li>Notez votre <code>Consumer Key</code> et <code>Consumer Secret</code></li> </ol>"},{"location":"guides/authentication/#types-denvironnements","title":"Types d'environnements","text":"<p>MVola offre deux environnements distincts :</p> <ul> <li>Sandbox : Environnement de test et de d\u00e9veloppement</li> <li>Production : Environnement de production pour les applications en direct</li> </ul>"},{"location":"guides/authentication/#differences-entre-les-environnements","title":"Diff\u00e9rences entre les environnements","text":"Caract\u00e9ristique Sandbox Production Transactions r\u00e9elles Non Oui Limites de transaction Illimit\u00e9es Selon la r\u00e9glementation URL de base https://devapi.mvola.mg https://api.mvola.mg N\u00e9cessite validation Non Oui"},{"location":"guides/authentication/#configuration-de-lauthentification","title":"Configuration de l'authentification","text":""},{"location":"guides/authentication/#initialisation-directe","title":"Initialisation directe","text":"<pre><code>from mvola_api import MVolaClient\n\n# Initialisation pour l'environnement sandbox\nclient = MVolaClient(\n    consumer_key=\"votre_consumer_key\",\n    consumer_secret=\"votre_consumer_secret\",\n    partner_name=\"Nom de votre application\",\n    partner_msisdn=\"0343500003\",  # Votre num\u00e9ro MVola\n    base_url=\"https://devapi.mvola.mg\"  # URL pour l'environnement sandbox\n)\n\n# Ou pour la production\nclient = MVolaClient(\n    consumer_key=\"votre_consumer_key\",\n    consumer_secret=\"votre_consumer_secret\",\n    partner_name=\"Nom de votre application\",\n    partner_msisdn=\"0343500003\",  # Votre num\u00e9ro MVola\n    base_url=\"https://api.mvola.mg\"  # URL pour l'environnement de production\n)\n</code></pre>"},{"location":"guides/authentication/#utilisation-des-variables-denvironnement","title":"Utilisation des variables d'environnement","text":"<p>Pour une meilleure s\u00e9curit\u00e9, il est recommand\u00e9 de stocker vos identifiants dans des variables d'environnement :</p> <p>Cr\u00e9ez un fichier <code>.env</code> \u00e0 la racine de votre projet :</p> <pre><code>MVOLA_CONSUMER_KEY=votre_consumer_key\nMVOLA_CONSUMER_SECRET=votre_consumer_secret\nMVOLA_PARTNER_NAME=Nom de votre application\nMVOLA_PARTNER_MSISDN=0343500003\nMVOLA_BASE_URL=https://devapi.mvola.mg\n</code></pre> <p>Puis, dans votre code :</p> <pre><code>import os\nfrom dotenv import load_dotenv\nfrom mvola_api import MVolaClient\n\n# Charger les variables d'environnement\nload_dotenv()\n\n# Initialisation avec les variables d'environnement\nclient = MVolaClient(\n    consumer_key=os.getenv(\"MVOLA_CONSUMER_KEY\"),\n    consumer_secret=os.getenv(\"MVOLA_CONSUMER_SECRET\"),\n    partner_name=os.getenv(\"MVOLA_PARTNER_NAME\"),\n    partner_msisdn=os.getenv(\"MVOLA_PARTNER_MSISDN\"),\n    base_url=os.getenv(\"MVOLA_BASE_URL\")\n)\n</code></pre>"},{"location":"guides/authentication/#processus-dauthentification","title":"Processus d'authentification","text":"<p>L'authentification MVola utilise le protocole OAuth 2.0 avec le flux <code>client_credentials</code> et le scope <code>EXT_INT_MVOLA_SCOPE</code>. Voici comment cela fonctionne :</p> <ol> <li>La biblioth\u00e8que MVola API envoie une requ\u00eate \u00e0 l'endpoint <code>/token</code> avec :</li> <li>Un en-t\u00eate <code>Authorization: Basic</code> contenant vos credentials encod\u00e9s en Base64</li> <li> <p>Des donn\u00e9es de formulaire contenant <code>grant_type=client_credentials</code> et <code>scope=EXT_INT_MVOLA_SCOPE</code></p> </li> <li> <p>Le serveur MVola r\u00e9pond avec un token d'acc\u00e8s :    <pre><code>{\n  \"access_token\": \"&lt;ACCESS_TOKEN&gt;\",\n  \"scope\": \"EXT_INT_MVOLA_SCOPE\",\n  \"token_type\": \"Bearer\",\n  \"expires_in\": 3600\n}\n</code></pre></p> </li> <li> <p>Ce token est ensuite utilis\u00e9 pour authentifier toutes les requ\u00eates suivantes \u00e0 l'API MVola.</p> </li> </ol>"},{"location":"guides/authentication/#gestion-des-tokens","title":"Gestion des tokens","text":""},{"location":"guides/authentication/#comment-la-bibliotheque-gere-les-tokens","title":"Comment la biblioth\u00e8que g\u00e8re les tokens","text":"<p>La biblioth\u00e8que MVola API g\u00e8re automatiquement les tokens d'authentification pour vous :</p> <ol> <li>La premi\u00e8re fois que vous effectuez une op\u00e9ration, un token est g\u00e9n\u00e9r\u00e9</li> <li>Ce token est stock\u00e9 en m\u00e9moire</li> <li>Pour les op\u00e9rations suivantes, le token existant est utilis\u00e9</li> <li>Si le token est expir\u00e9, un nouveau token est g\u00e9n\u00e9r\u00e9 automatiquement</li> </ol> <p>Vous n'avez g\u00e9n\u00e9ralement pas besoin de manipuler les tokens directement.</p>"},{"location":"guides/authentication/#cycle-de-vie-des-tokens","title":"Cycle de vie des tokens","text":"<pre><code># Le token est g\u00e9n\u00e9r\u00e9 automatiquement lors de la premi\u00e8re utilisation\ntransaction_info = client.initiate_merchant_payment(...)\n\n# Pour acc\u00e9der manuellement au token (rarement n\u00e9cessaire)\ntoken = client.auth.get_valid_token()\nprint(f\"Token: {token['access_token']}\")\nprint(f\"Expire dans: {token['expires_in']} secondes\")\n\n# V\u00e9rifier si un token est expir\u00e9\nis_expired = client.auth.is_token_expired()\nprint(f\"Token expir\u00e9: {is_expired}\")\n\n# Forcer le rafra\u00eechissement du token\nclient.auth.refresh_token()\n</code></pre>"},{"location":"guides/authentication/#gestion-des-erreurs-dauthentification","title":"Gestion des erreurs d'authentification","text":"<p>Les erreurs d'authentification sont g\u00e9r\u00e9es par des exceptions sp\u00e9cifiques :</p> <pre><code>from mvola_api.exceptions import MVolaAuthError, MVolaInvalidCredentialsError\n\ntry:\n    # Une op\u00e9ration qui n\u00e9cessite une authentification\n    client.initiate_merchant_payment(\n        amount=1000,\n        debit_msisdn=\"0343500003\",\n        credit_msisdn=\"0343500004\",\n        requesting_organisation_transaction_reference=\"REF123456\",\n        description=\"Paiement test\"\n    )\nexcept MVolaInvalidCredentialsError as e:\n    print(f\"Identifiants API invalides: {e}\")\n    # V\u00e9rifiez vos consumer_key et consumer_secret\nexcept MVolaAuthError as e:\n    print(f\"Erreur d'authentification: {e}\")\n    # G\u00e9rer les autres erreurs d'authentification\n</code></pre>"},{"location":"guides/authentication/#codes-derreur-http","title":"Codes d'erreur HTTP","text":"<p>L'API MVola utilise les codes d'erreur HTTP standard pour indiquer le r\u00e9sultat des requ\u00eates d'authentification :</p> Code Description 200 OK - La requ\u00eate a r\u00e9ussi 400 Bad Request - Requ\u00eate incorrecte, souvent en raison d'un param\u00e8tre manquant 401 Unauthorized - Cl\u00e9 API invalide fournie 402 Request Failed - Les param\u00e8tres sont valides mais la requ\u00eate a \u00e9chou\u00e9 403 Forbidden - La cl\u00e9 API n'a pas les permissions n\u00e9cessaires 404 Not Found - La ressource demand\u00e9e n'existe pas 409 Conflict - La requ\u00eate est en conflit avec une autre requ\u00eate 429 Too Many Requests - Trop de requ\u00eates envoy\u00e9es \u00e0 l'API trop rapidement 500, 502, 503, 504 Server Errors - Erreur au niveau du serveur"},{"location":"guides/authentication/#bonnes-pratiques-de-securite","title":"Bonnes pratiques de s\u00e9curit\u00e9","text":"<ol> <li>Ne stockez jamais les identifiants API dans le code source - Utilisez des variables d'environnement ou un service de gestion de secrets</li> <li>Ne partagez jamais vos identifiants API - Chaque application doit avoir ses propres identifiants</li> <li>Utilisez HTTPS pour toutes les communications - La biblioth\u00e8que MVola API le fait automatiquement</li> <li>Impl\u00e9mentez un syst\u00e8me de rotation des identifiants pour les applications de production</li> <li>Journalisez les tentatives d'authentification \u00e9chou\u00e9es pour d\u00e9tecter les abus potentiels</li> </ol>"},{"location":"guides/authentication/#passage-en-production","title":"Passage en production","text":"<p>Lorsque vous \u00eates pr\u00eat \u00e0 passer en production :</p> <ol> <li>Suivez le processus \"GO LIVE\" sur le portail d\u00e9veloppeur MVola</li> <li>Obtenez des identifiants API de production aupr\u00e8s de MVola</li> <li>Mettez \u00e0 jour votre configuration pour utiliser l'URL de production <code>https://api.mvola.mg</code></li> <li>Assurez-vous que votre application respecte toutes les exigences de s\u00e9curit\u00e9</li> <li>Effectuez des tests de bout en bout avec des montants minimes avant de manipuler des transactions plus importantes</li> </ol>"},{"location":"guides/authentication/#prochaines-etapes","title":"Prochaines \u00e9tapes","text":"<p>Une fois l'authentification configur\u00e9e, vous pouvez commencer \u00e0 effectuer des transactions. Consultez le Guide des transactions pour apprendre \u00e0 initier des paiements et \u00e0 v\u00e9rifier leur statut. </p>"},{"location":"guides/error-handling/","title":"Guide de gestion des erreurs","text":"<p>Ce guide explique comment g\u00e9rer efficacement les erreurs qui peuvent survenir lors de l'utilisation de la biblioth\u00e8que MVola API.</p>"},{"location":"guides/error-handling/#introduction","title":"Introduction","text":"<p>La biblioth\u00e8que MVola API utilise un syst\u00e8me d'exceptions hi\u00e9rarchique pour vous permettre de g\u00e9rer facilement les diff\u00e9rents types d'erreurs qui peuvent se produire lors des op\u00e9rations avec l'API MVola. Ce guide couvre les codes d'erreur standard de l'API MVola et comment les g\u00e9rer efficacement dans votre application.</p>"},{"location":"guides/error-handling/#hierarchie-des-exceptions","title":"Hi\u00e9rarchie des exceptions","text":"<pre><code>MVolaError (Exception de base)\n\u251c\u2500\u2500 MVolaAuthError (Erreurs d'authentification)\n\u2502   \u251c\u2500\u2500 MVolaInvalidCredentialsError\n\u2502   \u2514\u2500\u2500 MVolaTokenExpiredError\n\u251c\u2500\u2500 MVolaTransactionError (Erreurs de transaction)\n\u2502   \u251c\u2500\u2500 MVolaTransactionValidationError\n\u2502   \u251c\u2500\u2500 MVolaTransactionStatusError\n\u2502   \u2514\u2500\u2500 MVolaTransactionCreationError\n\u251c\u2500\u2500 MVolaValidationError (Erreurs de validation)\n\u2502   \u2514\u2500\u2500 MVolaInvalidParameterError\n\u251c\u2500\u2500 MVolaConnectionError (Erreurs de connexion)\n\u2502   \u251c\u2500\u2500 MVolaRequestTimeoutError\n\u2502   \u2514\u2500\u2500 MVolaServerError\n\u2514\u2500\u2500 MVolaConfigError (Erreurs de configuration)\n</code></pre> <p>Cette hi\u00e9rarchie vous permet de capturer des erreurs \u00e0 diff\u00e9rents niveaux de sp\u00e9cificit\u00e9 selon vos besoins.</p>"},{"location":"guides/error-handling/#codes-derreur-http-de-lapi-mvola","title":"Codes d'erreur HTTP de l'API MVola","text":"<p>L'API MVola utilise les codes d'erreur HTTP standard pour indiquer si une requ\u00eate a r\u00e9ussi ou \u00e9chou\u00e9. Voici les principaux codes que vous pourriez rencontrer :</p> Code Description Traitement recommand\u00e9 200 OK - La requ\u00eate a r\u00e9ussi Traiter la r\u00e9ponse normalement 400 Bad Request - Requ\u00eate incorrecte, souvent en raison d'un param\u00e8tre manquant V\u00e9rifier les param\u00e8tres de votre requ\u00eate 401 Unauthorized - Cl\u00e9 API invalide fournie V\u00e9rifier vos identifiants d'API ou g\u00e9n\u00e9rer un nouveau token 402 Request Failed - Les param\u00e8tres sont valides mais la requ\u00eate a \u00e9chou\u00e9 V\u00e9rifier l'\u00e9tat du compte MVola ou les limites de transaction 403 Forbidden - La cl\u00e9 API n'a pas les permissions n\u00e9cessaires Demander les autorisations appropri\u00e9es pour votre application 404 Not Found - La ressource demand\u00e9e n'existe pas V\u00e9rifier l'URL ou l'ID de la ressource 409 Conflict - La requ\u00eate est en conflit avec une autre requ\u00eate \u00c9viter les requ\u00eates dupliqu\u00e9es ou attendez et r\u00e9essayez 429 Too Many Requests - Trop de requ\u00eates envoy\u00e9es \u00e0 l'API trop rapidement Impl\u00e9menter un syst\u00e8me de backoff exponentiel 500, 502, 503, 504 Server Errors - Erreur au niveau du serveur Attendre et r\u00e9essayer plus tard"},{"location":"guides/error-handling/#format-des-reponses-derreur","title":"Format des r\u00e9ponses d'erreur","text":"<p>Les erreurs de l'API MVola sont g\u00e9n\u00e9ralement retourn\u00e9es au format JSON avec la structure suivante :</p> <pre><code>{\n  \"ErrorCategory\": \"Cat\u00e9gorie de l'erreur\",\n  \"ErrorCode\": \"Code d'erreur sp\u00e9cifique\",\n  \"ErrorDescription\": \"Description d\u00e9taill\u00e9e de l'erreur\",\n  \"ErrorDateTime\": \"Date et heure de l'erreur\",\n  \"ErrorParameters\": {\n    \"key1\": \"value1\",\n    \"key2\": \"value2\"\n  }\n}\n</code></pre> <p>Pour les erreurs d'authentification, le format peut \u00eatre diff\u00e9rent :</p> <pre><code>{\n  \"fault\": {\n    \"code\": 900901,\n    \"message\": \"Invalid Credentials\",\n    \"description\": \"Invalid Credentials. Make sure you have given the correct access token\"\n  }\n}\n</code></pre> <p>La biblioth\u00e8que MVola API analyse ces r\u00e9ponses d'erreur et les convertit en exceptions appropri\u00e9es que vous pouvez g\u00e9rer dans votre code.</p>"},{"location":"guides/error-handling/#importation-des-exceptions","title":"Importation des exceptions","text":"<pre><code>from mvola_api.exceptions import (\n    MVolaError,                    # Exception de base\n    MVolaAuthError,                # Erreurs d'authentification\n    MVolaInvalidCredentialsError,  # Identifiants invalides\n    MVolaTokenExpiredError,        # Token expir\u00e9\n    MVolaTransactionError,         # Erreurs de transaction\n    MVolaTransactionValidationError, # Validation de transaction\n    MVolaTransactionStatusError,   # Erreur de statut\n    MVolaTransactionCreationError, # Cr\u00e9ation de transaction\n    MVolaValidationError,          # Erreurs de validation\n    MVolaInvalidParameterError,    # Param\u00e8tre invalide\n    MVolaConnectionError,          # Erreurs de connexion\n    MVolaRequestTimeoutError,      # Timeout\n    MVolaServerError,              # Erreur serveur\n    MVolaConfigError               # Erreurs de configuration\n)\n</code></pre>"},{"location":"guides/error-handling/#gestion-basique-des-erreurs","title":"Gestion basique des erreurs","text":"<p>La fa\u00e7on la plus simple de g\u00e9rer les erreurs est d'utiliser un bloc try/except pour capturer toutes les erreurs MVola :</p> <pre><code>from mvola_api import MVolaClient\nfrom mvola_api.exceptions import MVolaError\n\ntry:\n    # Initialiser le client\n    client = MVolaClient(\n        consumer_key=\"votre_consumer_key\",\n        consumer_secret=\"votre_consumer_secret\",\n        partner_name=\"Nom de votre application\",\n        partner_msisdn=\"0343500003\",\n        sandbox=True\n    )\n\n    # Initier un paiement\n    transaction_info = client.initiate_payment(\n        amount=1000,\n        debit_msisdn=\"0343500003\",\n        credit_msisdn=\"0343500004\",\n        reference=\"REF123456\",\n        description=\"Paiement test\"\n    )\n\n    print(f\"Transaction initi\u00e9e avec succ\u00e8s: {transaction_info}\")\n\nexcept MVolaError as e:\n    print(f\"Une erreur MVola s'est produite: {e}\")\n    # G\u00e9rer l'erreur (journalisation, notification, etc.)\n</code></pre>"},{"location":"guides/error-handling/#gestion-avancee-des-erreurs","title":"Gestion avanc\u00e9e des erreurs","text":"<p>Pour une gestion plus pr\u00e9cise, vous pouvez capturer des types d'exceptions sp\u00e9cifiques :</p> <pre><code>from mvola_api import MVolaClient\nfrom mvola_api.exceptions import (\n    MVolaInvalidCredentialsError,\n    MVolaTransactionValidationError,\n    MVolaConnectionError,\n    MVolaError\n)\n\ntry:\n    # Initialiser le client\n    client = MVolaClient(\n        consumer_key=\"votre_consumer_key\",\n        consumer_secret=\"votre_consumer_secret\",\n        partner_name=\"Nom de votre application\",\n        partner_msisdn=\"0343500003\",\n        sandbox=True\n    )\n\n    # Initier un paiement\n    transaction_info = client.initiate_payment(\n        amount=1000,\n        debit_msisdn=\"0343500003\",\n        credit_msisdn=\"0343500004\",\n        reference=\"REF123456\",\n        description=\"Paiement test\"\n    )\n\n    print(f\"Transaction initi\u00e9e avec succ\u00e8s: {transaction_info}\")\n\nexcept MVolaInvalidCredentialsError as e:\n    print(f\"Identifiants invalides: {e}\")\n    # Sugg\u00e9rer de v\u00e9rifier les identifiants API\n\nexcept MVolaTransactionValidationError as e:\n    print(f\"Donn\u00e9es de transaction invalides: {e}\")\n    # Afficher des messages d'erreur sp\u00e9cifiques aux champs\n\nexcept MVolaConnectionError as e:\n    print(f\"Erreur de connexion: {e}\")\n    # Sugg\u00e9rer de v\u00e9rifier la connexion Internet ou de r\u00e9essayer plus tard\n\nexcept MVolaError as e:\n    print(f\"Autre erreur MVola: {e}\")\n    # G\u00e9rer les autres erreurs MVola\n\nexcept Exception as e:\n    print(f\"Erreur inattendue: {e}\")\n    # Capturer toute autre erreur non pr\u00e9vue\n</code></pre>"},{"location":"guides/error-handling/#types-derreurs-specifiques","title":"Types d'erreurs sp\u00e9cifiques","text":""},{"location":"guides/error-handling/#erreurs-dauthentification","title":"Erreurs d'authentification","text":"<pre><code>try:\n    # Tenter de g\u00e9n\u00e9rer un token avec des identifiants invalides\n    client.generate_token()\nexcept MVolaInvalidCredentialsError as e:\n    print(f\"Identifiants invalides: {e}\")\n    print(f\"Code d'erreur: {e.error_code}\")\n    # Sugg\u00e9rer de v\u00e9rifier les identifiants ou de g\u00e9n\u00e9rer de nouvelles cl\u00e9s\nexcept MVolaTokenExpiredError as e:\n    print(f\"Token expir\u00e9: {e}\")\n    # Rafra\u00eechir le token et r\u00e9essayer\n    client.refresh_token()\n</code></pre>"},{"location":"guides/error-handling/#erreurs-de-transaction","title":"Erreurs de transaction","text":"<pre><code>try:\n    # Tenter un paiement avec des donn\u00e9es invalides\n    client.initiate_merchant_payment(\n        amount=-100,  # Montant n\u00e9gatif (invalide)\n        currency=\"Ar\",\n        debit_msisdn=\"0343500003\",\n        credit_msisdn=\"0343500004\",\n        requesting_organisation_transaction_reference=\"REF123456\",\n        description=\"Paiement test\"\n    )\nexcept MVolaTransactionValidationError as e:\n    print(f\"Validation \u00e9chou\u00e9e: {e}\")\n    print(f\"Champ en erreur: {e.field}\")\n    print(f\"D\u00e9tails: {e.details}\")\n    # Afficher un message d'erreur appropri\u00e9 \u00e0 l'utilisateur\n\nexcept MVolaTransactionStatusError as e:\n    print(f\"Erreur de statut: {e}\")\n    print(f\"ID de transaction: {e.transaction_id}\")\n    # Sugg\u00e9rer de v\u00e9rifier l'ID de transaction\n\nexcept MVolaTransactionCreationError as e:\n    print(f\"Erreur lors de la cr\u00e9ation: {e}\")\n    print(f\"D\u00e9tails: {e.details}\")\n    # Sugg\u00e9rer de r\u00e9essayer plus tard\n</code></pre>"},{"location":"guides/error-handling/#erreurs-de-validation","title":"Erreurs de validation","text":"<pre><code>from mvola_api.utils import validate_msisdn\n\ntry:\n    # Valider un num\u00e9ro de t\u00e9l\u00e9phone\n    validate_msisdn(\"abcdef\")  # Format invalide\nexcept MVolaValidationError as e:\n    print(f\"Erreur de validation: {e}\")\n    # Afficher un message d'erreur appropri\u00e9\n</code></pre>"},{"location":"guides/error-handling/#erreurs-de-connexion","title":"Erreurs de connexion","text":"<pre><code>try:\n    # Tenter une op\u00e9ration qui peut \u00e9chouer en raison de probl\u00e8mes r\u00e9seau\n    status = client.get_transaction_status(\n        transaction_id=\"transaction-id-12345\",\n        msisdn=\"0343500003\"\n    )\nexcept MVolaRequestTimeoutError as e:\n    print(f\"D\u00e9lai d'attente d\u00e9pass\u00e9: {e}\")\n    print(f\"URL: {e.url}\")\n    print(f\"Timeout: {e.timeout} secondes\")\n    # Sugg\u00e9rer de r\u00e9essayer plus tard\n\nexcept MVolaServerError as e:\n    print(f\"Erreur serveur MVola: {e}\")\n    print(f\"Code HTTP: {e.status_code}\")\n    print(f\"R\u00e9ponse: {e.response}\")\n    # Sugg\u00e9rer de contacter le support MVola si le probl\u00e8me persiste\n</code></pre>"},{"location":"guides/error-handling/#techniques-de-gestion-des-erreurs","title":"Techniques de gestion des erreurs","text":""},{"location":"guides/error-handling/#approche-hierarchique","title":"Approche hi\u00e9rarchique","text":"<p>Attrapez d'abord les exceptions les plus sp\u00e9cifiques, puis les plus g\u00e9n\u00e9rales :</p> <pre><code>try:\n    # Code utilisant MVola API\nexcept MVolaInvalidCredentialsError as e:\n    # G\u00e9rer les erreurs d'identifiants sp\u00e9cifiquement\n    print(f\"Identifiants invalides: {e}\")\nexcept MVolaAuthError as e:\n    # G\u00e9rer les autres erreurs d'authentification\n    print(f\"Erreur d'authentification: {e}\")\nexcept MVolaTransactionError as e:\n    # G\u00e9rer les erreurs de transaction\n    print(f\"Erreur de transaction: {e}\")\nexcept MVolaError as e:\n    # G\u00e9rer toutes les autres erreurs MVola\n    print(f\"Erreur MVola: {e}\")\nexcept Exception as e:\n    # Attraper toutes les autres exceptions Python\n    print(f\"Erreur inattendue: {e}\")\n</code></pre>"},{"location":"guides/error-handling/#gestion-avec-retries","title":"Gestion avec retries","text":"<p>Pour certaines erreurs temporaires (timeout, erreurs serveur), vous pouvez impl\u00e9menter une strat\u00e9gie de retry :</p> <pre><code>from mvola_api.exceptions import MVolaRequestTimeoutError, MVolaServerError\nimport time\n\nmax_retries = 3\nretry_count = 0\nbackoff_factor = 2  # Pour le backoff exponentiel\n\nwhile retry_count &lt; max_retries:\n    try:\n        # Tenter une op\u00e9ration MVola\n        result = client.initiate_payment(\n            amount=1000,\n            debit_msisdn=\"0343500003\",\n            credit_msisdn=\"0343500004\",\n            reference=\"REF123456\",\n            description=\"Paiement test\"\n        )\n        # Succ\u00e8s, sortir de la boucle\n        break\n\n    except (MVolaRequestTimeoutError, MVolaServerError) as e:\n        # Incr\u00e9menter le compteur de tentatives\n        retry_count += 1\n\n        # Si nous avons atteint le maximum de tentatives, lever l'exception\n        if retry_count &gt;= max_retries:\n            print(f\"\u00c9chec apr\u00e8s {max_retries} tentatives: {e}\")\n            raise\n\n        # Calculer le temps d'attente avec backoff exponentiel\n        wait_time = backoff_factor ** retry_count\n        print(f\"Erreur temporaire: {e}. Nouvelle tentative dans {wait_time}s...\")\n\n        # Attendre avant de r\u00e9essayer\n        time.sleep(wait_time)\n</code></pre>"},{"location":"guides/error-handling/#validation-preventive","title":"Validation pr\u00e9ventive","text":"<p>Pour \u00e9viter certaines exceptions, validez vos donn\u00e9es avant d'appeler l'API :</p> <pre><code>from mvola_api.utils import validate_msisdn, validate_required_params\n\n# Donn\u00e9es \u00e0 valider\npayment_data = {\n    \"amount\": 1000,\n    \"debit_msisdn\": \"0343500003\",\n    \"credit_msisdn\": \"0343500004\",\n    \"reference\": \"REF123456\",\n    \"description\": \"Paiement test\"\n}\n\n# Param\u00e8tres requis\nrequired_params = [\"amount\", \"debit_msisdn\", \"credit_msisdn\", \"reference\", \"description\"]\n\ntry:\n    # Valider que tous les param\u00e8tres requis sont pr\u00e9sents\n    validate_required_params(payment_data, required_params)\n\n    # Valider les num\u00e9ros de t\u00e9l\u00e9phone\n    validate_msisdn(payment_data[\"debit_msisdn\"])\n    validate_msisdn(payment_data[\"credit_msisdn\"])\n\n    # Valider le montant\n    if payment_data[\"amount\"] &lt;= 0:\n        raise MVolaValidationError(\"Le montant doit \u00eatre positif\")\n\n    # Si toutes les validations passent, initier le paiement\n    transaction_info = client.initiate_payment(**payment_data)\n\nexcept MVolaValidationError as e:\n    # G\u00e9rer les erreurs de validation\n    print(f\"Erreur de validation: {e}\")\n</code></pre>"},{"location":"guides/error-handling/#journalisation-des-erreurs","title":"Journalisation des erreurs","text":"<p>Il est recommand\u00e9 de journaliser les erreurs pour faciliter le d\u00e9bogage :</p> <pre><code>import logging\n\n# Configurer le logger\nlogger = logging.getLogger(\"mvola\")\nlogger.setLevel(logging.DEBUG)\n\n# Ajouter un handler pour \u00e9crire dans un fichier\nfile_handler = logging.FileHandler(\"mvola_errors.log\")\nfile_handler.setFormatter(logging.Formatter(\"%(asctime)s - %(name)s - %(levelname)s - %(message)s\"))\nlogger.addHandler(file_handler)\n\ntry:\n    # Code utilisant MVola API\n    result = client.initiate_payment(...)\nexcept MVolaError as e:\n    # Journaliser l'erreur avec les d\u00e9tails appropri\u00e9s\n    logger.error(f\"Erreur MVola: {e}\", exc_info=True)\n    logger.error(f\"D\u00e9tails: {e.details if hasattr(e, 'details') else 'Pas de d\u00e9tails'}\")\n\n    # Vous pouvez \u00e9galement inclure des informations contextuelles\n    logger.error(f\"Contexte: initiation de paiement pour la r\u00e9f\u00e9rence {reference}\")\n\n    # R\u00e9pondre \u00e0 l'utilisateur avec un message appropri\u00e9\n    print(\"Une erreur s'est produite lors du traitement de votre paiement. Veuillez r\u00e9essayer plus tard.\")\n</code></pre>"},{"location":"guides/error-handling/#messages-derreur-conviviaux","title":"Messages d'erreur conviviaux","text":"<p>Transformez les erreurs techniques en messages compr\u00e9hensibles pour l'utilisateur final :</p> <pre><code>def get_user_friendly_message(exception):\n    \"\"\"Convertit une exception MVola en message utilisateur convivial\"\"\"\n\n    if isinstance(exception, MVolaInvalidCredentialsError):\n        return \"Impossible de se connecter au service MVola. Veuillez contacter le support.\"\n\n    elif isinstance(exception, MVolaTokenExpiredError):\n        return \"Votre session a expir\u00e9. Veuillez rafra\u00eechir la page et r\u00e9essayer.\"\n\n    elif isinstance(exception, MVolaTransactionValidationError):\n        if getattr(exception, 'field', '') == 'amount':\n            return \"Le montant sp\u00e9cifi\u00e9 n'est pas valide. Veuillez v\u00e9rifier et r\u00e9essayer.\"\n        elif getattr(exception, 'field', '') in ['debit_msisdn', 'credit_msisdn']:\n            return \"Le num\u00e9ro de t\u00e9l\u00e9phone fourni n'est pas valide. Veuillez v\u00e9rifier et r\u00e9essayer.\"\n        else:\n            return \"Certaines informations de paiement ne sont pas valides. Veuillez v\u00e9rifier et r\u00e9essayer.\"\n\n    elif isinstance(exception, MVolaTransactionStatusError):\n        return \"Impossible de v\u00e9rifier le statut de la transaction. Veuillez r\u00e9essayer plus tard.\"\n\n    elif isinstance(exception, MVolaConnectionError):\n        return \"Probl\u00e8me de connexion au service MVola. Veuillez v\u00e9rifier votre connexion Internet et r\u00e9essayer.\"\n\n    elif isinstance(exception, MVolaError):\n        return \"Une erreur s'est produite lors du traitement de votre paiement. Veuillez r\u00e9essayer plus tard.\"\n\n    else:\n        return \"Une erreur inattendue s'est produite. Veuillez r\u00e9essayer plus tard.\"\n\n# Exemple d'utilisation\ntry:\n    # Code utilisant MVola API\n    result = client.initiate_payment(...)\nexcept Exception as e:\n    # Journaliser l'erreur technique d\u00e9taill\u00e9e\n    logger.error(f\"Erreur: {e}\", exc_info=True)\n\n    # Afficher un message convivial \u00e0 l'utilisateur\n    user_message = get_user_friendly_message(e)\n    print(user_message)\n</code></pre>"},{"location":"guides/error-handling/#bonnes-pratiques-pour-la-gestion-des-erreurs","title":"Bonnes pratiques pour la gestion des erreurs","text":"<ol> <li> <p>Utilisez la hi\u00e9rarchie d'exceptions pour capturer les erreurs \u00e0 diff\u00e9rents niveaux de sp\u00e9cificit\u00e9.</p> </li> <li> <p>Validez les donn\u00e9es en amont pour \u00e9viter les erreurs pr\u00e9visibles.</p> </li> <li> <p>Impl\u00e9mentez des retries pour les erreurs temporaires, avec un backoff exponentiel.</p> </li> <li> <p>Journalisez les erreurs avec suffisamment de contexte pour faciliter le d\u00e9bogage.</p> </li> <li> <p>Pr\u00e9sentez des messages d'erreur conviviaux \u00e0 l'utilisateur final, sans exposer les d\u00e9tails techniques.</p> </li> <li> <p>Testez vos sc\u00e9narios d'erreur pour vous assurer que votre application les g\u00e8re correctement.</p> </li> <li> <p>Mettez en place une surveillance pour \u00eatre alert\u00e9 des erreurs r\u00e9currentes.</p> </li> </ol>"},{"location":"guides/error-handling/#exemple-complet","title":"Exemple complet","text":"<p>Voici un exemple complet combinant plusieurs techniques de gestion des erreurs :</p> <pre><code>import time\nimport logging\nfrom mvola_api import MVolaClient\nfrom mvola_api.exceptions import (\n    MVolaInvalidCredentialsError,\n    MVolaTokenExpiredError,\n    MVolaTransactionValidationError,\n    MVolaConnectionError,\n    MVolaRequestTimeoutError,\n    MVolaServerError,\n    MVolaError\n)\n\n# Configuration du logging\nlogger = logging.getLogger(\"mvola\")\nlogger.setLevel(logging.DEBUG)\nhandler = logging.FileHandler(\"mvola.log\")\nhandler.setFormatter(logging.Formatter(\"%(asctime)s - %(name)s - %(levelname)s - %(message)s\"))\nlogger.addHandler(handler)\n\ndef process_payment(amount, debit_msisdn, credit_msisdn, description):\n    \"\"\"\n    Traite un paiement MVola avec une gestion compl\u00e8te des erreurs.\n\n    Args:\n        amount: Montant du paiement\n        debit_msisdn: Num\u00e9ro du payeur\n        credit_msisdn: Num\u00e9ro du b\u00e9n\u00e9ficiaire\n        description: Description du paiement\n\n    Returns:\n        dict: R\u00e9sultat de la transaction ou information d'erreur\n    \"\"\"\n    # G\u00e9n\u00e9rer une r\u00e9f\u00e9rence unique\n    from mvola_api.utils import generate_reference\n    reference = generate_reference(prefix=\"PAY\")\n\n    # Initialiser le client\n    try:\n        client = MVolaClient(\n            consumer_key=\"votre_consumer_key\",\n            consumer_secret=\"votre_consumer_secret\",\n            partner_name=\"Nom de votre application\",\n            partner_msisdn=\"0343500003\",\n            sandbox=True,\n            logger=logger\n        )\n    except MVolaInvalidCredentialsError as e:\n        logger.error(f\"Erreur d'initialisation - identifiants invalides: {e}\")\n        return {\"success\": False, \"message\": \"Configuration incorrecte du service de paiement\"}\n    except MVolaError as e:\n        logger.error(f\"Erreur d'initialisation: {e}\")\n        return {\"success\": False, \"message\": \"Impossible d'initialiser le service de paiement\"}\n\n    # Validation des donn\u00e9es\n    try:\n        from mvola_api.utils import validate_msisdn\n        validate_msisdn(debit_msisdn)\n        validate_msisdn(credit_msisdn)\n\n        if amount &lt;= 0:\n            raise MVolaTransactionValidationError(\"Le montant doit \u00eatre positif\", field=\"amount\")\n    except MVolaTransactionValidationError as e:\n        logger.error(f\"Validation \u00e9chou\u00e9e: {e}\")\n        if e.field == \"amount\":\n            return {\"success\": False, \"message\": \"Le montant sp\u00e9cifi\u00e9 n'est pas valide\"}\n        else:\n            return {\"success\": False, \"message\": \"Le num\u00e9ro de t\u00e9l\u00e9phone fourni n'est pas valide\"}\n\n    # Initier le paiement avec retry pour les erreurs temporaires\n    max_retries = 3\n    retry_count = 0\n\n    while retry_count &lt; max_retries:\n        try:\n            transaction_info = client.initiate_payment(\n                amount=amount,\n                debit_msisdn=debit_msisdn,\n                credit_msisdn=credit_msisdn,\n                reference=reference,\n                description=description\n            )\n\n            # Transaction initi\u00e9e avec succ\u00e8s\n            transaction_id = transaction_info.get('server_correlation_id')\n            logger.info(f\"Transaction initi\u00e9e avec succ\u00e8s. ID: {transaction_id}\")\n\n            # V\u00e9rification du statut initial\n            status_info = client.get_transaction_status(\n                transaction_id=transaction_id,\n                msisdn=debit_msisdn\n            )\n\n            return {\n                \"success\": True,\n                \"transaction_id\": transaction_id,\n                \"reference\": reference,\n                \"status\": status_info.get('status'),\n                \"message\": \"Transaction initi\u00e9e avec succ\u00e8s\"\n            }\n\n        except (MVolaRequestTimeoutError, MVolaServerError) as e:\n            # Erreurs temporaires - impl\u00e9menter retry\n            retry_count += 1\n            wait_time = 2 ** retry_count\n\n            logger.warning(f\"Erreur temporaire: {e}. Tentative {retry_count}/{max_retries} dans {wait_time}s\")\n\n            if retry_count &gt;= max_retries:\n                logger.error(f\"\u00c9chec apr\u00e8s {max_retries} tentatives: {e}\")\n                return {\"success\": False, \"message\": \"Le service de paiement est temporairement indisponible\"}\n\n            time.sleep(wait_time)\n\n        except MVolaTokenExpiredError as e:\n            # Token expir\u00e9 - rafra\u00eechir et r\u00e9essayer\n            logger.warning(f\"Token expir\u00e9: {e}\")\n            try:\n                client.refresh_token()\n                # Continuer la boucle pour r\u00e9essayer\n            except MVolaError as e:\n                logger.error(f\"Erreur lors du rafra\u00eechissement du token: {e}\")\n                return {\"success\": False, \"message\": \"Erreur d'authentification avec le service de paiement\"}\n\n        except MVolaTransactionValidationError as e:\n            # Erreur de validation - pas de retry\n            logger.error(f\"Validation \u00e9chou\u00e9e: {e}\")\n            if e.field == \"amount\":\n                return {\"success\": False, \"message\": \"Le montant sp\u00e9cifi\u00e9 n'est pas valide\"}\n            elif e.field in [\"debit_msisdn\", \"credit_msisdn\"]:\n                return {\"success\": False, \"message\": \"Le num\u00e9ro de t\u00e9l\u00e9phone fourni n'est pas valide\"}\n            else:\n                return {\"success\": False, \"message\": \"Certaines informations de paiement ne sont pas valides\"}\n\n        except MVolaConnectionError as e:\n            # Erreur de connexion\n            logger.error(f\"Erreur de connexion: {e}\")\n            return {\"success\": False, \"message\": \"Probl\u00e8me de connexion au service MVola\"}\n\n        except MVolaError as e:\n            # Autres erreurs MVola\n            logger.error(f\"Erreur MVola: {e}\")\n            return {\"success\": False, \"message\": \"Une erreur s'est produite lors du traitement de votre paiement\"}\n\n        except Exception as e:\n            # Erreur inattendue\n            logger.error(f\"Erreur inattendue: {e}\", exc_info=True)\n            return {\"success\": False, \"message\": \"Une erreur inattendue s'est produite\"}\n\n    # Ne devrait jamais atteindre ce point \u00e0 cause des returns dans la boucle\n    return {\"success\": False, \"message\": \"Erreur inattendue lors du traitement du paiement\"}\n\n# Exemple d'utilisation\nresult = process_payment(\n    amount=1000,\n    debit_msisdn=\"0343500003\",\n    credit_msisdn=\"0343500004\",\n    description=\"Paiement test\"\n)\n\nif result[\"success\"]:\n    print(f\"Paiement en cours: {result['transaction_id']}\")\n    print(f\"Statut: {result['status']}\")\nelse:\n    print(f\"Erreur: {result['message']}\")\n</code></pre>"},{"location":"guides/error-handling/#voir-aussi","title":"Voir aussi","text":"<ul> <li>R\u00e9f\u00e9rence des exceptions - Documentation technique d\u00e9taill\u00e9e de toutes les exceptions</li> <li>Guide d'authentification - Comment g\u00e9rer l'authentification</li> <li>Guide des transactions - Comment effectuer des transactions</li> <li>Exemples d'utilisation basique - Exemples simples d'utilisation de la biblioth\u00e8que</li> </ul>"},{"location":"guides/error-handling/#prochaines-etapes","title":"Prochaines \u00e9tapes","text":"<ul> <li>Consultez le guide des transactions pour en savoir plus sur l'initiation des paiements</li> <li>Explorez les exemples d'int\u00e9gration web pour voir comment g\u00e9rer les erreurs dans un contexte d'application web </li> </ul>"},{"location":"guides/installation/","title":"Installation","text":"<p>Ce guide vous aidera \u00e0 installer la biblioth\u00e8que MVola API dans votre environnement Python.</p>"},{"location":"guides/installation/#prerequis","title":"Pr\u00e9requis","text":"<ul> <li>Python 3.7 ou sup\u00e9rieur</li> <li>pip (gestionnaire de paquets Python)</li> <li>Un compte d\u00e9veloppeur MVola avec des cl\u00e9s d'API (pour l'utilisation r\u00e9elle)</li> </ul>"},{"location":"guides/installation/#installation-depuis-pypi","title":"Installation depuis PyPI","text":"<p>La m\u00e9thode recommand\u00e9e est d'installer la biblioth\u00e8que directement depuis PyPI :</p> <pre><code>pip install mvola-api-lib\n</code></pre> <p>Pour installer une version sp\u00e9cifique :</p> <pre><code>pip install mvola-api-lib==1.0.0\n</code></pre>"},{"location":"guides/installation/#installation-avec-les-extras","title":"Installation avec les extras","text":"<p>Vous pouvez installer des d\u00e9pendances suppl\u00e9mentaires en fonction de vos besoins :</p> <pre><code># Pour le d\u00e9veloppement (tests, formatage, etc.)\npip install mvola-api-lib[dev]\n\n# Pour g\u00e9n\u00e9rer la documentation\npip install mvola-api-lib[docs]\n\n# Pour ex\u00e9cuter les exemples\npip install mvola-api-lib[examples]\n\n# Pour tout installer\npip install mvola-api-lib[dev,docs,examples]\n</code></pre>"},{"location":"guides/installation/#installation-depuis-les-sources","title":"Installation depuis les sources","text":"<p>Pour installer la derni\u00e8re version de d\u00e9veloppement depuis GitHub :</p> <pre><code>git clone https://github.com/Niainarisoa01/Mvola_API_Lib.git\ncd Mvola_API_Lib\npip install -e .\n</code></pre>"},{"location":"guides/installation/#verification-de-linstallation","title":"V\u00e9rification de l'installation","text":"<p>Vous pouvez v\u00e9rifier que l'installation a r\u00e9ussi en important la biblioth\u00e8que dans Python :</p> <pre><code>import mvola_api\nprint(mvola_api.__version__)\n</code></pre>"},{"location":"guides/installation/#configuration-initiale","title":"Configuration initiale","text":"<p>Apr\u00e8s l'installation, vous devrez configurer la biblioth\u00e8que avec vos identifiants MVola Developer :</p> <pre><code>from mvola_api import MVolaClient\n\n# Configuration pour l'environnement sandbox\nclient = MVolaClient(\n    consumer_key=\"votre_consumer_key\",\n    consumer_secret=\"votre_consumer_secret\",\n    partner_name=\"Nom de votre application\",\n    partner_msisdn=\"0343500003\",  # Votre num\u00e9ro MVola\n    base_url=\"https://devapi.mvola.mg\"  # URL pour l'environnement sandbox\n)\n</code></pre>"},{"location":"guides/installation/#inscription-au-portail-mvola-developer","title":"Inscription au portail MVola Developer","text":"<p>Pour obtenir vos identifiants d'API, vous devez cr\u00e9er un compte sur le portail MVola Developer :</p> <ol> <li>Visitez https://developer.mvola.mg/</li> <li>Cliquez sur \"Connectez-vous\" puis \"S'inscrire\" si vous n'avez pas encore de compte</li> <li>Suivez les instructions pour cr\u00e9er votre compte</li> <li>Apr\u00e8s avoir confirm\u00e9 votre compte via l'email re\u00e7u, connectez-vous au portail</li> <li>D\u00e9clarez votre application en fournissant les informations requises</li> <li>Abonnez-vous aux API MVola que vous souhaitez utiliser</li> <li>G\u00e9n\u00e9rez vos cl\u00e9s API pour l'environnement sandbox</li> </ol>"},{"location":"guides/installation/#test-dans-lenvironnement-sandbox","title":"Test dans l'environnement sandbox","text":"<p>L'environnement sandbox vous permet de tester l'int\u00e9gration sans effectuer de transactions r\u00e9elles :</p> <ol> <li>Utilisez uniquement les num\u00e9ros de test fournis dans la documentation (ex: 0343500003 et 0343500004)</li> <li>Toutes les transactions initi\u00e9es dans l'environnement sandbox doivent \u00eatre approuv\u00e9es manuellement via le portail d\u00e9veloppeur</li> <li>Acc\u00e9dez \u00e0 la section \"Transaction Approvals\" du portail pour approuver vos transactions de test</li> </ol>"},{"location":"guides/installation/#passage-en-production","title":"Passage en production","text":"<p>Une fois que vous avez termin\u00e9 vos tests dans l'environnement sandbox :</p> <ol> <li>Cliquez sur le bouton \"GO LIVE\" dans le portail d\u00e9veloppeur</li> <li>Suivez les instructions pour fournir les documents et informations requises</li> <li>Une fois approuv\u00e9e, vous recevrez vos cl\u00e9s API de production</li> <li>Mettez \u00e0 jour la configuration de votre application pour utiliser l'URL de production (https://api.mvola.mg)</li> </ol>"},{"location":"guides/installation/#prochaines-etapes","title":"Prochaines \u00e9tapes","text":"<p>Apr\u00e8s l'installation, consultez le guide d'authentification pour apprendre \u00e0 configurer l'authentification avec l'API MVola. </p>"},{"location":"guides/transactions/","title":"Transactions","text":"<p>Ce guide explique comment effectuer des transactions avec la biblioth\u00e8que MVola API. Apr\u00e8s avoir configur\u00e9 l'authentification, vous pourrez initier des paiements marchands, v\u00e9rifier leur statut et r\u00e9cup\u00e9rer les d\u00e9tails des transactions.</p>"},{"location":"guides/transactions/#concepts-de-base","title":"Concepts de base","text":"<p>Dans le syst\u00e8me MVola, une transaction de paiement marchand se compose g\u00e9n\u00e9ralement de ces \u00e9l\u00e9ments essentiels :</p> <ul> <li>Montant : Le montant \u00e0 transf\u00e9rer (sans d\u00e9cimales)</li> <li>Devise : La devise (g\u00e9n\u00e9ralement \"Ar\" pour Ariary)</li> <li>MSISDN d\u00e9biteur : Le num\u00e9ro de t\u00e9l\u00e9phone qui effectue le paiement</li> <li>MSISDN cr\u00e9diteur : Le num\u00e9ro de t\u00e9l\u00e9phone du marchand qui re\u00e7oit le paiement</li> <li>Description : Description de la transaction (maximum 50 caract\u00e8res)</li> <li>R\u00e9f\u00e9rence : Une r\u00e9f\u00e9rence unique pour identifier la transaction c\u00f4t\u00e9 client (<code>requestingOrganisationTransactionReference</code>)</li> <li>URL de callback (optionnel) : Une URL pour recevoir des notifications sur le statut de la transaction</li> </ul>"},{"location":"guides/transactions/#endpoints-api","title":"Endpoints API","text":"<p>L'API MVola fournit trois endpoints principaux pour g\u00e9rer les transactions :</p> <ol> <li>Initier une transaction : <code>POST /mvola/mm/transactions/type/merchantpay/1.0.0/</code></li> <li>D\u00e9tails d'une transaction : <code>GET /mvola/mm/transactions/type/merchantpay/1.0.0/{{transID}}</code></li> <li>Statut d'une transaction : <code>GET /mvola/mm/transactions/type/merchantpay/1.0.0/status/{{serverCorrelationId}}</code></li> </ol>"},{"location":"guides/transactions/#initier-un-paiement-marchand","title":"Initier un paiement marchand","text":"<p>La m\u00e9thode <code>initiate_merchant_payment()</code> de <code>MVolaTransaction</code> vous permet d'initier un paiement marchand. Voici un exemple :</p> <pre><code>from mvola_api import MVolaClient\n\n# Initialisation du client\nclient = MVolaClient(\n    consumer_key=\"votre_consumer_key\",\n    consumer_secret=\"votre_consumer_secret\",\n    partner_name=\"NOM_DU_PARTENAIRE\",\n    partner_msisdn=\"0343500003\",\n    base_url=\"https://devapi.mvola.mg\"  # URL pour l'environnement sandbox\n)\n\n# Informations de transaction\npayment_data = {\n    \"amount\": 1000,                           # Montant sans d\u00e9cimales\n    \"currency\": \"Ar\",                         # Devise\n    \"debit_msisdn\": \"0343500003\",             # Num\u00e9ro qui paie\n    \"credit_msisdn\": \"0343500004\",            # Num\u00e9ro marchand qui re\u00e7oit\n    \"description\": \"Paiement pour produit ABC\", # Max 50 caract\u00e8res\n    \"requesting_organisation_transaction_reference\": \"REF123456\", # R\u00e9f\u00e9rence unique c\u00f4t\u00e9 client\n    \"original_transaction_reference\": \"\",     # R\u00e9f\u00e9rence de transaction originale (optionnel)\n    # M\u00e9tadonn\u00e9es optionnelles\n    \"metadata\": {\n        \"fc\": \"USD\",                          # Devise \u00e9trang\u00e8re (optionnel)\n        \"amountFc\": \"1\"                       # Montant en devise \u00e9trang\u00e8re (optionnel)\n    }\n}\n\n# Initier le paiement\ntry:\n    transaction_info = client.initiate_merchant_payment(\n        **payment_data,\n        callback_url=\"https://example.com/callback\"  # Optionnel\n    )\n\n    # R\u00e9cup\u00e9rer l'ID de corr\u00e9lation serveur pour un suivi ult\u00e9rieur\n    server_correlation_id = transaction_info.get('serverCorrelationId')\n    print(f\"Paiement initi\u00e9 avec succ\u00e8s. ID de corr\u00e9lation: {server_correlation_id}\")\n    print(f\"M\u00e9thode de notification: {transaction_info.get('notificationMethod')}\")\n\nexcept Exception as e:\n    print(f\"Erreur lors de l'initiation du paiement: {e}\")\n</code></pre>"},{"location":"guides/transactions/#reception-des-notifications-par-callback","title":"R\u00e9ception des notifications par callback","text":"<p>Si vous fournissez une URL de callback, MVola enverra une notification PUT \u00e0 cette URL lorsque le statut de la transaction change. Voici un exemple de traitement de ces notifications avec Flask :</p> <pre><code>from flask import Flask, request, jsonify\n\napp = Flask(__name__)\n\n@app.route('/callback', methods=['PUT'])\ndef mvola_callback():\n    transaction_data = request.json\n\n    # R\u00e9cup\u00e9rer les informations importantes\n    transaction_status = transaction_data.get('transactionStatus')\n    server_correlation_id = transaction_data.get('serverCorrelationId')\n    transaction_reference = transaction_data.get('transactionReference')\n\n    print(f\"Notification re\u00e7ue - Statut: {transaction_status}\")\n    print(f\"ID de corr\u00e9lation: {server_correlation_id}\")\n    print(f\"R\u00e9f\u00e9rence de transaction: {transaction_reference}\")\n\n    # Traiter selon le statut\n    if transaction_status == 'completed':\n        # Paiement r\u00e9ussi - mettre \u00e0 jour votre base de donn\u00e9es, etc.\n        print(\"Transaction r\u00e9ussie!\")\n        # Acc\u00e9der aux frais si n\u00e9cessaire\n        fees = transaction_data.get('fees', [])\n        if fees:\n            fee_amount = fees[0].get('feeAmount')\n            print(f\"Frais: {fee_amount}\")\n    elif transaction_status == 'failed':\n        # Paiement \u00e9chou\u00e9 - g\u00e9rer l'\u00e9chec\n        print(\"Transaction \u00e9chou\u00e9e!\")\n\n    # Toujours renvoyer un succ\u00e8s pour confirmer la r\u00e9ception de la notification\n    return jsonify({'status': 'notification_received'}), 200\n\nif __name__ == '__main__':\n    app.run(port=5000)\n</code></pre>"},{"location":"guides/transactions/#verifier-le-statut-dune-transaction","title":"V\u00e9rifier le statut d'une transaction","text":"<p>Apr\u00e8s avoir initi\u00e9 un paiement, vous pouvez v\u00e9rifier son statut \u00e0 l'aide de la m\u00e9thode <code>get_transaction_status()</code> avec le <code>serverCorrelationId</code> :</p> <pre><code>try:\n    status_info = client.get_transaction_status(\n        server_correlation_id=server_correlation_id\n    )\n\n    status = status_info.get('status')\n    print(f\"Statut de la transaction: {status}\")\n\n    # Traiter selon le statut\n    if status == 'completed':\n        print(\"Transaction r\u00e9ussie!\")\n    elif status == 'pending':\n        print(\"Transaction en attente...\")\n    elif status == 'failed':\n        print(\"Transaction \u00e9chou\u00e9e!\")\n\nexcept Exception as e:\n    print(f\"Erreur lors de la v\u00e9rification du statut: {e}\")\n</code></pre>"},{"location":"guides/transactions/#recuperer-les-details-dune-transaction","title":"R\u00e9cup\u00e9rer les d\u00e9tails d'une transaction","text":"<p>Vous pouvez r\u00e9cup\u00e9rer les d\u00e9tails d'une transaction \u00e0 l'aide de la m\u00e9thode <code>get_transaction_details()</code> avec l'ID de transaction retourn\u00e9 par MVola :</p> <pre><code>try:\n    # Remarque: transID est l'identifiant de transaction MVola (transactionReference)\n    transaction_details = client.get_transaction_details(\n        transaction_id=transaction_reference\n    )\n\n    # Acc\u00e9der aux d\u00e9tails de la transaction\n    amount = transaction_details.get('amount')\n    currency = transaction_details.get('currency')\n    status = transaction_details.get('transactionStatus')\n    create_date = transaction_details.get('createDate')\n\n    # Acc\u00e9der aux parties de la transaction\n    debit_party = transaction_details.get('debitParty', [])\n    credit_party = transaction_details.get('creditParty', [])\n\n    # Extraire les MSISDNs\n    debit_msisdn = next((item['value'] for item in debit_party if item['key'] == 'msisdn'), None)\n    credit_msisdn = next((item['value'] for item in credit_party if item['key'] == 'msisdn'), None)\n\n    print(f\"D\u00e9tails de la transaction: {transaction_id}\")\n    print(f\"Montant: {amount} {currency}\")\n    print(f\"Statut: {status}\")\n    print(f\"Date de cr\u00e9ation: {create_date}\")\n    print(f\"Payeur: {debit_msisdn}\")\n    print(f\"B\u00e9n\u00e9ficiaire: {credit_msisdn}\")\n\nexcept Exception as e:\n    print(f\"Erreur lors de la r\u00e9cup\u00e9ration des d\u00e9tails: {e}\")\n</code></pre>"},{"location":"guides/transactions/#gestion-des-erreurs","title":"Gestion des erreurs","text":"<p>Lors du traitement des transactions, plusieurs types d'erreurs peuvent survenir. La biblioth\u00e8que MVola API fournit des exceptions sp\u00e9cifiques pour vous aider \u00e0 les g\u00e9rer :</p> <pre><code>from mvola_api.exceptions import (\n    MVolaTransactionError,\n    MVolaValidationError,\n    MVolaConnectionError\n)\n\ntry:\n    transaction_info = client.initiate_merchant_payment(**payment_data)\n\nexcept MVolaValidationError as e:\n    print(f\"Erreur de validation: {e}\")\n    # G\u00e9rer les erreurs de validation des donn\u00e9es\n\nexcept MVolaTransactionError as e:\n    print(f\"Erreur de transaction: {e}\")\n    # G\u00e9rer les erreurs sp\u00e9cifiques aux transactions\n\nexcept MVolaConnectionError as e:\n    print(f\"Erreur de connexion: {e}\")\n    # G\u00e9rer les probl\u00e8mes de connexion \u00e0 l'API\n\nexcept Exception as e:\n    print(f\"Erreur inattendue: {e}\")\n    # G\u00e9rer toute autre erreur inattendue\n\n## Codes d'erreur HTTP\n\nL'API MVola utilise les codes d'erreur HTTP standard pour indiquer le r\u00e9sultat des requ\u00eates :\n\n| Code | Description |\n|------|-------------|\n| 200 | OK - La requ\u00eate a r\u00e9ussi |\n| 400 | Bad Request - Requ\u00eate incorrecte, souvent en raison d'un param\u00e8tre manquant |\n| 401 | Unauthorized - Cl\u00e9 API invalide fournie |\n| 402 | Request Failed - Les param\u00e8tres sont valides mais la requ\u00eate a \u00e9chou\u00e9 |\n| 403 | Forbidden - La cl\u00e9 API n'a pas les permissions n\u00e9cessaires |\n| 404 | Not Found - La ressource demand\u00e9e n'existe pas |\n| 409 | Conflict - La requ\u00eate est en conflit avec une autre requ\u00eate |\n| 429 | Too Many Requests - Trop de requ\u00eates envoy\u00e9es \u00e0 l'API trop rapidement |\n| 500, 502, 503, 504 | Server Errors - Erreur au niveau du serveur |\n</code></pre>"},{"location":"guides/transactions/#codes-derreur-http","title":"Codes d'erreur HTTP","text":"<p>L'API MVola utilise les codes d'erreur HTTP standard pour indiquer le r\u00e9sultat des requ\u00eates :</p> Code Description 200 OK - La requ\u00eate a r\u00e9ussi 400 Bad Request - Requ\u00eate incorrecte, souvent en raison d'un param\u00e8tre manquant 401 Unauthorized - Cl\u00e9 API invalide fournie 402 Request Failed - Les param\u00e8tres sont valides mais la requ\u00eate a \u00e9chou\u00e9 403 Forbidden - La cl\u00e9 API n'a pas les permissions n\u00e9cessaires 404 Not Found - La ressource demand\u00e9e n'existe pas 409 Conflict - La requ\u00eate est en conflit avec une autre requ\u00eate 429 Too Many Requests - Trop de requ\u00eates envoy\u00e9es \u00e0 l'API trop rapidement 500, 502, 503, 504 Server Errors - Erreur au niveau du serveur"},{"location":"guides/transactions/#meilleures-pratiques","title":"Meilleures pratiques","text":"<ol> <li>G\u00e9n\u00e9rez des r\u00e9f\u00e9rences uniques pour chaque transaction en utilisant le champ <code>requestingOrganisationTransactionReference</code>.</li> <li>Stockez les IDs de corr\u00e9lation (<code>serverCorrelationId</code>) retourn\u00e9s par l'API pour un suivi ult\u00e9rieur.</li> <li>Utilisez des webhooks (URL de callback) pour \u00eatre notifi\u00e9 des changements de statut des transactions.</li> <li>Impl\u00e9mentez un syst\u00e8me de retry pour v\u00e9rifier le statut des transactions jusqu'\u00e0 ce qu'elles soient termin\u00e9es.</li> <li>Respectez la limite de 50 caract\u00e8res pour la description de la transaction.</li> </ol>"},{"location":"guides/transactions/#exemple-complet-de-flux-de-paiement","title":"Exemple complet de flux de paiement","text":"<p>Voici un exemple complet qui combine l'initiation d'un paiement, la v\u00e9rification du statut et la r\u00e9cup\u00e9ration des d\u00e9tails :</p> <pre><code>import time\nfrom mvola_api import MVolaClient\nfrom mvola_api.exceptions import MVolaTransactionError\n\n# Initialisation du client\nclient = MVolaClient(\n    consumer_key=\"votre_consumer_key\",\n    consumer_secret=\"votre_consumer_secret\",\n    partner_name=\"NOM_DU_PARTENAIRE\",\n    partner_msisdn=\"0343500003\",\n    base_url=\"https://devapi.mvola.mg\"\n)\n\n# Informations de transaction\npayment_data = {\n    \"amount\": 1000,\n    \"currency\": \"Ar\",\n    \"debit_msisdn\": \"0343500003\",\n    \"credit_msisdn\": \"0343500004\",\n    \"description\": \"Paiement pour produit ABC\",\n    \"requesting_organisation_transaction_reference\": \"REF123456\"\n}\n\ndef process_payment():\n    try:\n        # Initier le paiement\n        transaction_info = client.initiate_merchant_payment(**payment_data)\n        server_correlation_id = transaction_info.get('serverCorrelationId')\n        print(f\"Paiement initi\u00e9 avec succ\u00e8s. ID: {server_correlation_id}\")\n\n        # V\u00e9rifier le statut (avec des tentatives)\n        max_attempts = 5\n        attempts = 0\n        transaction_reference = None\n\n        while attempts &lt; max_attempts:\n            status_info = client.get_transaction_status(\n                server_correlation_id=server_correlation_id\n            )\n            status = status_info.get('status')\n            print(f\"Statut actuel: {status}\")\n\n            # Si la transaction est termin\u00e9e, r\u00e9cup\u00e9rer sa r\u00e9f\u00e9rence\n            if status == 'completed':\n                transaction_reference = status_info.get('objectReference')\n                print(f\"Transaction r\u00e9ussie! R\u00e9f\u00e9rence: {transaction_reference}\")\n\n                # R\u00e9cup\u00e9rer les d\u00e9tails complets\n                if transaction_reference:\n                    details = client.get_transaction_details(transaction_id=transaction_reference)\n                    print(f\"D\u00e9tails complets: {details}\")\n                return True\n            elif status in ['failed', 'cancelled', 'rejected']:\n                print(f\"La transaction a \u00e9chou\u00e9 avec le statut: {status}\")\n                return False\n\n            attempts += 1\n            # Attendre avant de v\u00e9rifier \u00e0 nouveau\n            time.sleep(5)\n\n        print(\"Nombre maximum de tentatives atteint\")\n        return False\n\n    except MVolaTransactionError as e:\n        print(f\"Erreur de transaction: {e}\")\n        return False\n    except Exception as e:\n        print(f\"Erreur inattendue: {e}\")\n        return False\n\n# Ex\u00e9cuter le processus de paiement\nresult = process_payment()\nprint(f\"R\u00e9sultat du paiement: {'Succ\u00e8s' if result else '\u00c9chec'}\")\n</code></pre>"},{"location":"guides/transactions/#prochaines-etapes","title":"Prochaines \u00e9tapes","text":"<p>Consultez le guide Gestion des erreurs pour apprendre \u00e0 g\u00e9rer efficacement les erreurs qui peuvent survenir lors des transactions, ou le guide Int\u00e9gration web pour voir comment int\u00e9grer les paiements MVola dans une application web. </p>"}]}